import{j as i}from"./jsx-runtime.D_zvdyIk.js";import{r as x,R as Yr}from"./index.BmW6Ki2V.js";import{b as ge,o as Hr,s as Oa,G as $a,c as Ia,g as V,i as U,d as M,q as et,e as tt,f as ke,h as L,j,k as q,T as W,u as Vr,w as Kr,l as O,m as It,n as La,p as Ua,r as Ke,a as H}from"./analyticsService.XC7CoLNz.js";import{F as Ma,f as za}from"./textFormatting.DSBMspq2.js";import{t as Pe,a as ze,b as Ga}from"./appAnalytics.Cx1M9UdX.js";const ar=Symbol.for("constructDateFrom");function Jr(r,e){return typeof r=="function"?r(e):r&&typeof r=="object"&&ar in r?r[ar](e):r instanceof Date?new r.constructor(e):new Date(e)}function Qr(r,e){return Jr(r,r)}function qr(r,e,t){const s=Qr(r);return isNaN(e)?Jr(r,NaN):(e&&s.setDate(s.getDate()+e),s)}function Xr(r,e){const t=Qr(r);return t.setHours(0,0,0,0),t}const pe={SKIP:0,HARD:2,GOOD:4,EASY:5},Wa={easinessFactor:2.5,repetitions:0,interval:1,nextReviewDate:new Date,lastReviewDate:new Date,totalReviews:0,correctStreak:0,averageQuality:0},Ba=1.3,Ya=2.5,Ha=(r,e)=>{const t=r+(.1-(5-e)*(.08+(5-e)*.02));return Math.max(Ba,Math.min(Ya,t))},Zr=(r,e)=>{switch(r){case 0:return 1;case 1:return 6;default:return Math.round(Zr(r-1,e)*e)}},Va=(r,e,t)=>e===0?t:(r*e+t)/(e+1),Ka=(r,e,t=new Date)=>{const s=Xr(t),a=Ha(r.easinessFactor,e),o=r.totalReviews+1,n=Va(r.averageQuality,r.totalReviews,e),l=e>=3;let c,f,d,u;l?(c=r.repetitions+1,f=Zr(c,a),d=r.correctStreak+1,u=!1):(c=0,f=1,d=0,u=!0);const m=qr(s,f);return{easinessFactor:a,repetitions:c,interval:f,nextReviewDate:m,lastReviewDate:s,totalReviews:o,correctStreak:d,averageQuality:n,shouldRepeatToday:u}},Ja=(r=new Date)=>{const e=Xr(r),t=qr(e,-1);return{...Wa,nextReviewDate:e,lastReviewDate:t}},we=async r=>{console.log(`Loading card set data via fetch: ${r}`);const e=r.endsWith(".json")?r:`${r}.json`,t=`/data/${e}`;try{console.log(`Fetching card set from: ${t}`);const s=await fetch(t);if(!s.ok)throw new Error(`Failed to load card set "${e}": ${s.status} ${s.statusText}`);const a=await s.json();if(!Array.isArray(a))throw new Error(`Invalid card set data format in "${e}": Expected array, got ${typeof a}`);return console.log(`Successfully loaded ${a.length} cards from ${e}`),a}catch(s){throw console.error(`Error loading card set from ${t}:`,s),s instanceof TypeError&&s.message.includes("fetch")?new Error(`Network error while loading card set "${e}". Please check your internet connection and try again.`):s}},Ce=(r,e="default")=>{const t=Ja(),s=new Date;return{...r,cardSetId:e,...t,createdAt:s,updatedAt:s,isNew:!0}};new Date().toISOString();function ft(r,e,t,s){const a=e?` "${e}"`:"",o=t?` (${t})`:"";let n,l;switch(r){case"CARD_SET_NOT_FOUND":n=`Card set${a} could not be found${o}. Please check if the file exists or try selecting a different card set.`,l=!1;break;case"CARD_SET_INVALID_DATA":n=`Card set${a} contains invalid data${o}. The file might be corrupted or in the wrong format.`,l=!1;break;case"CARD_SET_LOAD_FAILED":n=`Failed to load card set${a}${o}. This might be a temporary issue - please try again.`,l=!0;break;case"CARD_SET_EMPTY":n=`Card set${a} is empty or contains no valid flashcards${o}. Please check the card set data.`,l=!1;break;case"NETWORK_ERROR":n=`Network error while loading card set${a}. Please check your internet connection and try again.`,l=!0;break;case"SESSION_ERROR":n="There was an issue with the current review session. Your progress has been saved.",l=!0;break;case"FIRESTORE_ERROR":n="Database sync error. Your local progress is safe, but cloud sync may be delayed.",l=!0;break;default:n=`An unexpected error occurred${a?` with card set${a}`:""}. Please try again.`,l=!0;break}return{code:r,message:n,retryable:l,timestamp:new Date,context:{cardSetId:e,dataFile:t,originalError:s?.message||s},cardSetId:e,dataFile:t}}function Qa(r){const e=r?.message||r?.toString()||"";return e.includes("Cannot resolve module")||e.includes("Module not found")||e.includes("ENOENT")?"CARD_SET_NOT_FOUND":e.includes("SyntaxError")||e.includes("Unexpected token")||e.includes("JSON.parse")?"CARD_SET_INVALID_DATA":e.includes("network")||e.includes("fetch")||e.includes("NetworkError")?"NETWORK_ERROR":"CARD_SET_LOAD_FAILED"}function or(r){if(!r||!Array.isArray(r))throw new Error("Card set data must be an array of flashcards");if(r.length===0)throw new Error("Card set contains no flashcards");const e=Math.min(3,r.length);for(let t=0;t<e;t++){const s=r[t];if(!s.id||typeof s.id!="string")throw new Error(`Card at index ${t} is missing required 'id' field`);if(!s.front||typeof s.front!="object")throw new Error(`Card at index ${t} is missing required 'front' field`);if(!s.back||typeof s.back!="object")throw new Error(`Card at index ${t} is missing required 'back' field`);if(!s.front.title||typeof s.front.title!="string")throw new Error(`Card at index ${t} has invalid front title`);if(!s.back.title||typeof s.back.title!="string")throw new Error(`Card at index ${t} has invalid back title`)}return!0}const es=[10,20,30],nr=10,ir={"auth/popup-closed-by-user":"‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö","auth/popup-blocked":"‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï popup","auth/cancelled-popup-request":"‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å","auth/network-request-failed":"‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡πÑ‡∏î‡πâ","auth/user-disabled":"‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô","auth/operation-not-allowed":"‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ",default:"‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á"},qa=r=>ir[r]||ir.default,Lt=r=>({uid:r.uid,email:r.email,displayName:r.displayName,photoURL:r.photoURL,createdAt:new Date,updatedAt:new Date,lastLoginAt:new Date,preferredLanguage:"en",theme:"system",isActive:!0}),Xa=async()=>{try{console.log("Starting Google Sign-In...");const r=new $a;r.addScope("email"),r.addScope("profile");const t=(await Ia(ge,r)).user;return console.log("Google Sign-In successful:",{uid:t.uid,email:t.email,displayName:t.displayName}),{success:!0,user:Lt(t)}}catch(r){console.error("Google Sign-In error:",r);const e=r?.code||"default";return{success:!1,error:qa(e)}}},ts=async()=>{try{return console.log("Signing out user..."),await Oa(ge),to(),console.log("Sign out successful"),{success:!0}}catch(r){return console.error("Sign out error:",r),{success:!1,error:"‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö"}}},Za=()=>{const r=ge.currentUser;return r?Lt(r):null},P=()=>ge.currentUser,eo=r=>Hr(ge,r),rs="remember_guest_mode",ss=()=>typeof window>"u"?!1:localStorage.getItem(rs)==="true",to=()=>{typeof window>"u"||(localStorage.removeItem(rs),console.log("Guest mode disabled"))},ro=()=>ge.currentUser!==null||ss(),lr=()=>({user:ge.currentUser,userProfile:Za(),isGuest:ss(),isAuthenticated:ro()});class so{totalReads=0;totalWrites=0;enabled=!0;operationContext="";operationDetails=[];setEnabled(e){this.enabled=e,console.log(`üîç Firestore counter: ${e?"ENABLED":"DISABLED"}`)}isEnabled(){return this.enabled}startOperationTracking(e){this.operationContext=e,console.log(`üèÅ Starting operation tracking: ${e}`),this.clear()}endOperationTracking(){const e=this.getStats();console.log(`üèÅ Completed operation tracking: ${this.operationContext}`),console.log(`üìà Performance Summary: ${e.totalReads}R + ${e.totalWrites}W = ${e.totalOps} ops`),this.operationContext.includes("SINGLE DOCUMENT")?(console.log("‚úÖ Expected: Low operation count (1-2 operations)"),e.totalOps>2&&console.log(`‚ö†Ô∏è WARNING: Expected ‚â§2 operations, got ${e.totalOps}. Check if single document methods are used.`)):this.operationContext.includes("LEGACY")&&console.log("‚ö†Ô∏è Expected: High operation count (N operations)");const t={...e,details:[...this.operationDetails]};return this.operationContext="",t}countRead(e){if(!this.enabled)return;this.totalReads++;const t=e?`: ${e}`:"",s=this.operationContext?` [${this.operationContext}]`:"";console.log(`üìñ READ #${this.totalReads}${s}${t}`),this.operationDetails.push(`üìñ READ #${this.totalReads}${t}`)}countWrite(e){if(!this.enabled)return;this.totalWrites++;const t=e?`: ${e}`:"",s=this.operationContext?` [${this.operationContext}]`:"";console.log(`‚úçÔ∏è WRITE #${this.totalWrites}${s}${t}`),this.operationDetails.push(`‚úçÔ∏è WRITE #${this.totalWrites}${t}`)}validateExpectedOperations(e,t){const s=t==="single"?{reads:1,writes:1,total:2}:{reads:e,writes:e,total:e*2},a=this.getStats();console.log("üéØ Expected vs Actual Operations:"),console.log(`Pattern: ${t.toUpperCase()}, Cards: ${e}`),console.log(`Expected: ${s.reads}R + ${s.writes}W = ${s.total} ops`),console.log(`Actual:   ${a.totalReads}R + ${a.totalWrites}W = ${a.totalOps} ops`);const o=a.totalOps===s.total;console.log(o?"‚úÖ Operation count matches expectations!":"‚ùå Operation count differs from expectations"),!o&&t==="single"&&console.log("üí° Check: Are you using the new single document methods?")}getStats(){return{totalReads:this.totalReads,totalWrites:this.totalWrites,totalOps:this.totalReads+this.totalWrites}}clear(){this.totalReads=0,this.totalWrites=0,this.operationDetails=[],console.log("üóëÔ∏è Counter cleared")}}const F=new so;typeof window<"u"&&(window.firestoreDebug={enable:()=>F.setEnabled(!0),disable:()=>F.setEnabled(!1),getStats:()=>F.getStats(),clear:()=>F.clear(),reset:()=>F.clear(),start:r=>F.startOperationTracking(r),end:()=>F.endOperationTracking(),validate:(r,e)=>F.validateExpectedOperations(r,e)});const Z={USERS:"users",CARD_SETS:"cardSets",CARDS:"cards"},xe=(r,e)=>{const t=`${Z.USERS}/${r}/${Z.CARD_SETS}/${e}/${Z.CARDS}`;return console.log(`Firestore: Accessing collection path: ${t}`),Ke(O,Z.USERS,r,Z.CARD_SETS,e,Z.CARDS)},ao=r=>Ke(O,Z.USERS,r,Z.CARD_SETS),Ut=r=>L(O,Z.USERS,r),Ie=(r,e)=>L(O,Z.USERS,r,Z.CARD_SETS,e),Mt=async(r,e)=>{try{const t=Ie(r,e);console.log(`üìñ Single Document READ for ${r}/${e}`),F.countRead(`Single document load: ${e}`);const s=await V(t);if(!s.exists())return console.log(`Card set document does not exist: ${e}`),{success:!0,data:null};const a=s.data(),o=(a.cards||[]).map(n=>({...n,createdAt:n.createdAt?.toDate()||new Date,updatedAt:n.updatedAt?.toDate()||new Date,nextReviewDate:n.nextReviewDate?.toDate()||new Date,lastReviewDate:n.lastReviewDate?.toDate()||(()=>{const l=new Date;return l.setDate(l.getDate()-1),l})()}));return console.log(`‚úÖ Loaded ${o.length} cards from single document`),{success:!0,data:{cards:o,totalCards:a.totalCards||o.length}}}catch(t){return console.error("Error getting card set document:",t),U(t)?{success:!1,error:M(t)}:{success:!1,error:"Failed to get card set document."}}},zt=async(r,e,t)=>{try{const s=Ie(r,e),a=new Date,o=t.map(l=>({...l,cardSetId:e,updatedAt:W.fromDate(a),createdAt:l.createdAt?l.createdAt instanceof Date?W.fromDate(l.createdAt):l.createdAt:W.fromDate(a),nextReviewDate:l.nextReviewDate?l.nextReviewDate instanceof Date?W.fromDate(l.nextReviewDate):l.nextReviewDate:W.fromDate(a),lastReviewDate:l.lastReviewDate?l.lastReviewDate instanceof Date?W.fromDate(l.lastReviewDate):l.lastReviewDate:W.fromDate(a)})),n={cardSetId:e,cards:o,totalCards:t.length,updatedAt:j(),createdAt:j()};return console.log(`‚úçÔ∏è Single Document WRITE: ${t.length} cards for ${r}/${e}`),F.countWrite(`Single document save: ${t.length} cards to ${e}`),await q(s,n,{merge:!0}),console.log(`‚úÖ Saved ${t.length} cards in single write operation`),{success:!0,data:t}}catch(s){return console.error("Error saving cards in single write:",s),U(s)?{success:!1,error:M(s)}:{success:!1,error:"Failed to save cards in single write."}}},as=async(r,e,t)=>{try{const s=Ie(r,e),a=new Date,o=t.map(l=>({...l,cardSetId:e,updatedAt:W.fromDate(a),createdAt:l.createdAt?l.createdAt instanceof Date?W.fromDate(l.createdAt):l.createdAt:W.fromDate(a),nextReviewDate:l.nextReviewDate?l.nextReviewDate instanceof Date?W.fromDate(l.nextReviewDate):l.nextReviewDate:W.fromDate(a),lastReviewDate:l.lastReviewDate?l.lastReviewDate instanceof Date?W.fromDate(l.lastReviewDate):l.lastReviewDate:W.fromDate(a)})),n={cardSetId:e,cards:o,totalCards:t.length,updatedAt:j(),createdAt:j()};return console.log(`‚úçÔ∏è REPLACE Document: ${t.length} fresh cards for ${r}/${e}`),F.countWrite(`Replace document: ${t.length} fresh cards to ${e}`),await q(s,n),console.log(`‚úÖ Replaced ${t.length} cards completely (reset)`),{success:!0,data:t}}catch(s){return console.error("Error replacing cards in single write:",s),U(s)?{success:!1,error:M(s)}:{success:!1,error:"Failed to replace cards in single write."}}},os=async(r,e)=>{try{const t=Ie(r,e);return console.log(`üóëÔ∏è Deleting card set document: ${r}/${e}`),F.countWrite(`Delete card set document: ${e}`),await It(t),console.log(`‚úÖ Deleted card set document: ${e}`),{success:!0}}catch(t){return console.error("Error deleting card set document:",t),U(t)?{success:!1,error:M(t)}:{success:!1,error:"Failed to delete card set document."}}},oo=async(r,e)=>{try{const t=L(O,"users",r,"cardSetProgress",e);return console.log(`üóëÔ∏è Deleting cardSetProgress: ${r}/cardSetProgress/${e}`),F.countWrite(`Delete cardSetProgress: ${e}`),await It(t),console.log(`‚úÖ Deleted cardSetProgress: ${e}`),{success:!0}}catch(t){return console.error("Error deleting cardSetProgress document:",t),U(t)?{success:!1,error:M(t)}:{success:!1,error:"Failed to delete cardSetProgress document."}}},ns=async(r,e,t)=>{try{const s=await Mt(r,e);if(!s.success)return{success:!1,error:s.error};if(!s.data)return{success:!1,error:"Card set document does not exist for updates."};const o=s.data.cards.map(l=>{const c=t.get(l.id);return c?{...l,...c}:l}),n=await zt(r,e,o);return console.log(`‚úÖ Updated ${t.size} cards using load‚Üímerge‚Üísave pattern`),n}catch(s){return console.error("Error updating cards in single document:",s),U(s)?{success:!1,error:M(s)}:{success:!1,error:"Failed to update cards in single document."}}},is=async(r,e)=>{try{const t=Ut(r),s={...e,createdAt:j(),updatedAt:j()};return F.countWrite(),await q(t,s,{merge:!0}),console.log("User profile created/updated:",r),{success:!0,data:s}}catch(t){return console.error("Error creating user profile:",t),U(t)?{success:!1,error:M(t)}:{success:!1,error:"Failed to create user profile."}}},no=async r=>{try{const e=Ut(r);F.countRead();const t=await V(e);return t.exists()?{success:!0,data:t.data()}:{success:!1,error:"User profile not found."}}catch(e){return console.error("Error getting user profile:",e),U(e)?{success:!1,error:M(e)}:{success:!1,error:"Failed to get user profile."}}},ls=async(r,e)=>{try{const t=P();if(!t)return{success:!1,error:"User must be authenticated to save cards."};const s=xe(t.uid,e),a=L(s,r.id),o={...r,cardSetId:e,updatedAt:j(),createdAt:r.createdAt||j()};return F.countWrite(),await q(a,o,{merge:!0}),console.log("Flashcard saved:",r.id),{success:!0,data:o}}catch(t){return console.error("Error saving flashcard:",t),U(t)?{success:!1,error:M(t)}:{success:!1,error:"Failed to save flashcard."}}},Je=async(r,e)=>{try{const t=P();if(!t)return{success:!1,error:"User must be authenticated to save cards."};console.log(`Firestore: Saving batch of ${r.length} cards for user ${t.uid} in cardSet ${e}`);const s=Kr(O),a=xe(t.uid,e);return r.forEach(o=>{const n=L(a,o.id),l={...o,cardSetId:e,updatedAt:j(),createdAt:o.createdAt||j()};s.set(n,l,{merge:!0}),F.countWrite()}),await s.commit(),console.log(`${r.length} flashcards saved in batch`),{success:!0,data:r}}catch(t){return console.error("Error saving flashcards batch:",t),U(t)?{success:!1,error:M(t)}:{success:!1,error:"Failed to save flashcards."}}},cs=async r=>{try{const e=P();if(!e)return{success:!1,error:"User must be authenticated to get cards."};const t=xe(e.uid,r),s=et(t,tt("createdAt","desc"));F.countRead();const o=(await ke(s)).docs.map(n=>({id:n.id,...n.data(),createdAt:n.data().createdAt?.toDate()||new Date,updatedAt:n.data().updatedAt?.toDate()||new Date,nextReviewDate:n.data().nextReviewDate?.toDate()||new Date,lastReviewDate:n.data().lastReviewDate?.toDate()||(()=>{const l=new Date;return l.setDate(l.getDate()-1),l})()}));return console.log(`Retrieved ${o.length} flashcards`),{success:!0,data:o}}catch(e){return console.error("Error getting flashcards:",e),U(e)?{success:!1,error:M(e)}:{success:!1,error:"Failed to get flashcards."}}},io=async r=>{try{const e=P();if(!e)return{success:!1,error:"User must be authenticated to get cards."};const t=xe(e.uid,r),s=W.fromDate(new Date),a=et(t,Ua("nextReviewDate","<=",s),tt("nextReviewDate","asc"));F.countRead();const n=(await ke(a)).docs.map(l=>({id:l.id,...l.data(),createdAt:l.data().createdAt?.toDate()||new Date,updatedAt:l.data().updatedAt?.toDate()||new Date,nextReviewDate:l.data().nextReviewDate?.toDate()||new Date}));return console.log(`Retrieved ${n.length} due flashcards`),{success:!0,data:n}}catch(e){return console.error("Error getting due flashcards:",e),U(e)?{success:!1,error:M(e)}:{success:!1,error:"Failed to get due flashcards."}}},St=async(r,e,t)=>{try{const s=P();if(!s)return{success:!1,error:"User must be authenticated to update progress."};const a=L(xe(s.uid,e),r);F.countRead();const o=await V(a),n={...t,cardSetId:e,updatedAt:j(),nextReviewDate:t.nextReviewDate?W.fromDate(t.nextReviewDate):j(),lastReviewDate:t.lastReviewDate?W.fromDate(t.lastReviewDate):j()};if(o.exists())console.log(`Updating existing card: ${r} (cardSet: ${e})`),F.countWrite(),await Vr(a,n),console.log(`Successfully updated card: ${r}`);else{console.log(`Creating new card in Firestore: ${r} (cardSet: ${e})`);const l={id:r,...n,createdAt:j(),easinessFactor:t.easinessFactor||2.5,repetitions:t.repetitions||0,interval:t.interval||1,totalReviews:t.totalReviews||1,correctStreak:t.correctStreak||0,averageQuality:t.averageQuality||3,isNew:t.isNew!==void 0?t.isNew:!1};F.countWrite(),await q(a,l),console.log(`Successfully created new card: ${r}`)}return{success:!0,data:n}}catch(s){return console.error("Error updating flashcard progress:",s),U(s)?{success:!1,error:M(s)}:{success:!1,error:"Failed to update flashcard progress."}}},lo=async(r,e)=>{try{const t=P();if(!t)return{success:!1,error:"User must be authenticated to delete cards."};const s=L(xe(t.uid,e),r);return F.countWrite(),await It(s),console.log("Flashcard deleted:",r,"from card set:",e),{success:!0}}catch(t){return console.error("Error deleting flashcard:",t),U(t)?{success:!1,error:M(t)}:{success:!1,error:"Failed to delete flashcard."}}},ds=async r=>{try{const e=P();if(!e)return{success:!1,error:"User must be authenticated to migrate data."};if(!r||!Array.isArray(r.cards))return{success:!1,error:"No valid guest data to migrate."};await is(e.uid,{email:e.email,displayName:e.displayName,migratedFromGuest:!0,migrationDate:j()});const s=await Je(r.cards,"chinese_essentials_1");return s.success?(console.log(`Successfully migrated ${r.cards.length} cards from guest mode`),{success:!0,data:r.cards}):s}catch(e){return console.error("Error migrating guest data:",e),U(e)?{success:!1,error:M(e)}:{success:!1,error:"Failed to migrate guest data."}}},co=(r,e)=>{const t=P();if(!t)return console.warn("User must be authenticated to subscribe to flashcards"),()=>{};const s=xe(t.uid,r),a=et(s,tt("createdAt","desc"));return La(a,o=>{const n=o.docs.map(l=>({id:l.id,...l.data(),createdAt:l.data().createdAt?.toDate()||new Date,updatedAt:l.data().updatedAt?.toDate()||new Date,nextReviewDate:l.data().nextReviewDate?.toDate()||new Date}));e(n)},o=>{console.error("Error in flashcards subscription:",o)})},uo=async()=>{try{const r=P();if(!r)return{success:!1,error:"User must be authenticated to get card sets."};const e=ao(r.uid),t=et(e,tt("lastAccessedAt","desc"));F.countRead();const a=(await ke(t)).docs.map(o=>({id:o.id,...o.data(),createdAt:o.data().createdAt?.toDate()||new Date,updatedAt:o.data().updatedAt?.toDate()||new Date,lastAccessedAt:o.data().lastAccessedAt?.toDate()||new Date}));return console.log(`Found ${a.length} card sets for user`),{success:!0,data:a}}catch(r){return console.error("Error getting user card sets:",r),U(r)?{success:!1,error:M(r)}:{success:!1,error:"Failed to get card sets."}}},fo=async(r,e)=>{try{const t=P();if(!t)return{success:!1,error:"User must be authenticated to update card set metadata."};const s=Ie(t.uid,r),a={...e,lastAccessedAt:j(),updatedAt:j(),createdAt:e.createdAt||j()};return F.countWrite(),await q(s,a,{merge:!0}),console.log("Card set metadata updated:",r),{success:!0}}catch(t){return console.error("Error updating card set metadata:",t),U(t)?{success:!1,error:M(t)}:{success:!1,error:"Failed to update card set metadata."}}},go=async r=>{try{if(!r)return{success:!1,error:"User ID is required to load card set progress"};console.log(`üìñ Loading all card set progress for user: ${r}`);const e=Ut(r);F.countRead("Load all card set progress");const t=await V(e);if(!t.exists())return console.log("User profile document does not exist, returning empty progress"),{success:!0,data:{}};const a=t.data().cardSetsProgress||{},o={};return Object.entries(a).forEach(([n,l])=>{o[n]={cardSetId:l.cardSetId,totalCards:l.totalCards||0,reviewedCards:l.reviewedCards||0,progressPercentage:l.progressPercentage||0,masteredCards:l.masteredCards||0,needPracticeCards:l.needPracticeCards||0,reviewedToday:l.reviewedToday||0,createdAt:l.createdAt?.toDate()||new Date,updatedAt:l.updatedAt?.toDate()||new Date}}),console.log(`‚úÖ Loaded progress for ${Object.keys(o).length} card sets from user profile`),{success:!0,data:o}}catch(e){return console.error("Error loading all card set progress:",e),U(e)?{success:!1,error:M(e)}:{success:!1,error:String(e)}}},mo={createUserProfile:is,getUserProfile:no,getUserCardSets:uo,updateCardSetMetadata:fo,getCardSetDocument:Mt,saveAllCardsInSingleWrite:zt,replaceAllCardsInSingleWrite:as,deleteCardSetDocument:os,deleteCardSetProgressDocument:oo,updateCardsInSingleDocument:ns,getAllCardSetProgress:go,saveFlashcard:ls,deleteFlashcard:lo,updateFlashcardProgress:St,saveFlashcardsBatch:Je,getUserFlashcards:cs,getDueFlashcards:io,subscribeToUserFlashcards:co,migrateGuestDataToUser:ds};class gt{static CURRENT_MIGRATION_VERSION=1;static async needsMigration(e){try{console.log(`Checking if migration is needed for user: ${e}`);const t=L(O,"users",e);F.countRead();const s=await V(t);if(!s.exists())return console.log("User document does not exist, migration needed"),!0;const a=s.data();if(a.cardSetsProgress&&a.migrationVersion===this.CURRENT_MIGRATION_VERSION)return console.log("User already has optimized structure, no migration needed"),!1;const o=Ke(O,"users",e,"cardSetProgress");F.countRead();const l=!(await ke(o)).empty||!a.cardSetsProgress;return console.log(`Migration needed: ${l}`),l}catch(t){return console.error("Error checking migration status:",t),!0}}static async migrateToOptimizedStructure(e){console.log(`Starting migration to optimized structure for user: ${e}`);const t={success:!1,migratedCardSets:[],errors:[],totalReadOperations:0,totalWriteOperations:0};try{const s=L(O,"users",e);F.countRead();const a=await V(s);t.totalReadOperations++;let o=null;a.exists()?(o=a.data(),console.log("Found existing user profile")):console.log("No existing user profile found");const n=Ke(O,"users",e,"cardSetProgress");F.countRead();const l=await ke(n);t.totalReadOperations++,console.log(`Found ${l.size} cardSetProgress documents`);const c={};l.forEach(u=>{try{const m=u.data();if(!m.cardSetId||typeof m.totalCards!="number")throw new Error("Invalid progress data: missing required fields");const g={cardSetId:m.cardSetId,totalCards:m.totalCards,reviewedCards:m.reviewedCards||0,progressPercentage:m.progressPercentage||0,masteredCards:m.masteredCards||0,needPracticeCards:m.needPracticeCards||0,reviewedToday:m.reviewedToday||0,createdAt:m.createdAt?.toDate()||new Date,updatedAt:m.updatedAt?.toDate()||new Date};c[m.cardSetId]=g,t.migratedCardSets.push(g.cardSetId),console.log(`Consolidated progress for card set: ${g.cardSetId}`)}catch(m){const g=`Error processing progress document ${u.id}: ${m}`;console.error(g),t.errors.push(g)}});const f={...o,uid:e,email:o?.email||null,displayName:o?.displayName||null,photoURL:o?.photoURL||null,createdAt:o?.createdAt||new Date,updatedAt:o?.updatedAt||new Date,lastLoginAt:new Date,isActive:o?.isActive??!0,cardSetsProgress:c},d=Kr(O);d.set(s,{...f,updatedAt:j(),lastMigrationDate:j()},{merge:!0}),t.totalWriteOperations++,l.forEach(u=>{d.delete(u.ref),t.totalWriteOperations++}),F.countWrite(),l.forEach(()=>{F.countWrite()}),await d.commit(),t.success=!0,console.log("Migration completed successfully:",{migratedCardSets:t.migratedCardSets.length,totalOperations:t.totalReadOperations+t.totalWriteOperations})}catch(s){const a=`Migration failed: ${s}`;console.error(a),t.errors.push(a),t.success=!1}return t}static async loadOptimizedProfile(e){try{console.log(`Loading optimized profile for user: ${e}`);const t=L(O,"users",e);F.countRead();const s=await V(t);if(!s.exists())return console.log("User document does not exist"),null;const a=s.data();return a.cardSetsProgress||(console.log("User profile missing cardSetsProgress, migration may be needed"),a.cardSetsProgress={}),a.createdAt&&typeof a.createdAt!="object"&&(a.createdAt=new Date(a.createdAt)),a.lastLoginAt&&typeof a.lastLoginAt!="object"&&(a.lastLoginAt=new Date(a.lastLoginAt)),Object.values(a.cardSetsProgress).forEach(o=>{o.createdAt&&typeof o.createdAt!="object"&&(o.createdAt=new Date(o.createdAt)),o.updatedAt&&typeof o.updatedAt!="object"&&(o.updatedAt=new Date(o.updatedAt))}),console.log(`Loaded profile with ${Object.keys(a.cardSetsProgress).length} card set progress records`),a}catch(t){return console.error("Error loading optimized profile:",t),null}}static async updateCardSetProgress(e,t,s){try{console.log(`Updating progress for card set: ${t}`);const a=L(O,"users",e);F.countWrite();const o=await V(a),c={...(o.exists()?o.data():{}).cardSetsProgress||{},[t]:{...s,updatedAt:j()}};return await q(a,{cardSetsProgress:c,updatedAt:j()},{merge:!0}),console.log(`Successfully updated progress for card set: ${t}`),!0}catch(a){return console.error(`Error updating progress for card set ${t}:`,a),!1}}static async autoMigrateAndLoadProfile(e){try{if(console.log(`Auto-migration check for user: ${e}`),await this.needsMigration(e)){console.log("Starting automatic migration...");const s=await this.migrateToOptimizedStructure(e);s.success?console.log("Auto-migration completed successfully"):console.error("Auto-migration failed:",s.errors)}return await this.loadOptimizedProfile(e)}catch(t){return console.error("Error in auto-migration process:",t),null}}}class T{static async loadUserFlashcards(e){try{const t=P();if(!t)return{success:!1,error:"User must be authenticated to load cards from Firestore."};console.log(`üìñ Loading cards using SINGLE DOCUMENT pattern for ${e}`);const s=await Mt(t.uid,e);if(!s.success)return{success:!1,error:s.error||"Failed to load cards from Firestore"};let a=[];return s.data&&s.data.cards&&s.data.cards.length>0?(a=s.data.cards,console.log(`‚úÖ SINGLE DOCUMENT: Loaded ${a.length} cards with 1 read operation for ${e}`)):console.log(`No cards found in single document for ${e}, returning empty array for lazy creation`),{success:!0,data:a}}catch(t){return console.error("Error loading cards from single document:",t),{success:!1,error:t instanceof Error?t.message:"Failed to load cards from Firestore"}}}static async loadUserFlashcardsLegacy(e){try{if(!P())return{success:!1,error:"User must be authenticated to load cards from Firestore."};console.log(`‚ö†Ô∏è Using LEGACY subcollection pattern for ${e}`);const s=await cs(e);if(!s.success)return{success:!1,error:s.error||"Failed to load cards from Firestore"};let a=[];return s.data&&s.data.length>0?(a=s.data.map(o=>({...o,nextReviewDate:o.nextReviewDate instanceof Date?o.nextReviewDate:new Date(o.nextReviewDate),lastReviewDate:o.lastReviewDate instanceof Date?o.lastReviewDate:new Date(o.lastReviewDate),createdAt:o.createdAt instanceof Date?o.createdAt:new Date(o.createdAt),updatedAt:o.updatedAt instanceof Date?o.updatedAt:new Date(o.updatedAt)})),console.log(`LEGACY: Loaded ${a.length} cards from subcollection for ${e}`)):console.log(`LEGACY: No cards found in subcollection for ${e}`),{success:!0,data:a}}catch(t){return console.error("Error loading cards from subcollection:",t),{success:!1,error:t instanceof Error?t.message:"Failed to load cards from Firestore"}}}static async loadCardsFromJSON(e){try{const t=e.endsWith(".json")?e:`${e}.json`,a=(await we(t)).map(o=>Ce(o,t.replace(".json","")));return console.log(`Loaded ${a.length} cards from JSON file: ${t}`),{success:!0,data:a}}catch(t){return console.error(`Error loading cards from JSON file ${e}:`,t),{success:!1,error:`Failed to load cards from ${e}`}}}static async loadCardSetData(e,t){try{console.log(`Loading card set: ${e} (${t})`);const s=await this.loadUserFlashcards(e);if(s.success&&s.data&&s.data.length>0)return console.log(`Found ${s.data.length} cards in Firestore for ${e}`),{success:!0,data:{cards:s.data,source:"firestore"}};console.log(`No cards found in Firestore for ${e}, creating from JSON`);const a=await this.loadCardsFromJSON(t);if(!a.success||!a.data)return{success:!1,error:`Failed to load JSON data for card set ${e}`};if(!(await this.saveCardsBatch(a.data,e)).success)return console.warn(`Failed to save cards to Firestore for ${e}, returning JSON data`),{success:!0,data:{cards:a.data,source:"json"}};console.log(`Successfully saved ${a.data.length} cards to Firestore for ${e}`);const n=await this.loadUserFlashcards(e);return n.success&&n.data&&n.data.length>0?(console.log(`Reloaded ${n.data.length} cards from Firestore for ${e}`),{success:!0,data:{cards:n.data,source:"firestore"}}):{success:!0,data:{cards:a.data,source:"json"}}}catch(s){return console.error(`Error loading card set data for ${e}:`,s),{success:!1,error:s instanceof Error?s.message:"Failed to load card set data"}}}static async saveCard(e,t){try{if(!P())return{success:!1,error:"User must be authenticated to save cards to Firestore."};const a=await ls(e,t);return a.success?(console.log(`Saved card ${e.id} to Firestore in card set: ${t}`),{success:!0}):{success:!1,error:a.error||"Failed to save card to Firestore"}}catch(s){return console.error("Error saving card to Firestore:",s),{success:!1,error:s instanceof Error?s.message:"Failed to save card to Firestore"}}}static async saveProgress(e,t,s){try{if(!P())return{success:!1,error:"User must be authenticated to save progress to Firestore."};const o=await St(e,t,s);return o.success?(console.log(`Updated progress for card ${e} in Firestore (card set: ${t})`),{success:!0}):{success:!1,error:o.error||"Failed to save progress to Firestore"}}catch(a){return console.error("Error saving progress to Firestore:",a),{success:!1,error:a instanceof Error?a.message:"Failed to save progress to Firestore"}}}static async saveCardWithProgress(e,t,s){try{if(!P())return{success:!1,error:"User must be authenticated to save card with progress."};const o={...e,...s,cardSetId:t,id:e.id,front:e.front||{icon:"",title:"",description:""},back:e.back||{icon:"",title:"",description:""}},n=await St(e.id,t,o);return n.success?(console.log(`Lazy creation: Saved card ${e.id} with progress in card set: ${t}`),{success:!0,data:n.data}):{success:!1,error:n.error||"Failed to save card with progress"}}catch(a){return console.error("Error saving card with progress:",a),{success:!1,error:a instanceof Error?a.message:"Failed to save card with progress"}}}static async saveProgressBatch(e,t){try{const s=P();if(!s)return{success:!1,error:"User must be authenticated to save progress batch to Firestore."};if(e.size===0)return console.log("No progress updates to save in batch"),{success:!0,data:[]};console.log(`üöÄ SINGLE DOCUMENT: Batch saving progress for ${e.size} cards in ${t}`),console.log(`üìä Expected operations: 1 read + 1 write (instead of ${e.size*2})`);const a=await ns(s.uid,t,e);return a.success?(console.log(`‚úÖ SINGLE DOCUMENT: Successfully saved progress for ${e.size} cards using load‚Üímerge‚Üísave`),{success:!0,data:a.data}):{success:!1,error:a.error||"Failed to save progress using single document pattern"}}catch(s){return console.error("Error saving progress using single document pattern:",s),{success:!1,error:s instanceof Error?s.message:"Failed to save progress using single document pattern"}}}static async saveProgressBatchLegacy(e,t){try{if(!P())return{success:!1,error:"User must be authenticated to save progress batch to Firestore."};if(e.size===0)return console.log("No progress updates to save in batch"),{success:!0,data:[]};console.log(`‚ö†Ô∏è LEGACY: Batch saving progress for ${e.size} cards using subcollection pattern`);const a=Array.from(e.entries()).map(([n,l])=>({id:n,...l,cardSetId:t})),o=await Je(a,t);return o.success?(console.log(`LEGACY: Successfully saved progress for ${a.length} cards using subcollection`),{success:!0,data:o.data}):{success:!1,error:o.error||"Failed to batch save progress to Firestore"}}catch(s){return console.error("Error batch saving progress to subcollection:",s),{success:!1,error:s instanceof Error?s.message:"Failed to batch save progress to Firestore"}}}static async saveCardsBatch(e,t){try{const s=P();if(!s)return{success:!1,error:"User must be authenticated to save cards to Firestore."};console.log(`‚úçÔ∏è Saving ${e.length} cards using SINGLE DOCUMENT pattern for ${t}`);const a=await zt(s.uid,t,e);return a.success?(console.log(`‚úÖ SINGLE DOCUMENT: Saved ${e.length} cards with 1 write operation (${t})`),{success:!0}):{success:!1,error:a.error||"Failed to save cards using single document pattern"}}catch(s){return console.error("Error saving cards using single document pattern:",s),{success:!1,error:s instanceof Error?s.message:"Failed to save cards using single document pattern"}}}static async saveCardsBatchLegacy(e,t){try{if(!P())return{success:!1,error:"User must be authenticated to save cards to Firestore."};console.log(`‚ö†Ô∏è Using LEGACY subcollection batch for ${t}`);const a=await Je(e,t);return a.success?(console.log(`LEGACY: Saved ${e.length} cards using subcollection batch (${t})`),{success:!0}):{success:!1,error:a.error||"Failed to save cards batch to Firestore"}}catch(s){return console.error("Error saving cards batch to subcollection:",s),{success:!1,error:s instanceof Error?s.message:"Failed to save cards batch to Firestore"}}}static async migrateGuestData(e){try{if(!P())return{success:!1,error:"User must be authenticated to migrate data to Firestore."};const s=await ds(e);return s.success?(console.log("Successfully migrated guest data to Firestore"),{success:!0}):{success:!1,error:s.error||"Failed to migrate guest data to Firestore"}}catch(t){return console.error("Error migrating guest data to Firestore:",t),{success:!1,error:t instanceof Error?t.message:"Failed to migrate guest data to Firestore"}}}static async getDefaultFlashcards(){return(await we("flashcards.json")).map(t=>Ce(t,"default"))}static createPendingOperation(e,t,s=3){return{id:`${e}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:e,data:t,timestamp:new Date,retryCount:0,maxRetries:s}}static async retryOperation(e){try{const t=e.data?.cardSetId;if(!t)return{success:!1,error:"Missing cardSetId in pending operation data"};switch(e.type){case"add_card":return await this.saveCard(e.data,t);case"rate_card":return await this.saveProgress(e.data.cardId,t,e.data.progressData);case"edit_card":return await this.saveCard(e.data,t);default:return{success:!1,error:`Unknown operation type: ${e.type}`}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to retry operation"}}}static async loadCardSetProgress(e){try{const t=P();if(!t)return{success:!1,error:"User must be authenticated to load progress from Firestore."};console.log(`Loading card set progress for: ${e}`);const s=L(O,"users",t.uid),a=await V(s);if(!a.exists())return console.log(`No user profile found for: ${t.uid}`),{success:!0,data:null};const l=(a.data().cardSetsProgress||{})[e];if(!l)return console.log(`No progress found for card set: ${e}`),{success:!0,data:null};const c={cardSetId:e,totalCards:l.totalCards,reviewedCards:l.reviewedCards,progressPercentage:l.progressPercentage,masteredCards:l.masteredCards||0,needPracticeCards:l.needPracticeCards||0,reviewedToday:l.reviewedToday||0,createdAt:l.createdAt?.toDate()||new Date,updatedAt:l.updatedAt?.toDate()||new Date};return console.log(`Loaded progress for ${e}: ${c.progressPercentage}% (${c.reviewedCards}/${c.totalCards})`),{success:!0,data:c}}catch(t){return console.error("Error loading card set progress:",t),{success:!1,error:t instanceof Error?t.message:"Failed to load card set progress"}}}static async saveCardSetProgress(e){try{const t=P();if(!t)return{success:!1,error:"User must be authenticated to save progress to Firestore."};console.log(`Saving card set progress for: ${e.cardSetId} (${e.progressPercentage}%)`),console.log("User UID:",t.uid),console.log("Progress data:",{cardSetId:e.cardSetId,totalCards:e.totalCards,reviewedCards:e.reviewedCards,progressPercentage:e.progressPercentage});const s=L(O,"users",t.uid),a=await V(s),n=(a.exists()?a.data():{}).cardSetsProgress||{},l={cardSetId:e.cardSetId,totalCards:e.totalCards,reviewedCards:e.reviewedCards,progressPercentage:e.progressPercentage,masteredCards:e.masteredCards||0,needPracticeCards:e.needPracticeCards||0,reviewedToday:e.reviewedToday||0,createdAt:e.createdAt,updatedAt:j()},c={...n,[e.cardSetId]:l},f={updatedAt:j(),cardSetsProgress:c};return await q(s,f,{merge:!0}),console.log(`Successfully saved progress for ${e.cardSetId}: ${e.reviewedCards}/${e.totalCards} cards (${e.progressPercentage}%)`),{success:!0}}catch(t){return console.error("Error saving card set progress:",t),{success:!1,error:t instanceof Error?t.message:"Failed to save card set progress"}}}static async resetCardsBatch(e,t){try{const s=P();if(!s)return{success:!1,error:"User must be authenticated to reset cards in Firestore."};console.log(`‚úçÔ∏è RESETTING ${e.length} cards using REPLACE DOCUMENT pattern for ${t}`);const a=await as(s.uid,t,e);return a.success?(console.log(`‚úÖ DOCUMENT REPLACED: Reset ${e.length} cards with 1 write operation (${t})`),{success:!0}):{success:!1,error:a.error||"Failed to reset cards using replace document pattern"}}catch(s){return console.error("Error resetting cards batch:",s),{success:!1,error:s instanceof Error?s.message:"Failed to reset cards batch"}}}static async deleteCardSetProgress(e){try{const t=P();if(!t)throw new Error("User must be authenticated to delete card set progress");const s=L(O,"users",t.uid),a=await V(s),n=(a.exists()?a.data():{}).cardSetsProgress||{};return console.log(`Before delete: cardSetsProgress has keys: ${Object.keys(n)}`),console.log(`Deleting progress for cardSetId: ${e}`),delete n[e],console.log(`After delete: cardSetsProgress has keys: ${Object.keys(n)}`),await Vr(s,{updatedAt:j(),cardSetsProgress:n}),console.log(`Successfully deleted progress metadata for card set: ${e}`),{success:!0}}catch(t){return console.error("Error deleting card set progress:",t),{success:!1,error:t instanceof Error?t.message:"Failed to delete card set progress"}}}static async deleteCardSetCollection(e){try{const t=P();if(!t)throw new Error("User must be authenticated to delete card set collection");const s=await os(t.uid,e);return s.success?(console.log(`Successfully deleted card set collection: ${e}`),{success:!0}):{success:!1,error:s.error||"Failed to delete card set collection"}}catch(t){return console.error("Error deleting card set collection:",t),{success:!1,error:t instanceof Error?t.message:"Failed to delete card set collection"}}}static async createFreshCardSetProgress(e,t){try{const s=P();if(!s)throw new Error("User must be authenticated to create card set progress");const a=L(O,"users",s.uid),o=await V(a),l=(o.exists()?o.data():{}).cardSetsProgress||{},c={cardSetId:e,totalCards:t,reviewedCards:0,progressPercentage:0,masteredCards:0,needPracticeCards:0,reviewedToday:0,createdAt:j(),updatedAt:j()};l[e]=c;const f={updatedAt:j(),cardSetsProgress:l};return await q(a,f,{merge:!0}),console.log(`Successfully created fresh progress metadata for card set: ${e} (0/${t} cards)`),{success:!0}}catch(s){return console.error("Error creating fresh card set progress:",s),{success:!1,error:s instanceof Error?s.message:"Failed to create fresh card set progress"}}}static async loadAllCardSetProgress(){try{const e=P();if(!e)return{success:!1,error:"User must be authenticated to load progress from Firestore."};console.log("Loading all card set progress for user");const t=await mo.getAllCardSetProgress(e.uid);if(!t.success)return{success:!1,error:t.error||"Failed to load card set progress"};const s=t.data||{};return console.log(`Loaded progress for ${Object.keys(s).length} card sets`),{success:!0,data:s}}catch(e){return console.error("Error loading all card set progress:",e),{success:!1,error:e instanceof Error?e.message:"Failed to load card set progress"}}}static async saveUserProfile(e){try{const t=P();if(!t)return{success:!1,error:"User must be authenticated to save profile to Firestore."};if(e.uid!==t.uid)return{success:!1,error:"Profile UID must match authenticated user ID."};console.log("Saving user profile for:",t.uid);const s=L(O,"users",t.uid),a={uid:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL,createdAt:e.createdAt||j(),lastLoginAt:j(),preferredLanguage:e.preferredLanguage||"en",theme:e.theme||"system",isActive:e.isActive!==void 0?e.isActive:!0,updatedAt:j()};return e.reviewSessionSize!==void 0&&(a.reviewSessionSize=e.reviewSessionSize),await q(s,a,{merge:!0}),console.log("Successfully saved user profile"),{success:!0}}catch(t){return console.error("Error saving user profile:",t),(t instanceof Error?t.message:"Unknown error").includes("Missing or insufficient permissions")?(console.warn("Firestore rules may not be deployed yet. User profile save failed due to permissions."),{success:!1,error:"Firestore permissions not configured yet. User profile will be created later."}):{success:!1,error:t instanceof Error?t.message:"Failed to save user profile to Firestore"}}}static async loadUserProfile(e){try{const t=P();if(!t)return{success:!1,error:"User must be authenticated to load profile from Firestore."};const s=e||t.uid;if(s!==t.uid)return{success:!1,error:"Can only load own profile data."};console.log("Loading user profile for:",s);const a=L(O,"users",s),o=await V(a);if(!o.exists())return console.log("No user profile found, returning null"),{success:!0,data:null};const n=o.data(),l={uid:n.uid,email:n.email,displayName:n.displayName,photoURL:n.photoURL,createdAt:n.createdAt?.toDate()||new Date,updatedAt:n.updatedAt?.toDate()||new Date,lastLoginAt:n.lastLoginAt?.toDate()||new Date,preferredLanguage:n.preferredLanguage||"en",theme:n.theme||"system",reviewSessionSize:n.reviewSessionSize||void 0,isActive:n.isActive!==void 0?n.isActive:!0};return console.log("Successfully loaded user profile"),{success:!0,data:l}}catch(t){return console.error("Error loading user profile:",t),{success:!1,error:t instanceof Error?t.message:"Failed to load user profile from Firestore"}}}static async updateUserProfile(e){try{const t=P();if(!t)return{success:!1,error:"User must be authenticated to update profile."};console.log("Updating user profile for:",t.uid),console.log("FlashcardService: Update data received:",e);const s=L(O,"users",t.uid),a={...e,updatedAt:j(),uid:t.uid};return console.log("FlashcardService: Update data before cleanup:",a),Object.keys(a).forEach(o=>{a[o]===void 0&&delete a[o]}),await q(s,a,{merge:!0}),console.log("Successfully updated user profile"),{success:!0}}catch(t){return console.error("Error updating user profile:",t),{success:!1,error:t instanceof Error?t.message:"Failed to update user profile"}}}static async migrateGuestToAuthenticatedUser(e,t){try{if(!P())return{success:!1,error:"User must be authenticated to migrate guest data."};if(console.log("Starting guest to authenticated user migration..."),console.log("Guest cards to migrate:",e?.length||0),!e||e.length===0)return console.log("No guest cards found to migrate"),{success:!0,data:{migratedCards:0,migratedProgress:0}};const a=e.filter(c=>c.totalReviews>0||c.easinessFactor!==2.5||c.interval!==1||c.isNew===!1);if(console.log("Cards with meaningful progress:",a.length),a.length===0){console.log("No cards with meaningful progress to migrate - skipping Firestore operations");try{localStorage.removeItem("remember_last_card_set"),console.log("Cleared guest data from localStorage")}catch(c){console.warn("Could not clear localStorage after migration:",c)}return{success:!0,data:{migratedCards:0,migratedProgress:0}}}let o="default";try{const c=localStorage.getItem("remember_last_card_set");c&&(o=JSON.parse(c).id||"default")}catch(c){console.warn("Could not determine card set from localStorage:",c)}const n={cards:a,cardSetId:o,stats:t||{},migrationTimestamp:new Date().toISOString()},l=await this.migrateGuestData(n);if(l.success){try{localStorage.removeItem("remember_last_card_set"),console.log("Cleared guest data from localStorage")}catch(c){console.warn("Could not clear localStorage after migration:",c)}return console.log(`‚úÖ Successfully migrated ${a.length} cards with progress`),{success:!0,data:{migratedCards:e.length,migratedProgress:a.length}}}else return{success:!1,error:l.error||"Migration failed"}}catch(s){return console.error("Error during guest to authenticated migration:",s),{success:!1,error:s instanceof Error?s.message:"Failed to migrate guest data"}}}static async loadUserProfileWithProgress(){try{const e=P();if(!e)return{success:!1,error:"User must be authenticated to load profile from Firestore."};console.log(`Loading optimized profile with consolidated progress for user: ${e.uid}`);const t=await gt.autoMigrateAndLoadProfile(e.uid);return t?(console.log(`Loaded profile with ${Object.keys(t.cardSetsProgress||{}).length} card set progress records`),{success:!0,data:t}):(console.log("No profile found or migration failed"),{success:!0,data:null})}catch(e){return console.error("Error loading optimized profile:",e),{success:!1,error:e instanceof Error?e.message:"Failed to load user profile with progress"}}}static getCardSetProgressFromProfile(e,t){try{const s=t.cardSetsProgress?.[e]||null;return s?(console.log(`Retrieved progress for card set ${e} from consolidated profile`),{success:!0,data:s}):(console.log(`No progress found for card set ${e} in consolidated profile`),{success:!0,data:null})}catch(s){return console.error("Error retrieving progress from profile:",s),{success:!1,error:s instanceof Error?s.message:"Failed to retrieve progress from profile"}}}static async updateCardSetProgressOptimized(e,t){try{const s=P();return s?(console.log(`Updating progress for card set ${e} using optimized method`),await gt.updateCardSetProgress(s.uid,e,t)?(console.log(`Successfully updated progress for card set: ${e}`),{success:!0,data:!0}):{success:!1,error:"Failed to update progress in optimized structure"}):{success:!1,error:"User must be authenticated to update progress in Firestore."}}catch(s){return console.error("Error updating optimized progress:",s),{success:!1,error:s instanceof Error?s.message:"Failed to update card set progress"}}}static async ensureCardSetExists(e,t){try{if(!P())return{success:!1,error:"User must be authenticated to create card sets in Firestore."};console.log(`Ensuring card set exists: ${e}`);const a=await this.loadUserFlashcards(e);if(a.success&&a.data&&a.data.length>0)return console.log(`Card set ${e} already exists with ${a.data.length} cards`),{success:!0,data:!0};console.log(`Card set ${e} does not exist, creating from JSON: ${t}`);const o=await this.loadCardsFromJSON(t);if(!o.success||!o.data)return{success:!1,error:o.error||"Failed to load cards from JSON"};const n=o.data.map(c=>({...c,cardSetId:e,easinessFactor:2.5,repetitions:0,interval:1,nextReviewDate:new Date,lastReviewDate:new Date,totalReviews:0,correctStreak:0,averageQuality:0,createdAt:new Date,updatedAt:new Date,isNew:!0})),l=await this.saveCardsBatch(n,e);if(l.success){console.log(`Pre-populated card set ${e} with ${n.length} cards`);const c={cardSetId:e,totalCards:n.length,reviewedCards:0,progressPercentage:0,masteredCards:0,needPracticeCards:0,reviewedToday:0,createdAt:new Date,updatedAt:new Date},f=await this.updateCardSetProgressOptimized(e,c);return f.success?console.log(`Initialized progress tracking for card set: ${e}`):console.warn(`Card set created but progress initialization failed: ${f.error}`),{success:!0,data:!0}}else return{success:!1,error:l.error||"Failed to save card set batch"}}catch(s){return console.error("Error ensuring card set exists:",s),{success:!1,error:s instanceof Error?s.message:"Failed to ensure card set exists"}}}static getAllCardSetProgressFromProfile(e){try{const t=e.cardSetsProgress||{};return console.log(`Retrieved ${Object.keys(t).length} card set progress records from consolidated profile`),{success:!0,data:t}}catch(t){return console.error("Error retrieving all progress from profile:",t),{success:!1,error:t instanceof Error?t.message:"Failed to retrieve all progress from profile"}}}static async batchUpdateCardSetProgress(e){try{const t=P();if(!t)return{success:!1,error:"User must be authenticated to update progress in Firestore."};console.log(`Batch updating progress for ${Object.keys(e).length} card sets`);const s=L(O,"users",t.uid),a=await V(s),l={...(a.exists()?a.data():{}).cardSetsProgress||{}};Object.entries(e).forEach(([f,d])=>{const u={...d,updatedAt:j()};l[f]=u});const c={updatedAt:j(),cardSetsProgress:l};return await q(s,c,{merge:!0}),console.log(`Successfully batch updated progress for ${Object.keys(e).length} card sets`),{success:!0,data:!0}}catch(t){return console.error("Error in batch progress update:",t),{success:!1,error:t instanceof Error?t.message:"Failed to batch update progress"}}}static async checkMigrationStatus(){try{const e=P();if(!e)return{success:!1,error:"User must be authenticated to check migration status."};const t=await gt.needsMigration(e.uid);return{success:!0,data:{needsMigration:t,reason:t?"User data needs migration to optimized structure":"User already has optimized data structure"}}}catch(e){return console.error("Error checking migration status:",e),{success:!1,error:e instanceof Error?e.message:"Failed to check migration status"}}}static async ensureCardSetExistsWithoutProgress(e,t){try{if(!P())return{success:!1,error:"User must be authenticated to create card sets in Firestore."};console.log(`Ensuring card set exists (without progress): ${e}`);const a=await this.loadUserFlashcards(e);if(a.success&&a.data&&a.data.length>0)return console.log(`Card set ${e} already exists with ${a.data.length} cards`),{success:!0,data:!0};console.log(`Card set ${e} does not exist, creating from JSON: ${t}`);const o=await this.loadCardsFromJSON(t);if(!o.success||!o.data)return{success:!1,error:o.error||"Failed to load cards from JSON"};const n=o.data.map(c=>({...c,cardSetId:e,easinessFactor:2.5,repetitions:0,interval:1,nextReviewDate:new Date,lastReviewDate:new Date,totalReviews:0,correctStreak:0,averageQuality:0,createdAt:new Date,updatedAt:new Date,isNew:!0})),l=await this.saveCardsBatch(n,e);return l.success?(console.log(`Pre-populated card set ${e} with ${n.length} cards (progress will be saved separately)`),{success:!0,data:!0}):{success:!1,error:l.error||"Failed to save card set batch"}}catch(s){return console.error("Error ensuring card set exists without progress:",s),{success:!1,error:s instanceof Error?s.message:"Failed to ensure card set exists"}}}}const ho={user:null,isGuest:!0,migrationStatus:"none",isAuthLoading:!0,authError:null},po=(r,e)=>{switch(e.type){case"SET_USER":{const{user:t,isGuest:s}=e.payload;return{...r,user:t,isGuest:s,isAuthLoading:!1,authError:null}}case"SET_MIGRATION_STATUS":return{...r,migrationStatus:e.payload};case"SET_AUTH_LOADING":return{...r,isAuthLoading:e.payload};case"SET_AUTH_ERROR":return{...r,authError:e.payload,isAuthLoading:!1};case"CLEAR_AUTH_ERROR":return{...r,authError:null};default:return console.warn(`AuthContext: Unknown action type: ${e.type}`),r}},us=x.createContext(null),vo=({children:r})=>{const[e,t]=x.useReducer(po,ho),s=(d,u)=>{console.log("AuthContext: Setting user",{hasUser:!!d,isGuest:u,userId:d?.uid});const m=e.isGuest?"guest":"authenticated";m!==(u?"guest":"authenticated")&&(!u&&d?(H.setAuthenticatedUser(d),H.trackEvent("sign_in",{user_id:d.uid,sign_in_method:d.providerData?.[0]?.providerId||"unknown",is_new_user:d.metadata?.creationTime===d.metadata?.lastSignInTime,timestamp:new Date().toISOString()})):(H.setGuestUser(),m==="authenticated"&&H.trackEvent("sign_out",{previous_user_type:"authenticated",timestamp:new Date().toISOString()}))),t({type:"SET_USER",payload:{user:d,isGuest:u}})},a=d=>{console.log("AuthContext: Setting migration status",d),t({type:"SET_MIGRATION_STATUS",payload:d})},o=d=>{t({type:"SET_AUTH_LOADING",payload:d})},n=d=>{d&&console.error("AuthContext: Auth error occurred",d),t({type:"SET_AUTH_ERROR",payload:d})},l=()=>{t({type:"CLEAR_AUTH_ERROR"})},c=async()=>{try{o(!0),H.trackEvent("sign_out_initiated",{user_type:e.isGuest?"guest":"authenticated",user_id:e.user?.uid||null,timestamp:new Date().toISOString()});const d=await ts();if(!d.success)throw H.trackEvent("sign_out_failed",{error_message:d.error||"Unknown error",timestamp:new Date().toISOString()}),new Error(d.error||"Sign out failed");console.log("AuthContext: User signed out successfully"),H.trackEvent("sign_out_success",{timestamp:new Date().toISOString()})}catch(d){throw console.error("AuthContext: Error signing out",d),H.trackEvent("sign_out_error",{error_message:d instanceof Error?d.message:"Unknown error",timestamp:new Date().toISOString()}),n(`Failed to sign out: ${d instanceof Error?d.message:"Unknown error"}`),d}finally{o(!1)}};x.useEffect(()=>{console.log("AuthContext: Setting up auth state listener"),H.trackEvent("auth_listener_initialized",{timestamp:new Date().toISOString()});const d=eo(async u=>{if(console.log("AuthContext: Auth state changed",{hasUser:!!u,userId:u?.uid}),H.trackEvent("auth_state_changed",{has_user:!!u,user_id:u?.uid||null,timestamp:new Date().toISOString()}),u){try{o(!0);const m=Lt(u),g=await T.saveUserProfile(m);g.success?(console.log("AuthContext: Successfully auto-saved user profile on sign in"),H.trackEvent("user_profile_auto_saved",{user_id:u.uid,timestamp:new Date().toISOString()})):(console.warn("AuthContext: Failed to auto-save user profile:",g.error),H.trackEvent("user_profile_save_failed",{user_id:u.uid,error_message:g.error||"Unknown error",timestamp:new Date().toISOString()}))}catch(m){console.error("AuthContext: Error during profile auto-save:",m),H.trackEvent("user_profile_save_exception",{user_id:u.uid,error_message:m instanceof Error?m.message:"Unknown error",timestamp:new Date().toISOString()})}finally{o(!1)}s(u,!1)}else s(null,!0)});return()=>{console.log("AuthContext: Cleaning up auth state listener"),H.trackEvent("auth_listener_cleanup",{timestamp:new Date().toISOString()}),d()}},[]);const f={state:e,dispatch:t,setUser:s,setMigrationStatus:a,setAuthLoading:o,setAuthError:n,clearAuthError:l,signOut:c};return i.jsx(us.Provider,{value:f,children:r})},rt=()=>{const r=x.useContext(us);if(!r)throw new Error("useAuth must be used within an AuthProvider. Make sure your component is wrapped in an AuthProvider.");return r},yo=(r,e=new Date)=>r.nextReviewDate<=e,Te=r=>{const e=new Date;return r.filter(t=>yo(t,e))},Qe=r=>{const e=r.length,t=Te(r).length;let s=0,a=0,o=0;r.forEach(l=>{l.repetitions>=1&&l.easinessFactor>=2&&!l.isNew&&s++,l.easinessFactor<2.2&&l.totalReviews>0&&a++,o+=l.totalReviews});const n=bo(r);return{totalCards:e,dueCards:t,masteredCards:s,difficultCards:a,reviewsToday:n,totalReviews:o,averageEasinessFactor:r.length>0?r.reduce((l,c)=>l+c.easinessFactor,0)/r.length:0,averageQuality:r.length>0?r.reduce((l,c)=>l+c.averageQuality,0)/r.length:0}},xo=(r,e=new Date)=>!r.lastReviewDate||!(r.lastReviewDate instanceof Date)||r.isNew||r.totalReviews===0?!1:r.lastReviewDate.toDateString()===e.toDateString(),bo=(r,e=new Date)=>r.filter(s=>xo(s,e)).length,fs=(r,e)=>{const t=r.length,s=r.filter(u=>u.totalReviews>0).length,a=r.filter(u=>u.easinessFactor>=2.5&&u.interval>=21).length,o=s-a,n=new Date,l=new Date(n.getFullYear(),n.getMonth(),n.getDate()),c=r.filter(u=>u.lastReviewDate?new Date(u.lastReviewDate)>=l:!1).length,f=t>0?Math.round(s/t*100):0,d=new Date;return{cardSetId:e,totalCards:t,reviewedCards:s,progressPercentage:f,masteredCards:a,needPracticeCards:o,reviewedToday:c,createdAt:d,updatedAt:d}},So=(r,e)=>{switch(e.type){case"START_REVIEW_SESSION":{const t=e.payload;return t.length===0?{}:{currentSession:{cards:[...t],currentIndex:0,isShowingBack:!1,isComplete:!1,startTime:new Date,totalCards:t.length,reviewedCards:0,easyCount:0,hardCount:0,againCount:0,reviewedCardIds:new Set,pendingProgress:new Map},currentCard:t[0],isShowingBack:!1}}case"SHOW_CARD_BACK":return{isShowingBack:!0};case"RATE_CARD":{if(!r.currentSession||!r.currentCard)return{};const{cardId:t,quality:s}=e.payload,a=r.currentCard;if(s===pe.SKIP){const S={...r.currentSession};S.againCount++,S.cards.push(a);const C=r.currentSession.currentIndex+1,A=C>=S.cards.length;let N=null;return!A&&C<S.cards.length&&(N=S.cards[C]),{currentSession:A?{...S,isComplete:!0}:{...S,currentIndex:C},currentCard:N,isShowingBack:!1}}const o={...a,...Ka(a,s),updatedAt:new Date,isNew:!1},n=r.allCards.map(S=>S.id===t?o:S),l={...r.currentSession};l.pendingProgress=new Map(r.currentSession.pendingProgress);const c={easinessFactor:o.easinessFactor,repetitions:o.repetitions,interval:o.interval,nextReviewDate:o.nextReviewDate,lastReviewDate:new Date,totalReviews:(a.totalReviews||0)+1,correctStreak:s>=pe.HARD?(a.correctStreak||0)+1:0,averageQuality:((a.averageQuality||3)*(a.totalReviews||0)+s)/((a.totalReviews||0)+1),isNew:!1,updatedAt:new Date};l.pendingProgress.set(t,c),s===pe.HARD?(l.hardCount++,l.reviewedCardIds.add(t),l.reviewedCards=l.reviewedCardIds.size):(l.easyCount++,l.reviewedCardIds.add(t),l.reviewedCards=l.reviewedCardIds.size);const f=r.currentSession.currentIndex+1,d=f>=l.cards.length;let u=null;!d&&f<l.cards.length&&(u=l.cards[f]);const m=Te(n),g=Qe(n);return{allCards:n,dueCards:m,currentSession:d?{...l,isComplete:!0}:{...l,currentIndex:f},currentCard:u,isShowingBack:!1,stats:{totalCards:g.totalCards,dueCards:g.dueCards,masteredCards:g.masteredCards,difficultCards:g.difficultCards,reviewsToday:r.stats.reviewsToday+1}}}case"NEXT_CARD":{if(!r.currentSession)return{};const t=r.currentSession.currentIndex+1;if(t>=r.currentSession.cards.length)return{currentSession:{...r.currentSession,isComplete:!0},currentCard:null,isShowingBack:!1};const a=r.currentSession.cards[t];return{currentSession:{...r.currentSession,currentIndex:t},currentCard:a,isShowingBack:!1}}case"COMPLETE_SESSION":{const t=Te(r.allCards),s=Qe(r.allCards);return{dueCards:t,stats:{totalCards:s.totalCards,dueCards:s.dueCards,masteredCards:s.masteredCards,difficultCards:s.difficultCards,reviewsToday:r.stats.reviewsToday}}}case"RESET_SESSION":return{currentSession:null,currentCard:null,isShowingBack:!1};default:return{}}},wo=(r,e)=>{switch(e.type){case"LOAD_CARDS":{const t=e.payload,s=Te(t),a=Qe(t);return console.log("CardReducer: LOAD_CARDS - Stats calculated:",{cardsCount:t.length,stats:{totalCards:a.totalCards,dueCards:a.dueCards,masteredCards:a.masteredCards,difficultCards:a.difficultCards,reviewsToday:a.reviewsToday},sampleCard:t[0]?{id:t[0].id,isNew:t[0].isNew,totalReviews:t[0].totalReviews,repetitions:t[0].repetitions,easinessFactor:t[0].easinessFactor}:null}),{allCards:t,dueCards:s,stats:{totalCards:a.totalCards,dueCards:a.dueCards,masteredCards:a.masteredCards,difficultCards:a.difficultCards,reviewsToday:a.reviewsToday},isLoading:!1}}case"SET_LOADING":return{isLoading:e.payload};case"UPDATE_STATS":{const t=Qe(r.allCards);return{dueCards:Te(r.allCards),stats:{totalCards:t.totalCards,dueCards:t.dueCards,masteredCards:t.masteredCards,difficultCards:t.difficultCards,reviewsToday:t.reviewsToday}}}case"RESET_PROGRESS":return{currentSession:null,currentCard:null,isShowingBack:!1};default:return{}}},Co=(r,e)=>{switch(e.type){case"SET_LOADING_STATE":{const{key:t,value:s}=e.payload;return{loadingStates:{...r.loadingStates,[t]:s}}}case"SET_DATA_SOURCE":return{dataSource:e.payload};case"SET_SYNC_STATUS":return{syncStatus:e.payload};case"SET_LAST_SYNC_TIME":return{lastSyncTime:e.payload};case"INCREMENT_PROGRESS_VERSION":return{progressVersion:r.progressVersion+1};case"SET_ERROR":return{error:e.payload};case"CLEAR_ERROR":return{error:null};case"ADD_PENDING_OPERATION":return{pendingOperations:[...r.pendingOperations,e.payload]};case"REMOVE_PENDING_OPERATION":return{pendingOperations:r.pendingOperations.filter(t=>t.id!==e.payload)};case"RETRY_PENDING_OPERATIONS":return{pendingOperations:r.pendingOperations.map(t=>({...t,retryCount:0}))};case"SET_MIGRATION_STATUS":return{migrationStatus:e.payload};case"SET_USER":{const{user:t,isGuest:s}=e.payload;return{user:t,isGuest:s}}case"SET_SELECTED_CARD_SET":return{...r,selectedCardSet:e.payload};case"SET_LAST_WORKING_CARD_SET":return{lastWorkingCardSet:e.payload?{id:e.payload.id,name:e.payload.name,cover:e.payload.cover,dataFile:e.payload.dataFile}:null};case"UPDATE_CARD_SET_PROGRESS_OPTIMISTIC":return{syncStatus:"syncing",lastSyncTime:new Date};case"CLEAR_CACHE":return{syncStatus:"idle",dataSource:"session",lastSyncTime:null,error:null};case"INITIALIZE_CACHE":return{dataSource:"firestore",syncStatus:"idle",lastSyncTime:new Date};case"SYNC_CACHE_STATE":return{syncStatus:"idle",lastSyncTime:new Date};default:return{}}},Eo=(r,e)=>{if(e.type==="START_REVIEW_SESSION"||e.type==="SHOW_CARD_BACK"||e.type==="RATE_CARD"||e.type==="NEXT_CARD"||e.type==="COMPLETE_SESSION"||e.type==="RESET_SESSION"){const t=So(r,e);return{...r,...t}}if(e.type==="LOAD_CARDS"||e.type==="UPDATE_STATS"||e.type==="RESET_PROGRESS"||e.type==="SET_LOADING"){const t=wo(r,e);return{...r,...t}}if(e.type==="SET_LOADING_STATE"||e.type==="SET_DATA_SOURCE"||e.type==="SET_SYNC_STATUS"||e.type==="SET_LAST_SYNC_TIME"||e.type==="INCREMENT_PROGRESS_VERSION"||e.type==="SET_ERROR"||e.type==="CLEAR_ERROR"||e.type==="ADD_PENDING_OPERATION"||e.type==="REMOVE_PENDING_OPERATION"||e.type==="RETRY_PENDING_OPERATIONS"||e.type==="SET_MIGRATION_STATUS"||e.type==="SET_USER"||e.type==="SET_SELECTED_CARD_SET"||e.type==="SET_LAST_WORKING_CARD_SET"||e.type==="UPDATE_CARD_SET_PROGRESS_OPTIMISTIC"||e.type==="CLEAR_CACHE"||e.type==="INITIALIZE_CACHE"||e.type==="SYNC_CACHE_STATE"){const t=Co(r,e);return{...r,...t}}return console.warn(`Unknown action type: ${e.type}`),r},Ao=r=>{const{state:e,dispatch:t,setLoadingState:s,setSyncStatus:a,setDataSource:o,setError:n,clearError:l}=r,c=async()=>{try{s("fetchingCards",!0),a("syncing"),l();let p=e.selectedCardSet;p||(p={id:"chinese_essentials_1",name:"Chinese Essentials 1",description:"Basic everyday communication",cover:"üá®üá≥",cardCount:0,category:"language_basics",tags:["chinese","communication","beginner"],dataFile:"chinese_essentials_in_communication_1.json",author:"HSK Learning Team",isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},console.log("Using default card set as fallback:",p.name));const y=await T.loadCardSetData(p.id,p.dataFile);if(y.success&&y.data)t({type:"LOAD_CARDS",payload:y.data.cards}),o(y.data.source==="firestore"?"firestore":"fallback"),a("idle"),t({type:"SET_LAST_SYNC_TIME",payload:new Date}),console.log(`Loaded ${y.data.cards.length} cards from ${y.data.source} for card set: ${p.name}`);else throw new Error(y.error||"Failed to load cards")}catch(p){console.error("Error loading cards:",p),n(p instanceof Error?p.message:"Failed to load cards"),a("error"),o("fallback")}finally{s("fetchingCards",!1)}},f=async p=>{try{s("savingProgress",!0),a("syncing"),l();let y=e.selectedCardSet;y||(y={id:"chinese_essentials_1",name:"Chinese Essentials 1",description:"Basic everyday communication",cover:"üá®üá≥",cardCount:0,category:"language_basics",tags:["chinese","communication","beginner"],dataFile:"chinese_essentials_in_communication_1.json",author:"HSK Learning Team",isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});const R=await T.saveCard(p,y.id);if(R.success)a("idle"),t({type:"SET_LAST_SYNC_TIME",payload:new Date}),console.log(`Saved card ${p.id} to Firestore in card set: ${y.name}`);else throw new Error(R.error||"Failed to save card to Firestore")}catch(y){console.error("Error saving card to Firestore:",y),n(y instanceof Error?y.message:"Failed to save card to Firestore"),a("error");const R=T.createPendingOperation("add_card",{...p,cardSetId:e.selectedCardSet?.id});t({type:"ADD_PENDING_OPERATION",payload:R})}finally{s("savingProgress",!1)}},d=async(p,y)=>{try{s("savingProgress",!0),a("syncing"),l();let R=e.selectedCardSet;R||(R={id:"chinese_essentials_1",name:"Chinese Essentials 1",description:"Basic everyday communication",cover:"üá®üá≥",cardCount:0,category:"language_basics",tags:["chinese","communication","beginner"],dataFile:"chinese_essentials_in_communication_1.json",author:"HSK Learning Team",isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});const b=await T.saveProgress(p,R.id,y);if(b.success)a("idle"),t({type:"SET_LAST_SYNC_TIME",payload:new Date}),console.log(`Updated progress for card ${p} in Firestore (card set: ${R.name})`);else throw new Error(b.error||"Failed to save progress to Firestore")}catch(R){console.error("Error saving progress to Firestore:",R),n(R instanceof Error?R.message:"Failed to save progress to Firestore"),a("error");const b=T.createPendingOperation("rate_card",{cardId:p,cardSetId:e.selectedCardSet?.id,progressData:y});t({type:"ADD_PENDING_OPERATION",payload:b})}finally{s("savingProgress",!1)}},u=async p=>{try{s("migrating",!0),t({type:"SET_MIGRATION_STATUS",payload:"in-progress"}),a("syncing"),l();const y=await T.migrateGuestToAuthenticatedUser(p.cards||[],p.stats);if(y.success)t({type:"SET_MIGRATION_STATUS",payload:"completed"}),a("idle"),o("firestore"),console.log(`‚úÖ Successfully migrated guest data: ${y.data?.migratedCards} cards, ${y.data?.migratedProgress} with progress`);else throw new Error(y.error||"Failed to migrate data to Firestore")}catch(y){console.error("Error migrating data to Firestore:",y),n(y instanceof Error?y.message:"Failed to migrate data to Firestore"),t({type:"SET_MIGRATION_STATUS",payload:"failed"}),a("error")}finally{s("migrating",!1)}},m=async p=>{try{if(e.isGuest)return console.log("Guest mode: Cannot load card set progress from Firestore"),null;const y=await T.loadCardSetProgress(p);return y.success&&y.data!==void 0?y.data:(console.warn("Failed to load card set progress:",y.error),null)}catch(y){return console.error("Error loading card set progress:",y),null}},g=async p=>{try{if(e.isGuest){console.log("Guest mode: Cannot save card set progress to Firestore");return}s("savingProgress",!0),a("syncing"),l();const y=await T.saveCardSetProgress(p);if(y.success)console.log(`Successfully saved progress for card set: ${p.cardSetId}`),a("idle");else throw new Error(y.error||"Failed to save card set progress")}catch(y){console.error("Error saving card set progress:",y),n(y instanceof Error?y.message:"Failed to save progress"),a("error")}finally{s("savingProgress",!1)}},S=async()=>{try{if(console.log("updateCurrentCardSetProgress called:",{isGuest:e.isGuest,user:e.user?.uid||"none",selectedCardSet:e.selectedCardSet?.id||"none",allCardsCount:e.allCards.length}),e.isGuest||!e.selectedCardSet){console.log("Guest mode or no card set: Cannot update progress");return}if(!e.user){console.log("No authenticated user found: Cannot update progress");return}const p=fs(e.allCards,e.selectedCardSet.id);console.log(`Updating progress for ${e.selectedCardSet.name}: ${p.progressPercentage}% (${p.reviewedCards}/${p.totalCards})`),await g(p)}catch(p){console.error("Error updating current card set progress:",p),n(p instanceof Error?p.message:"Failed to update progress")}},C=x.useCallback(async()=>{try{if(e.isGuest)return console.log("Guest mode: Cannot load card set progress from Firestore"),{};if(!e.user)return console.log("No authenticated user: Cannot load card set progress"),{};s("fetchingCards",!0),l();const p=await T.loadAllCardSetProgress();if(p.success&&p.data){const y={};return Object.values(p.data).forEach(R=>{y[R.cardSetId]=R.progressPercentage}),console.log(`Loaded progress for ${Object.keys(y).length} card sets`),y}else return console.warn("No card set progress found:",p.error),{}}catch(p){return console.error("Error loading all card set progress:",p),n(p instanceof Error?p.message:"Failed to load progress"),{}}finally{s("fetchingCards",!1)}},[e.isGuest,e.user,e.progressVersion,s,l,n]),A=x.useCallback(async()=>{try{if(e.isGuest||!e.user)return console.log("Guest mode: Cannot load user profile from Firestore"),null;s("fetchingCards",!0),l();const p=await T.loadUserProfile();return p.success?(console.log("Successfully loaded user profile from Firestore"),p.data):(console.warn("Failed to load user profile:",p.error),null)}catch(p){return console.error("Error loading user profile:",p),n(p instanceof Error?p.message:"Failed to load user profile"),null}finally{s("fetchingCards",!1)}},[e.isGuest,e.user,s,l,n]),N=x.useCallback(async p=>{try{if(e.isGuest||!e.user)return console.log("Guest mode: Cannot update user profile in Firestore"),!1;s("savingProgress",!0),a("syncing"),l();const y=await T.updateUserProfile(p);if(y.success)return console.log("Successfully updated user profile in Firestore"),a("idle"),!0;throw new Error(y.error||"Failed to update user profile")}catch(y){return console.error("Error updating user profile:",y),a("error"),n(y instanceof Error?y.message:"Failed to update user profile"),!1}finally{s("savingProgress",!1)}},[e.isGuest,e.user,s,a,l,n]);return{loadCardsFromFirestore:c,saveCardToFirestore:f,saveProgressToFirestore:d,migrateGuestDataToFirestore:u,loadCardSetProgress:m,saveCardSetProgress:g,updateCurrentCardSetProgress:S,loadAllCardSetProgress:C,loadUserProfile:A,updateUserProfile:N}},No=(r,e,t)=>{const s=e.map(o=>{const n=r.get(o.id);return n?{...o,...n,id:o.id,front:o.front,back:o.back,cardSetId:o.cardSetId}:o});return{...fs(s,t),updatedAt:new Date}},Do=(r,e,t)=>{const s=[],a=t.filter(f=>f.totalReviews>0).length,o=Array.from(e.keys()).filter(f=>{const d=t.find(u=>u.id===f);return d&&d.totalReviews===0}).length,n=a+o,l=r.reviewedCards,c=e.size;return r.totalCards!==t.length&&s.push(`Total cards mismatch: expected ${t.length}, got ${r.totalCards}`),l<a&&s.push(`Reviewed cards decreased: was ${a}, now ${l}`),(r.progressPercentage>100||r.progressPercentage<0)&&s.push(`Invalid progress percentage: ${r.progressPercentage}%`),{isValid:s.length===0,errors:s,details:{expectedReviewedCards:n,actualReviewedCards:l,reviewedInSession:c}}},Po=(r,e,t)=>{const s=r?.reviewedCards||0,a=e.reviewedCards,o=a-s,n=t.size,l=r?e.progressPercentage-r.progressPercentage:e.progressPercentage;return`Review session completed: ${n} cards reviewed, ${o} new cards learned, progress increased by ${l.toFixed(1)}% (${s}‚Üí${a}/${e.totalCards})`},Ro=r=>{const{state:e,dispatch:t,setLoadingState:s,setSyncStatus:a,setError:o,clearError:n,loadCardSetData:l}=r,c=async u=>{if(e.currentCard){const m=e.currentCard;t({type:"RATE_CARD",payload:{cardId:m.id,quality:u}}),console.log("Card rated:",m.id,"quality:",u,"batch save will occur at session completion")}};return{rateCard:c,knowCard:async()=>{await c(pe.EASY)},resetProgress:async()=>{try{if(s("savingProgress",!0),n(),!e.isGuest&&e.dataSource==="firestore"){if(a("syncing"),!P()){o("User must be authenticated to reset progress in Firestore.");return}if(!e.selectedCardSet){o("No card set selected to reset.");return}const m=await T.deleteCardSetCollection(e.selectedCardSet.id);if(!m.success)throw new Error(m.error||"Failed to delete card set collection");const g=await T.deleteCardSetProgress(e.selectedCardSet.id);g.success||console.warn(`Failed to delete progress metadata for ${e.selectedCardSet.id}: ${g.error}`),console.log(`Successfully reset all progress for card set: ${e.selectedCardSet.name}`),a("idle");const S=await T.loadCardsFromJSON(e.selectedCardSet.dataFile);if(!S.success||!S.data)throw new Error("Failed to load fresh card data for local state")}t({type:"RESET_PROGRESS"}),t({type:"INCREMENT_PROGRESS_VERSION"}),e.selectedCardSet?.dataFile&&(await l(e.selectedCardSet.dataFile),console.log("Successfully reloaded fresh card data"))}catch(u){console.error("Error resetting progress:",u),o(u instanceof Error?u.message:"Failed to reset progress"),a("error")}finally{s("savingProgress",!1)}}}},Gt="remember_last_card_set",jo=r=>{try{const e=JSON.stringify(r);localStorage.setItem(Gt,e),console.log("CardSetPersistence: Saved card set to localStorage",r.name)}catch(e){console.warn("CardSetPersistence: Failed to save card set to localStorage",e)}},Fo=()=>{try{const r=localStorage.getItem(Gt);if(!r)return console.log("CardSetPersistence: No stored card set found"),null;const e=JSON.parse(r);if(!e.id||!e.name||!e.cover||!e.dataFile)return console.warn("CardSetPersistence: Stored card set data is incomplete, ignoring"),null;const t="description"in e&&"cardCount"in e;return console.log(`CardSetPersistence: Loaded ${t?"complete":"minimal"} card set from localStorage`,e.name),console.log("CardSetPersistence: Loaded card set from localStorage",e.name),e}catch(r){return console.warn("CardSetPersistence: Failed to load card set from localStorage",r),_o(),null}},_o=()=>{try{localStorage.removeItem(Gt),console.log("CardSetPersistence: Cleared stored card set")}catch(r){console.warn("CardSetPersistence: Failed to clear stored card set",r)}},Be=()=>{try{return typeof localStorage<"u"}catch{return!1}};class Wt{static instance=null;cache;syncQueue=[];syncTimer=null;SYNC_INTERVAL=3e4;MAX_RETRY_ATTEMPTS=3;constructor(){this.cache=this.initializeCache()}static getInstance(){return this.instance||(this.instance=new Wt),this.instance}initializeCache(){return{userProfileWithProgress:null,cardSets:{},lastSyncTime:null,isDirty:!1,readOperationCount:0,writeOperationCount:0}}async loadUserProfileWithProgress(){try{console.log("üöÄ Loading user profile with consolidated progress (1 read operation)");const e=await T.loadUserProfileWithProgress();return this.cache.readOperationCount++,e.success&&e.data?(this.cache.userProfileWithProgress=e.data,this.cache.lastSyncTime=new Date,this.cache.isDirty=!1,console.log(`‚úÖ Profile cached with ${Object.keys(e.data.cardSetsProgress).length} card set progress records`),{success:!0,profile:e.data}):(console.log("‚ö†Ô∏è No profile found or load failed"),{success:!1,profile:null,error:e.error||"Failed to load profile"})}catch(e){return console.error("‚ùå Error loading user profile:",e),{success:!1,profile:null,error:e instanceof Error?e.message:"Unknown error"}}}getCardSetProgress(e){if(!this.cache.userProfileWithProgress)return console.log(`‚ö†Ô∏è No cached profile available for card set: ${e}`),{success:!1,progress:null,servedFromCache:!1};const t=this.cache.userProfileWithProgress.cardSetsProgress[e]||null;return console.log(t?`üéØ Served progress for ${e} from cache (0 reads)`:`üì≠ No progress found in cache for ${e}`),{success:!0,progress:t,servedFromCache:!0}}getAllCardSetProgress(){if(!this.cache.userProfileWithProgress)return{success:!1,progressMap:{},servedFromCache:!1};const e=this.cache.userProfileWithProgress.cardSetsProgress;return console.log(`üéØ Served ${Object.keys(e).length} progress records from cache (0 reads)`),{success:!0,progressMap:e,servedFromCache:!0}}updateCardSetProgressOptimistic(e,t){if(!this.cache.userProfileWithProgress){console.warn("‚ö†Ô∏è Cannot update progress: no cached profile");return}console.log(`‚ö° Optimistic update for ${e}`);const s={...t,updatedAt:new Date};this.cache.userProfileWithProgress.cardSetsProgress[e]=s,this.cache.isDirty=!0,this.queueSyncOperation({type:"progress",cardSetId:e,data:t,timestamp:new Date}),this.scheduleBatchSync()}cacheCardSetData(e,t){this.cache.cardSets[e]=t,console.log(`üì¶ Cached ${t.length} cards for card set: ${e}`)}getCachedCardSetData(e){const t=this.cache.cardSets[e]||null;return t&&console.log(`üéØ Served ${t.length} cards from cache for ${e}`),t}queueSyncOperation(e){e.cardSetId&&(this.syncQueue=this.syncQueue.filter(t=>!(t.type===e.type&&t.cardSetId===e.cardSetId))),this.syncQueue.push(e),console.log(`üìã Queued ${e.type} operation (queue size: ${this.syncQueue.length})`)}scheduleBatchSync(){this.syncTimer&&clearTimeout(this.syncTimer),this.syncTimer=setTimeout(()=>{this.performBatchSync()},this.SYNC_INTERVAL),console.log(`‚è∞ Batch sync scheduled in ${this.SYNC_INTERVAL/1e3} seconds`)}async performBatchSync(){if(this.syncQueue.length===0){console.log("üì≠ No operations to sync");return}console.log(`üîÑ Performing batch sync of ${this.syncQueue.length} operations`);const e={};this.syncQueue.forEach(t=>{t.type==="progress"&&t.cardSetId&&(e[t.cardSetId]=t.data)});try{if(Object.keys(e).length>0){const t=await T.batchUpdateCardSetProgress(e);if(this.cache.writeOperationCount++,t.success)console.log(`‚úÖ Batch sync completed for ${Object.keys(e).length} progress updates`),this.cache.isDirty=!1,this.cache.lastSyncTime=new Date;else throw new Error(t.error||"Batch update failed")}this.syncQueue=[]}catch(t){console.error("‚ùå Batch sync failed:",t),this.syncQueue.forEach(s=>{s.retryCount=(s.retryCount||0)+1}),this.syncQueue=this.syncQueue.filter(s=>(s.retryCount||0)<this.MAX_RETRY_ATTEMPTS),this.syncQueue.length>0&&(console.log(`üîÑ Retrying ${this.syncQueue.length} failed operations`),setTimeout(()=>this.performBatchSync(),5e3))}}async forceSyncNow(){this.syncTimer&&(clearTimeout(this.syncTimer),this.syncTimer=null);try{return await this.performBatchSync(),!0}catch(e){return console.error("‚ùå Force sync failed:",e),!1}}isDirty(){return this.cache.isDirty}getCacheStats(){return{readOperations:this.cache.readOperationCount,writeOperations:this.cache.writeOperationCount,cachedCardSets:Object.keys(this.cache.cardSets).length,hasProfile:!!this.cache.userProfileWithProgress,lastSyncTime:this.cache.lastSyncTime,isDirty:this.cache.isDirty,queueSize:this.syncQueue.length}}clearCache(){console.log("üóëÔ∏è Clearing cache"),this.syncTimer&&(clearTimeout(this.syncTimer),this.syncTimer=null),this.cache=this.initializeCache(),this.syncQueue=[]}getCachedUserProfile(){return this.cache.userProfileWithProgress}async initializeCacheForUser(){console.log("üöÄ Initializing cache for user session");const e=await this.loadUserProfileWithProgress();return e.success&&e.profile?(console.log("‚úÖ Cache initialization successful"),!0):(console.log("‚ö†Ô∏è Cache initialization failed:",e.error),!1)}async preloadCardSets(e){console.log(`üì¶ Preloading ${e.length} card sets`);for(const t of e)if(!this.cache.cardSets[t])try{await T.ensureCardSetExists(t,`${t}.json`);const s=await T.loadUserFlashcards(t);s.success&&s.data&&this.cacheCardSetData(t,s.data)}catch(s){console.warn(`‚ö†Ô∏è Failed to preload card set ${t}:`,s)}}}const ce=Wt.getInstance(),ko=()=>{if(Be()){const e=Fo();if(e)return console.log("FlashcardContext: Restored card set from localStorage",e.name),e}const r={id:"chinese_essentials_1",name:"Chinese Essentials 1",description:"Basic everyday communication",cover:"üá®üá≥",cardCount:50,category:"language_basics",tags:["chinese","communication","beginner"],dataFile:"chinese_essentials_in_communication_1.json",author:"Test Author",isActive:!0,createdAt:"2024-01-01T00:00:00Z",updatedAt:"2024-01-01T00:00:00Z"};return console.log("FlashcardContext: Using default card set",r.name),r},To={allCards:[],dueCards:[],currentSession:null,currentCard:null,selectedCardSet:null,availableCardSets:[],lastWorkingCardSet:null,isLoading:!0,isShowingBack:!1,loadingStates:{fetchingCards:!1,savingProgress:!1,creatingCard:!1,deletingCard:!1,migrating:!1},dataSource:"session",syncStatus:"idle",lastSyncTime:null,progressVersion:0,error:null,pendingOperations:[],migrationStatus:"none",stats:{totalCards:0,dueCards:0,masteredCards:0,difficultCards:0,reviewsToday:0},isGuest:!0,user:null},gs=x.createContext(null),Oo=({children:r})=>{const[e,t]=x.useReducer(Eo,To),s=async h=>{try{console.log(`FlashcardContext: Loading card set data from ${h}`),t({type:"SET_LOADING",payload:!0});const w=await we(h);try{or(w)}catch(z){throw ft("CARD_SET_INVALID_DATA",e.selectedCardSet?.id,h,z)}const k=w.map(z=>Ce(z,"default"));if(k.length===0)throw ft("CARD_SET_EMPTY",e.selectedCardSet?.id,h);t({type:"LOAD_CARDS",payload:k}),console.log(`FlashcardContext: Successfully loaded ${k.length} cards from ${h}`),e.selectedCardSet&&t({type:"SET_LAST_WORKING_CARD_SET",payload:e.selectedCardSet})}catch(w){console.error(`FlashcardContext: Error loading card set data from ${h}:`,w);const k=Qa(w),z=ft(k,e.selectedCardSet?.id,h,w);if(t({type:"SET_ERROR",payload:z}),e.lastWorkingCardSet&&e.lastWorkingCardSet.dataFile!==h){console.log(`FlashcardContext: Attempting fallback to last working card set: ${e.lastWorkingCardSet.name}`);try{const Y=await we(e.lastWorkingCardSet.dataFile);or(Y);const re=Y.map(X=>Ce(X,"default"));if(re.length>0){if(t({type:"LOAD_CARDS",payload:re}),e.lastWorkingCardSet){const X={id:e.lastWorkingCardSet.id,name:e.lastWorkingCardSet.name,description:"",cover:e.lastWorkingCardSet.cover,cardCount:re.length,category:"",tags:[],dataFile:e.lastWorkingCardSet.dataFile,author:"",isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};t({type:"SET_SELECTED_CARD_SET",payload:X})}console.log(`FlashcardContext: Successfully fell back to ${e.lastWorkingCardSet.name}`);return}}catch(Y){console.error("FlashcardContext: Fallback to last working card set also failed:",Y)}}console.log("FlashcardContext: Falling back to default flashcard data");try{const re=(await we("flashcards.json")).map(X=>Ce(X,"default"));t({type:"LOAD_CARDS",payload:re})}catch(Y){console.error("Failed to load default flashcard data:",Y),t({type:"LOAD_CARDS",payload:[]})}}finally{t({type:"SET_LOADING",payload:!1})}};x.useEffect(()=>{if(!e.selectedCardSet){const h=ko();if("description"in h&&"cardCount"in h)t({type:"SET_SELECTED_CARD_SET",payload:h});else{const w={id:h.id,name:h.name,description:"Basic everyday communication",cover:h.cover,cardCount:50,category:"language_basics",tags:["chinese","communication","beginner"],dataFile:h.dataFile,author:"Test Author",isActive:!0,createdAt:"2024-01-01T00:00:00Z",updatedAt:"2024-01-01T00:00:00Z"};t({type:"SET_SELECTED_CARD_SET",payload:w})}}},[]);const{state:a}=rt();x.useEffect(()=>{if(console.log("FlashcardContext: AuthContext state changed",a),!a.isGuest&&a.user){const h={uid:a.user.uid,email:a.user.email,displayName:a.user.displayName,photoURL:a.user.photoURL,isGuest:!1};console.log("FlashcardContext: Syncing with AuthContext - User signed in"),e.isGuest&&e.allCards.length>0&&(console.log("FlashcardContext: Detected guest data, initiating migration..."),b({cards:e.allCards,stats:e.stats,selectedCardSet:e.selectedCardSet})),N(h,!1)}else a.isAuthLoading?console.log("FlashcardContext: AuthContext is loading, waiting..."):(console.log("FlashcardContext: Syncing with AuthContext - Guest mode"),N(null,!0),m("session"))},[a.isGuest,a.user?.uid,a.isAuthLoading]),x.useEffect(()=>{(async()=>{if(!e.isGuest&&e.user&&!a.isAuthLoading&&(e.dataSource==="session"||e.dataSource==="fallback")&&e.selectedCardSet?.dataFile&&e.allCards.length>0){console.log("FlashcardContext: Force reloading cards from Firestore after authentication");try{await y()}catch(w){console.error("Failed to reload cards after authentication:",w)}}})()},[e.isGuest,e.user?.uid,a.isAuthLoading,e.dataSource]),x.useEffect(()=>{(async()=>{if(console.log("FlashcardContext: Checking condition for profile loading",{isGuest:e.isGuest,userUid:e.user?.uid,conditionResult:!e.isGuest&&e.user?.uid}),!e.isGuest&&e.user?.uid){if(e.user.reviewSessionSize!==void 0){console.log("FlashcardContext: Profile already has reviewSessionSize, skipping load");return}try{console.log("FlashcardContext: Loading user profile from Firestore");const w=await sr();if(console.log("FlashcardContext: Loaded profile:",w),console.log("FlashcardContext: Profile reviewSessionSize:",w?.reviewSessionSize),w){const k={...e.user,...w};t({type:"SET_USER",payload:{user:k,isGuest:!1}}),console.log(`FlashcardContext: Updated state with profile data, reviewSessionSize: ${w.reviewSessionSize}`),setTimeout(()=>{console.log("FlashcardContext: Current state.user after update:",e.user),console.log("FlashcardContext: getReviewSessionSize() returns:",dt())},100)}else console.log("FlashcardContext: No profile data returned from loadUserProfile")}catch(w){console.error("FlashcardContext: Failed to load user profile:",w)}}})()},[e.isGuest,e.user?.uid]),x.useEffect(()=>{if(e.selectedCardSet?.dataFile){console.log(`FlashcardContext: Card set changed to ${e.selectedCardSet.name}, loading data for ${e.isGuest?"guest":"authenticated"} user`);const h=e.allCards.length>0,w=e.isGuest?"json":"firestore",k=h&&e.allCards.some(G=>!G.isNew&&G.totalReviews>0),z=h&&e.allCards.length>0&&e.allCards[0].cardSetId!==e.selectedCardSet.id,Y=!e.isGuest&&e.user&&h&&w==="firestore"&&(e.dataSource!=="firestore"||!k||z),re=e.isLoading||e.loadingStates.fetchingCards,X=!re&&(!h||e.dataSource!==w||Y||z);if(console.log("FlashcardContext: Card loading decision:",{hasCards:h,currentDataSource:w,stateDataSource:e.dataSource,hasProgressData:k,cardSetChanged:z,needsFirestoreReload:Y,shouldLoad:X,isCurrentlyLoading:re,isLoading:e.isLoading,fetchingCards:e.loadingStates.fetchingCards,isGuest:e.isGuest,hasUser:!!e.user,cardsCount:e.allCards.length,firstCardId:e.allCards[0]?.id,selectedCardSetId:e.selectedCardSet.id,currentCardsCardSetId:e.allCards[0]?.cardSetId,dataSourceMismatch:e.dataSource!==w,reasonsToReload:{noCards:!h,dataSourceMismatch:e.dataSource!==w,needsFirestoreReload:Y,lacksProgressData:h&&!k,cardSetChanged:z}}),h){const G=e.allCards[0];console.log("FlashcardContext: Sample card progress data:",{cardId:G?.id,isNew:G?.isNew,totalReviews:G?.totalReviews,repetitions:G?.repetitions,easinessFactor:G?.easinessFactor,lastReviewDate:G?.lastReviewDate,hasProgressData:G&&!G.isNew&&G.totalReviews>0})}if(!X){console.log("FlashcardContext: Cards already loaded for current data source, skipping load");return}!e.isGuest&&e.user?y().catch(G=>{console.error("Failed to load cards from Firestore, falling back to JSON:",G),e.selectedCardSet?.dataFile&&s(e.selectedCardSet.dataFile)}):s(e.selectedCardSet.dataFile)}else e.selectedCardSet?.dataFile||(async()=>{t({type:"SET_LOADING",payload:!0});try{const k=(await we("flashcards.json")).map(z=>Ce(z,"default"));t({type:"LOAD_CARDS",payload:k})}catch(w){console.error("Failed to load default data:",w),t({type:"LOAD_CARDS",payload:[]})}finally{t({type:"SET_LOADING",payload:!1})}})()},[e.selectedCardSet,e.isGuest,e.user]),x.useEffect(()=>{(async()=>{if(!(!e.currentSession?.isComplete||!e.currentSession.pendingProgress||e.currentSession.pendingProgress.size===0||e.isGuest||e.dataSource!=="firestore"))try{console.log(`üöÄ Session completed: Converting ${e.currentSession.pendingProgress.size} individual card updates into 1 consolidated progress update`),u("savingProgress",!0),g("syncing");const w=await p.loadCardSetProgress(e.selectedCardSet?.id||"unknown"),k=No(e.currentSession.pendingProgress,e.allCards,e.selectedCardSet?.id||"unknown"),z=Do(k,e.currentSession.pendingProgress,e.allCards);if(!z.isValid)throw console.error("‚ùå Progress validation failed:",z.errors),new Error(`Invalid aggregated progress: ${z.errors.join(", ")}`);console.log("‚úÖ Progress aggregation validated:",z.details),console.log("üíæ Step 1: Ensuring card set document exists...");const Y=e.selectedCardSet?.id||"unknown",re=e.selectedCardSet?.dataFile||"hsk-1-set-1-english.json",X=await T.ensureCardSetExistsWithoutProgress(Y,re);if(!X.success)throw new Error(X.error||"Failed to ensure card set document");console.log("‚úÖ Card set document ensured (no duplicate progress saves)"),console.log("üíæ Step 2: Saving individual card progress updates...");const G=await T.saveProgressBatch(e.currentSession.pendingProgress,Y);if(!G.success)throw new Error(G.error||"Failed to save individual card progress");console.log("‚úÖ Individual card progress saved successfully"),console.log("üíæ Step 3: Saving progress summary...");const ut=await T.updateCardSetProgressOptimized(e.selectedCardSet?.id||"unknown",k);if(ut.success){const Ta=Po(w,k,e.currentSession.pendingProgress);console.log("üéâ Hybrid save completed successfully"),console.log("‚úÖ Card set document created/updated: users/{userId}/cardSets/{cardSetId}"),console.log("‚úÖ Individual card progress saved: users/{userId}/cardSets/{cardSetId}"),console.log("‚úÖ Progress summary saved: users/{userId}.cardSetsProgress"),console.log(`üí∞ Cost Optimization: ${e.currentSession.pendingProgress.size} operations ‚Üí 2 operations (${Math.round((1-2/e.currentSession.pendingProgress.size)*100)}% reduction)`),console.log(`üìä ${Ta}`),g("idle")}else console.error("‚ùå Progress summary save failed:",ut.error),console.warn("‚ö†Ô∏è Individual cards were saved successfully, but progress summary failed"),g("error"),S(`Failed to save progress summary: ${ut.error}`,!0)}catch(w){console.error("‚ùå Hybrid save error:",w),g("error"),S(`Failed to save session data: ${w instanceof Error?w.message:"Unknown error"}`,!0)}finally{u("savingProgress",!1)}})()},[e.currentSession?.isComplete,e.currentSession?.pendingProgress?.size,e.isGuest,e.dataSource,e.selectedCardSet?.id]);const o=h=>{t({type:"LOAD_CARDS",payload:h})},n=()=>{if(e.dueCards.length>0){const h=dt(),w=e.dueCards.slice(0,h);console.log(`FlashcardContext: Starting review session with ${w.length}/${e.dueCards.length} cards (session size: ${h})`),t({type:"START_REVIEW_SESSION",payload:w})}},l=()=>{t({type:"SHOW_CARD_BACK"})},c=()=>{t({type:"NEXT_CARD"})},f=()=>{t({type:"COMPLETE_SESSION"})},d=()=>{t({type:"RESET_SESSION"})},u=x.useCallback((h,w)=>{t({type:"SET_LOADING_STATE",payload:{key:h,value:w}})},[]),m=x.useCallback(h=>{t({type:"SET_DATA_SOURCE",payload:h})},[]),g=x.useCallback(h=>{t({type:"SET_SYNC_STATUS",payload:h})},[]),S=x.useCallback((h,w=!0)=>{t({type:"SET_ERROR",payload:{code:"CONTEXT_ERROR",message:h,retryable:w,timestamp:new Date}})},[]),C=x.useCallback(()=>{t({type:"CLEAR_ERROR"})},[]),A=x.useCallback(()=>{t({type:"RETRY_PENDING_OPERATIONS"})},[]),N=x.useCallback((h,w)=>{t({type:"SET_USER",payload:{user:h,isGuest:w}})},[]),p=Ao({state:e,dispatch:t,setLoadingState:u,setSyncStatus:g,setDataSource:m,setError:S,clearError:C}),{loadCardsFromFirestore:y,saveCardToFirestore:R,migrateGuestDataToFirestore:b,loadCardSetProgress:$,saveCardSetProgress:K,updateCurrentCardSetProgress:I,loadAllCardSetProgress:Q,loadUserProfile:sr,updateUserProfile:ct}=p,dt=x.useCallback(()=>{if(e.user&&!e.isGuest&&e.user.reviewSessionSize)return console.log(`FlashcardContext: Using user profile session size: ${e.user.reviewSessionSize}`),e.user.reviewSessionSize;if(Be()){const h=localStorage.getItem("reviewSessionSize");if(h){const w=parseInt(h,10);if(es.includes(w))return console.log(`FlashcardContext: Using localStorage session size: ${w}`),w}}return console.log(`FlashcardContext: Using default session size: ${nr}`),nr},[e.user,e.isGuest]),xa=x.useCallback(async h=>{try{if(console.log(`FlashcardContext: Updating review session size to ${h}`),!e.user||e.isGuest)return Be()?(localStorage.setItem("reviewSessionSize",h.toString()),console.log(`FlashcardContext: Saved session size ${h} to localStorage for guest user`),!0):(console.warn("FlashcardContext: localStorage not available for guest user"),!1);const w=await ct({reviewSessionSize:h});return console.log(`FlashcardContext: Updating local state to session size ${h}`),t({type:"SET_USER",payload:{user:{...e.user,reviewSessionSize:h},isGuest:e.isGuest}}),w?console.log(`FlashcardContext: Successfully updated session size to ${h} in user profile`):console.error("FlashcardContext: Failed to update session size in user profile, but local state updated"),w}catch(w){return console.error("FlashcardContext: Error updating review session size:",w),S("Failed to update review session size",!0),!1}},[e.user,e.isGuest,ct,S]),ba=x.useCallback(h=>{console.log("FlashcardContext: Setting selected card set",h),t({type:"RESET_SESSION"}),t({type:"SET_SELECTED_CARD_SET",payload:h}),h&&Be()&&jo(h)},[]),Sa=Ro({state:e,dispatch:t,setLoadingState:u,setSyncStatus:g,setError:S,clearError:C,loadCardSetData:s}),wa=x.useCallback(async()=>{try{u("fetchingCards",!0),g("syncing"),console.log("üöÄ Initializing cache for user session");const h=await ce.initializeCacheForUser();return h?(m("firestore"),g("idle"),console.log("‚úÖ Cache initialization successful")):(g("error"),S("Failed to initialize cache",!0)),h}catch(h){return console.error("‚ùå Cache initialization error:",h),g("error"),S(h instanceof Error?h.message:"Cache initialization failed",!0),!1}finally{u("fetchingCards",!1)}},[u,g,m,S]),Ca=x.useCallback(async()=>{try{console.log("üöÄ Loading user profile with consolidated progress");const h=await ce.loadUserProfileWithProgress();return h.success&&h.profile?(console.log("‚úÖ Profile loaded from optimized cache"),h.profile):(console.log("‚ö†Ô∏è Profile load failed:",h.error),S(h.error||"Failed to load profile",!0),null)}catch(h){return console.error("‚ùå Optimized profile load error:",h),S(h instanceof Error?h.message:"Profile load failed",!0),null}},[S]),Ea=x.useCallback(h=>{const w=ce.getCardSetProgress(h);return w.success&&w.servedFromCache?(console.log(`üéØ Progress for ${h} served from cache`),w.progress):(console.log(`üì≠ No cached progress for ${h}`),null)},[]),Aa=x.useCallback(()=>{const h=ce.getAllCardSetProgress();return h.success&&h.servedFromCache?(console.log(`üéØ All progress served from cache (${Object.keys(h.progressMap).length} card sets)`),h.progressMap):(console.log("üì≠ No cached progress available"),{})},[]),Na=x.useCallback((h,w)=>{try{console.log(`‚ö° Optimistic progress update for ${h}`),ce.updateCardSetProgressOptimistic(h,w),t({type:"UPDATE_CARD_SET_PROGRESS_OPTIMISTIC",payload:{cardSetId:h,progress:w}}),g("syncing"),console.log("üìã Progress update queued for batch sync")}catch(k){console.error("‚ùå Optimistic update error:",k),S(k instanceof Error?k.message:"Progress update failed",!0)}},[t,g,S]),Da=x.useCallback(async()=>{try{g("syncing"),console.log("üîÑ Forcing immediate sync");const h=await ce.forceSyncNow();return h?(g("idle"),console.log("‚úÖ Force sync completed")):(g("error"),S("Force sync failed",!0)),h}catch(h){return console.error("‚ùå Force sync error:",h),g("error"),S(h instanceof Error?h.message:"Force sync failed",!0),!1}},[g,S]),Pa=x.useCallback(()=>{const h=ce.getCacheStats();return console.log("üìä Cache statistics:",h),h},[]),Ra=x.useCallback(()=>{console.log("üóëÔ∏è Clearing flashcard cache"),ce.clearCache(),t({type:"CLEAR_CACHE"}),g("idle"),m("session")},[t,g,m]),{rateCard:ja,knowCard:Fa,resetProgress:_a}=Sa,ka={state:e,dispatch:t,loadCards:o,loadCardSetData:s,startReviewSession:n,showCardBack:l,rateCard:ja,knowCard:Fa,nextCard:c,completeSession:f,resetSession:d,resetProgress:_a,setLoadingState:u,setDataSource:m,setSyncStatus:g,setError:S,clearError:C,retryPendingOperations:A,setUser:N,setSelectedCardSet:ba,loadCardsFromFirestore:y,saveCardToFirestore:R,migrateGuestDataToFirestore:b,loadCardSetProgress:$,saveCardSetProgress:K,updateCurrentCardSetProgress:I,loadAllCardSetProgress:Q,loadUserProfile:sr,updateUserProfile:ct,updateReviewSessionSize:xa,getReviewSessionSize:dt,initializeCacheForUser:wa,loadUserProfileWithProgressOptimized:Ca,getCardSetProgressFromCache:Ea,getAllCardSetProgressFromCache:Aa,updateCardSetProgressOptimized:Na,forceSyncNow:Da,getCacheStats:Pa,clearCache:Ra};return i.jsx(gs.Provider,{value:ka,children:r})},me=()=>{const r=x.useContext(gs);if(!r)throw new Error("useFlashcard must be used within a FlashcardProvider");return r};/*!
 * Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com
 * License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
 * Copyright 2025 Fonticons, Inc.
 */var $o={prefix:"fas",iconName:"share-from-square",icon:[576,512,[61509,"share-square"],"f14d","M384.5 24l0 72-64 0c-79.5 0-144 64.5-144 144 0 93.4 82.8 134.8 100.6 142.6 2.2 1 4.6 1.4 7.1 1.4l2.5 0c9.8 0 17.8-8 17.8-17.8 0-8.3-5.9-15.5-12.8-20.3-8.9-6.2-19.2-18.2-19.2-40.5 0-45 36.5-81.5 81.5-81.5l30.5 0 0 72c0 9.7 5.8 18.5 14.8 22.2s19.3 1.7 26.2-5.2l136-136c9.4-9.4 9.4-24.6 0-33.9L425.5 7c-6.9-6.9-17.2-8.9-26.2-5.2S384.5 14.3 384.5 24zm-272 72c-44.2 0-80 35.8-80 80l0 256c0 44.2 35.8 80 80 80l256 0c44.2 0 80-35.8 80-80l0-32c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 32c0 8.8-7.2 16-16 16l-256 0c-8.8 0-16-7.2-16-16l0-256c0-8.8 7.2-16 16-16l16 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-16 0z"]},Io={prefix:"fas",iconName:"gear",icon:[512,512,[9881,"cog"],"f013","M195.1 9.5C198.1-5.3 211.2-16 226.4-16l59.8 0c15.2 0 28.3 10.7 31.3 25.5L332 79.5c14.1 6 27.3 13.7 39.3 22.8l67.8-22.5c14.4-4.8 30.2 1.2 37.8 14.4l29.9 51.8c7.6 13.2 4.9 29.8-6.5 39.9L447 233.3c.9 7.4 1.3 15 1.3 22.7s-.5 15.3-1.3 22.7l53.4 47.5c11.4 10.1 14 26.8 6.5 39.9l-29.9 51.8c-7.6 13.1-23.4 19.2-37.8 14.4l-67.8-22.5c-12.1 9.1-25.3 16.7-39.3 22.8l-14.4 69.9c-3.1 14.9-16.2 25.5-31.3 25.5l-59.8 0c-15.2 0-28.3-10.7-31.3-25.5l-14.4-69.9c-14.1-6-27.2-13.7-39.3-22.8L73.5 432.3c-14.4 4.8-30.2-1.2-37.8-14.4L5.8 366.1c-7.6-13.2-4.9-29.8 6.5-39.9l53.4-47.5c-.9-7.4-1.3-15-1.3-22.7s.5-15.3 1.3-22.7L12.3 185.8c-11.4-10.1-14-26.8-6.5-39.9L35.7 94.1c7.6-13.2 23.4-19.2 37.8-14.4l67.8 22.5c12.1-9.1 25.3-16.7 39.3-22.8L195.1 9.5zM256.3 336a80 80 0 1 0 -.6-160 80 80 0 1 0 .6 160z"]},Lo=Io,Uo={prefix:"fas",iconName:"xmark",icon:[384,512,[128473,10005,10006,10060,215,"close","multiply","remove","times"],"f00d","M55.1 73.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L147.2 256 9.9 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192.5 301.3 329.9 438.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.8 256 375.1 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192.5 210.7 55.1 73.4z"]},Mo=Uo;/*!
 * Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com
 * License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
 * Copyright 2025 Fonticons, Inc.
 */function wt(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,s=Array(e);t<e;t++)s[t]=r[t];return s}function zo(r){if(Array.isArray(r))return r}function Go(r){if(Array.isArray(r))return wt(r)}function Wo(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Bo(r,e){for(var t=0;t<e.length;t++){var s=e[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(r,ms(s.key),s)}}function Yo(r,e,t){return e&&Bo(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function Ye(r,e){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=Bt(r))||e){t&&(r=t);var s=0,a=function(){};return{s:a,n:function(){return s>=r.length?{done:!0}:{done:!1,value:r[s++]}},e:function(c){throw c},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o,n=!0,l=!1;return{s:function(){t=t.call(r)},n:function(){var c=t.next();return n=c.done,c},e:function(c){l=!0,o=c},f:function(){try{n||t.return==null||t.return()}finally{if(l)throw o}}}}function D(r,e,t){return(e=ms(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Ho(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Vo(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var s,a,o,n,l=[],c=!0,f=!1;try{if(o=(t=t.call(r)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(s=o.call(t)).done)&&(l.push(s.value),l.length!==e);c=!0);}catch(d){f=!0,a=d}finally{try{if(!c&&t.return!=null&&(n=t.return(),Object(n)!==n))return}finally{if(f)throw a}}return l}}function Ko(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Jo(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cr(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);e&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(r,a).enumerable})),t.push.apply(t,s)}return t}function v(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?cr(Object(t),!0).forEach(function(s){D(r,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):cr(Object(t)).forEach(function(s){Object.defineProperty(r,s,Object.getOwnPropertyDescriptor(t,s))})}return r}function st(r,e){return zo(r)||Vo(r,e)||Bt(r,e)||Ko()}function te(r){return Go(r)||Ho(r)||Bt(r)||Jo()}function Qo(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var s=t.call(r,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function ms(r){var e=Qo(r,"string");return typeof e=="symbol"?e:e+""}function qe(r){"@babel/helpers - typeof";return qe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qe(r)}function Bt(r,e){if(r){if(typeof r=="string")return wt(r,e);var t={}.toString.call(r).slice(8,-1);return t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set"?Array.from(r):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?wt(r,e):void 0}}var dr=function(){},Yt={},hs={},ps=null,vs={mark:dr,measure:dr};try{typeof window<"u"&&(Yt=window),typeof document<"u"&&(hs=document),typeof MutationObserver<"u"&&(ps=MutationObserver),typeof performance<"u"&&(vs=performance)}catch{}var qo=Yt.navigator||{},ur=qo.userAgent,fr=ur===void 0?"":ur,de=Yt,_=hs,gr=ps,Ge=vs;de.document;var le=!!_.documentElement&&!!_.head&&typeof _.addEventListener=="function"&&typeof _.createElement=="function",ys=~fr.indexOf("MSIE")||~fr.indexOf("Trident/"),mt,Xo=/fa(k|kd|s|r|l|t|d|dr|dl|dt|b|slr|slpr|wsb|tl|ns|nds|es|jr|jfr|jdr|usb|ufsb|udsb|cr|ss|sr|sl|st|sds|sdr|sdl|sdt)?[\-\ ]/,Zo=/Font ?Awesome ?([567 ]*)(Solid|Regular|Light|Thin|Duotone|Brands|Free|Pro|Sharp Duotone|Sharp|Kit|Notdog Duo|Notdog|Chisel|Etch|Thumbprint|Jelly Fill|Jelly Duo|Jelly|Utility|Utility Fill|Utility Duo|Slab Press|Slab|Whiteboard)?.*/i,xs={classic:{fa:"solid",fas:"solid","fa-solid":"solid",far:"regular","fa-regular":"regular",fal:"light","fa-light":"light",fat:"thin","fa-thin":"thin",fab:"brands","fa-brands":"brands"},duotone:{fa:"solid",fad:"solid","fa-solid":"solid","fa-duotone":"solid",fadr:"regular","fa-regular":"regular",fadl:"light","fa-light":"light",fadt:"thin","fa-thin":"thin"},sharp:{fa:"solid",fass:"solid","fa-solid":"solid",fasr:"regular","fa-regular":"regular",fasl:"light","fa-light":"light",fast:"thin","fa-thin":"thin"},"sharp-duotone":{fa:"solid",fasds:"solid","fa-solid":"solid",fasdr:"regular","fa-regular":"regular",fasdl:"light","fa-light":"light",fasdt:"thin","fa-thin":"thin"},slab:{"fa-regular":"regular",faslr:"regular"},"slab-press":{"fa-regular":"regular",faslpr:"regular"},thumbprint:{"fa-light":"light",fatl:"light"},whiteboard:{"fa-semibold":"semibold",fawsb:"semibold"},notdog:{"fa-solid":"solid",fans:"solid"},"notdog-duo":{"fa-solid":"solid",fands:"solid"},etch:{"fa-solid":"solid",faes:"solid"},jelly:{"fa-regular":"regular",fajr:"regular"},"jelly-fill":{"fa-regular":"regular",fajfr:"regular"},"jelly-duo":{"fa-regular":"regular",fajdr:"regular"},chisel:{"fa-regular":"regular",facr:"regular"},utility:{"fa-semibold":"semibold",fausb:"semibold"},"utility-duo":{"fa-semibold":"semibold",faudsb:"semibold"},"utility-fill":{"fa-semibold":"semibold",faufsb:"semibold"}},en={GROUP:"duotone-group",PRIMARY:"primary",SECONDARY:"secondary"},bs=["fa-classic","fa-duotone","fa-sharp","fa-sharp-duotone","fa-thumbprint","fa-whiteboard","fa-notdog","fa-notdog-duo","fa-chisel","fa-etch","fa-jelly","fa-jelly-fill","fa-jelly-duo","fa-slab","fa-slab-press","fa-utility","fa-utility-duo","fa-utility-fill"],B="classic",Le="duotone",Ss="sharp",ws="sharp-duotone",Cs="chisel",Es="etch",As="jelly",Ns="jelly-duo",Ds="jelly-fill",Ps="notdog",Rs="notdog-duo",js="slab",Fs="slab-press",_s="thumbprint",ks="utility",Ts="utility-duo",Os="utility-fill",$s="whiteboard",tn="Classic",rn="Duotone",sn="Sharp",an="Sharp Duotone",on="Chisel",nn="Etch",ln="Jelly",cn="Jelly Duo",dn="Jelly Fill",un="Notdog",fn="Notdog Duo",gn="Slab",mn="Slab Press",hn="Thumbprint",pn="Utility",vn="Utility Duo",yn="Utility Fill",xn="Whiteboard",Is=[B,Le,Ss,ws,Cs,Es,As,Ns,Ds,Ps,Rs,js,Fs,_s,ks,Ts,Os,$s];mt={},D(D(D(D(D(D(D(D(D(D(mt,B,tn),Le,rn),Ss,sn),ws,an),Cs,on),Es,nn),As,ln),Ns,cn),Ds,dn),Ps,un),D(D(D(D(D(D(D(D(mt,Rs,fn),js,gn),Fs,mn),_s,hn),ks,pn),Ts,vn),Os,yn),$s,xn);var bn={classic:{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"},duotone:{900:"fad",400:"fadr",300:"fadl",100:"fadt"},sharp:{900:"fass",400:"fasr",300:"fasl",100:"fast"},"sharp-duotone":{900:"fasds",400:"fasdr",300:"fasdl",100:"fasdt"},slab:{400:"faslr"},"slab-press":{400:"faslpr"},whiteboard:{600:"fawsb"},thumbprint:{300:"fatl"},notdog:{900:"fans"},"notdog-duo":{900:"fands"},etch:{900:"faes"},chisel:{400:"facr"},jelly:{400:"fajr"},"jelly-fill":{400:"fajfr"},"jelly-duo":{400:"fajdr"},utility:{600:"fausb"},"utility-duo":{600:"faudsb"},"utility-fill":{600:"faufsb"}},Sn={"Font Awesome 7 Free":{900:"fas",400:"far"},"Font Awesome 7 Pro":{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"},"Font Awesome 7 Brands":{400:"fab",normal:"fab"},"Font Awesome 7 Duotone":{900:"fad",400:"fadr",normal:"fadr",300:"fadl",100:"fadt"},"Font Awesome 7 Sharp":{900:"fass",400:"fasr",normal:"fasr",300:"fasl",100:"fast"},"Font Awesome 7 Sharp Duotone":{900:"fasds",400:"fasdr",normal:"fasdr",300:"fasdl",100:"fasdt"},"Font Awesome 7 Jelly":{400:"fajr",normal:"fajr"},"Font Awesome 7 Jelly Fill":{400:"fajfr",normal:"fajfr"},"Font Awesome 7 Jelly Duo":{400:"fajdr",normal:"fajdr"},"Font Awesome 7 Slab":{400:"faslr",normal:"faslr"},"Font Awesome 7 Slab Press":{400:"faslpr",normal:"faslpr"},"Font Awesome 7 Thumbprint":{300:"fatl",normal:"fatl"},"Font Awesome 7 Notdog":{900:"fans",normal:"fans"},"Font Awesome 7 Notdog Duo":{900:"fands",normal:"fands"},"Font Awesome 7 Etch":{900:"faes",normal:"faes"},"Font Awesome 7 Chisel":{400:"facr",normal:"facr"},"Font Awesome 7 Whiteboard":{600:"fawsb",normal:"fawsb"},"Font Awesome 7 Utility":{600:"fausb",normal:"fausb"},"Font Awesome 7 Utility Duo":{600:"faudsb",normal:"faudsb"},"Font Awesome 7 Utility Fill":{600:"faufsb",normal:"faufsb"}},wn=new Map([["classic",{defaultShortPrefixId:"fas",defaultStyleId:"solid",styleIds:["solid","regular","light","thin","brands"],futureStyleIds:[],defaultFontWeight:900}],["duotone",{defaultShortPrefixId:"fad",defaultStyleId:"solid",styleIds:["solid","regular","light","thin"],futureStyleIds:[],defaultFontWeight:900}],["sharp",{defaultShortPrefixId:"fass",defaultStyleId:"solid",styleIds:["solid","regular","light","thin"],futureStyleIds:[],defaultFontWeight:900}],["sharp-duotone",{defaultShortPrefixId:"fasds",defaultStyleId:"solid",styleIds:["solid","regular","light","thin"],futureStyleIds:[],defaultFontWeight:900}],["chisel",{defaultShortPrefixId:"facr",defaultStyleId:"regular",styleIds:["regular"],futureStyleIds:[],defaultFontWeight:400}],["etch",{defaultShortPrefixId:"faes",defaultStyleId:"solid",styleIds:["solid"],futureStyleIds:[],defaultFontWeight:900}],["jelly",{defaultShortPrefixId:"fajr",defaultStyleId:"regular",styleIds:["regular"],futureStyleIds:[],defaultFontWeight:400}],["jelly-duo",{defaultShortPrefixId:"fajdr",defaultStyleId:"regular",styleIds:["regular"],futureStyleIds:[],defaultFontWeight:400}],["jelly-fill",{defaultShortPrefixId:"fajfr",defaultStyleId:"regular",styleIds:["regular"],futureStyleIds:[],defaultFontWeight:400}],["notdog",{defaultShortPrefixId:"fans",defaultStyleId:"solid",styleIds:["solid"],futureStyleIds:[],defaultFontWeight:900}],["notdog-duo",{defaultShortPrefixId:"fands",defaultStyleId:"solid",styleIds:["solid"],futureStyleIds:[],defaultFontWeight:900}],["slab",{defaultShortPrefixId:"faslr",defaultStyleId:"regular",styleIds:["regular"],futureStyleIds:[],defaultFontWeight:400}],["slab-press",{defaultShortPrefixId:"faslpr",defaultStyleId:"regular",styleIds:["regular"],futureStyleIds:[],defaultFontWeight:400}],["thumbprint",{defaultShortPrefixId:"fatl",defaultStyleId:"light",styleIds:["light"],futureStyleIds:[],defaultFontWeight:300}],["utility",{defaultShortPrefixId:"fausb",defaultStyleId:"semibold",styleIds:["semibold"],futureStyleIds:[],defaultFontWeight:600}],["utility-duo",{defaultShortPrefixId:"faudsb",defaultStyleId:"semibold",styleIds:["semibold"],futureStyleIds:[],defaultFontWeight:600}],["utility-fill",{defaultShortPrefixId:"faufsb",defaultStyleId:"semibold",styleIds:["semibold"],futureStyleIds:[],defaultFontWeight:600}],["whiteboard",{defaultShortPrefixId:"fawsb",defaultStyleId:"semibold",styleIds:["semibold"],futureStyleIds:[],defaultFontWeight:600}]]),Cn={chisel:{regular:"facr"},classic:{brands:"fab",light:"fal",regular:"far",solid:"fas",thin:"fat"},duotone:{light:"fadl",regular:"fadr",solid:"fad",thin:"fadt"},etch:{solid:"faes"},jelly:{regular:"fajr"},"jelly-duo":{regular:"fajdr"},"jelly-fill":{regular:"fajfr"},notdog:{solid:"fans"},"notdog-duo":{solid:"fands"},sharp:{light:"fasl",regular:"fasr",solid:"fass",thin:"fast"},"sharp-duotone":{light:"fasdl",regular:"fasdr",solid:"fasds",thin:"fasdt"},slab:{regular:"faslr"},"slab-press":{regular:"faslpr"},thumbprint:{light:"fatl"},utility:{semibold:"fausb"},"utility-duo":{semibold:"faudsb"},"utility-fill":{semibold:"faufsb"},whiteboard:{semibold:"fawsb"}},Ls=["fak","fa-kit","fakd","fa-kit-duotone"],mr={kit:{fak:"kit","fa-kit":"kit"},"kit-duotone":{fakd:"kit-duotone","fa-kit-duotone":"kit-duotone"}},En=["kit"],An="kit",Nn="kit-duotone",Dn="Kit",Pn="Kit Duotone";D(D({},An,Dn),Nn,Pn);var Rn={kit:{"fa-kit":"fak"}},jn={"Font Awesome Kit":{400:"fak",normal:"fak"},"Font Awesome Kit Duotone":{400:"fakd",normal:"fakd"}},Fn={kit:{fak:"fa-kit"}},hr={kit:{kit:"fak"},"kit-duotone":{"kit-duotone":"fakd"}},ht,We={GROUP:"duotone-group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},_n=["fa-classic","fa-duotone","fa-sharp","fa-sharp-duotone","fa-thumbprint","fa-whiteboard","fa-notdog","fa-notdog-duo","fa-chisel","fa-etch","fa-jelly","fa-jelly-fill","fa-jelly-duo","fa-slab","fa-slab-press","fa-utility","fa-utility-duo","fa-utility-fill"],kn="classic",Tn="duotone",On="sharp",$n="sharp-duotone",In="chisel",Ln="etch",Un="jelly",Mn="jelly-duo",zn="jelly-fill",Gn="notdog",Wn="notdog-duo",Bn="slab",Yn="slab-press",Hn="thumbprint",Vn="utility",Kn="utility-duo",Jn="utility-fill",Qn="whiteboard",qn="Classic",Xn="Duotone",Zn="Sharp",ei="Sharp Duotone",ti="Chisel",ri="Etch",si="Jelly",ai="Jelly Duo",oi="Jelly Fill",ni="Notdog",ii="Notdog Duo",li="Slab",ci="Slab Press",di="Thumbprint",ui="Utility",fi="Utility Duo",gi="Utility Fill",mi="Whiteboard";ht={},D(D(D(D(D(D(D(D(D(D(ht,kn,qn),Tn,Xn),On,Zn),$n,ei),In,ti),Ln,ri),Un,si),Mn,ai),zn,oi),Gn,ni),D(D(D(D(D(D(D(D(ht,Wn,ii),Bn,li),Yn,ci),Hn,di),Vn,ui),Kn,fi),Jn,gi),Qn,mi);var hi="kit",pi="kit-duotone",vi="Kit",yi="Kit Duotone";D(D({},hi,vi),pi,yi);var xi={classic:{"fa-brands":"fab","fa-duotone":"fad","fa-light":"fal","fa-regular":"far","fa-solid":"fas","fa-thin":"fat"},duotone:{"fa-regular":"fadr","fa-light":"fadl","fa-thin":"fadt"},sharp:{"fa-solid":"fass","fa-regular":"fasr","fa-light":"fasl","fa-thin":"fast"},"sharp-duotone":{"fa-solid":"fasds","fa-regular":"fasdr","fa-light":"fasdl","fa-thin":"fasdt"},slab:{"fa-regular":"faslr"},"slab-press":{"fa-regular":"faslpr"},whiteboard:{"fa-semibold":"fawsb"},thumbprint:{"fa-light":"fatl"},notdog:{"fa-solid":"fans"},"notdog-duo":{"fa-solid":"fands"},etch:{"fa-solid":"faes"},jelly:{"fa-regular":"fajr"},"jelly-fill":{"fa-regular":"fajfr"},"jelly-duo":{"fa-regular":"fajdr"},chisel:{"fa-regular":"facr"},utility:{"fa-semibold":"fausb"},"utility-duo":{"fa-semibold":"faudsb"},"utility-fill":{"fa-semibold":"faufsb"}},bi={classic:["fas","far","fal","fat","fad"],duotone:["fadr","fadl","fadt"],sharp:["fass","fasr","fasl","fast"],"sharp-duotone":["fasds","fasdr","fasdl","fasdt"],slab:["faslr"],"slab-press":["faslpr"],whiteboard:["fawsb"],thumbprint:["fatl"],notdog:["fans"],"notdog-duo":["fands"],etch:["faes"],jelly:["fajr"],"jelly-fill":["fajfr"],"jelly-duo":["fajdr"],chisel:["facr"],utility:["fausb"],"utility-duo":["faudsb"],"utility-fill":["faufsb"]},Ct={classic:{fab:"fa-brands",fad:"fa-duotone",fal:"fa-light",far:"fa-regular",fas:"fa-solid",fat:"fa-thin"},duotone:{fadr:"fa-regular",fadl:"fa-light",fadt:"fa-thin"},sharp:{fass:"fa-solid",fasr:"fa-regular",fasl:"fa-light",fast:"fa-thin"},"sharp-duotone":{fasds:"fa-solid",fasdr:"fa-regular",fasdl:"fa-light",fasdt:"fa-thin"},slab:{faslr:"fa-regular"},"slab-press":{faslpr:"fa-regular"},whiteboard:{fawsb:"fa-semibold"},thumbprint:{fatl:"fa-light"},notdog:{fans:"fa-solid"},"notdog-duo":{fands:"fa-solid"},etch:{faes:"fa-solid"},jelly:{fajr:"fa-regular"},"jelly-fill":{fajfr:"fa-regular"},"jelly-duo":{fajdr:"fa-regular"},chisel:{facr:"fa-regular"},utility:{fausb:"fa-semibold"},"utility-duo":{faudsb:"fa-semibold"},"utility-fill":{faufsb:"fa-semibold"}},Si=["fa-solid","fa-regular","fa-light","fa-thin","fa-duotone","fa-brands","fa-semibold"],Us=["fa","fas","far","fal","fat","fad","fadr","fadl","fadt","fab","fass","fasr","fasl","fast","fasds","fasdr","fasdl","fasdt","faslr","faslpr","fawsb","fatl","fans","fands","faes","fajr","fajfr","fajdr","facr","fausb","faudsb","faufsb"].concat(_n,Si),wi=["solid","regular","light","thin","duotone","brands","semibold"],Ms=[1,2,3,4,5,6,7,8,9,10],Ci=Ms.concat([11,12,13,14,15,16,17,18,19,20]),Ei=["aw","fw","pull-left","pull-right"],Ai=[].concat(te(Object.keys(bi)),wi,Ei,["2xs","xs","sm","lg","xl","2xl","beat","border","fade","beat-fade","bounce","flip-both","flip-horizontal","flip-vertical","flip","inverse","layers","layers-bottom-left","layers-bottom-right","layers-counter","layers-text","layers-top-left","layers-top-right","li","pull-end","pull-start","pulse","rotate-180","rotate-270","rotate-90","rotate-by","shake","spin-pulse","spin-reverse","spin","stack-1x","stack-2x","stack","ul","width-auto","width-fixed",We.GROUP,We.SWAP_OPACITY,We.PRIMARY,We.SECONDARY]).concat(Ms.map(function(r){return"".concat(r,"x")})).concat(Ci.map(function(r){return"w-".concat(r)})),Ni={"Font Awesome 5 Free":{900:"fas",400:"far"},"Font Awesome 5 Pro":{900:"fas",400:"far",normal:"far",300:"fal"},"Font Awesome 5 Brands":{400:"fab",normal:"fab"},"Font Awesome 5 Duotone":{900:"fad"}},ne="___FONT_AWESOME___",Et=16,zs="fa",Gs="svg-inline--fa",ve="data-fa-i2svg",At="data-fa-pseudo-element",Di="data-fa-pseudo-element-pending",Ht="data-prefix",Vt="data-icon",pr="fontawesome-i2svg",Pi="async",Ri=["HTML","HEAD","STYLE","SCRIPT"],Ws=["::before","::after",":before",":after"],Bs=(function(){try{return!0}catch{return!1}})();function Ue(r){return new Proxy(r,{get:function(t,s){return s in t?t[s]:t[B]}})}var Ys=v({},xs);Ys[B]=v(v(v(v({},{"fa-duotone":"duotone"}),xs[B]),mr.kit),mr["kit-duotone"]);var ji=Ue(Ys),Nt=v({},Cn);Nt[B]=v(v(v(v({},{duotone:"fad"}),Nt[B]),hr.kit),hr["kit-duotone"]);var vr=Ue(Nt),Dt=v({},Ct);Dt[B]=v(v({},Dt[B]),Fn.kit);var Kt=Ue(Dt),Pt=v({},xi);Pt[B]=v(v({},Pt[B]),Rn.kit);Ue(Pt);var Fi=Xo,Hs="fa-layers-text",_i=Zo,ki=v({},bn);Ue(ki);var Ti=["class","data-prefix","data-icon","data-fa-transform","data-fa-mask"],pt=en,Oi=[].concat(te(En),te(Ai)),je=de.FontAwesomeConfig||{};function $i(r){var e=_.querySelector("script["+r+"]");if(e)return e.getAttribute(r)}function Ii(r){return r===""?!0:r==="false"?!1:r==="true"?!0:r}if(_&&typeof _.querySelector=="function"){var Li=[["data-family-prefix","familyPrefix"],["data-css-prefix","cssPrefix"],["data-family-default","familyDefault"],["data-style-default","styleDefault"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-search-pseudo-elements","searchPseudoElements"],["data-search-pseudo-elements-warnings","searchPseudoElementsWarnings"],["data-search-pseudo-elements-full-scan","searchPseudoElementsFullScan"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]];Li.forEach(function(r){var e=st(r,2),t=e[0],s=e[1],a=Ii($i(t));a!=null&&(je[s]=a)})}var Vs={styleDefault:"solid",familyDefault:B,cssPrefix:zs,replacementClass:Gs,autoReplaceSvg:!0,autoAddCss:!0,searchPseudoElements:!1,searchPseudoElementsWarnings:!0,searchPseudoElementsFullScan:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0};je.familyPrefix&&(je.cssPrefix=je.familyPrefix);var Ne=v(v({},Vs),je);Ne.autoReplaceSvg||(Ne.observeMutations=!1);var E={};Object.keys(Vs).forEach(function(r){Object.defineProperty(E,r,{enumerable:!0,set:function(t){Ne[r]=t,Fe.forEach(function(s){return s(E)})},get:function(){return Ne[r]}})});Object.defineProperty(E,"familyPrefix",{enumerable:!0,set:function(e){Ne.cssPrefix=e,Fe.forEach(function(t){return t(E)})},get:function(){return Ne.cssPrefix}});de.FontAwesomeConfig=E;var Fe=[];function Ui(r){return Fe.push(r),function(){Fe.splice(Fe.indexOf(r),1)}}var be=Et,se={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function Mi(r){if(!(!r||!le)){var e=_.createElement("style");e.setAttribute("type","text/css"),e.innerHTML=r;for(var t=_.head.childNodes,s=null,a=t.length-1;a>-1;a--){var o=t[a],n=(o.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(n)>-1&&(s=o)}return _.head.insertBefore(e,s),r}}var zi="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function yr(){for(var r=12,e="";r-- >0;)e+=zi[Math.random()*62|0];return e}function De(r){for(var e=[],t=(r||[]).length>>>0;t--;)e[t]=r[t];return e}function Jt(r){return r.classList?De(r.classList):(r.getAttribute("class")||"").split(" ").filter(function(e){return e})}function Ks(r){return"".concat(r).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Gi(r){return Object.keys(r||{}).reduce(function(e,t){return e+"".concat(t,'="').concat(Ks(r[t]),'" ')},"").trim()}function at(r){return Object.keys(r||{}).reduce(function(e,t){return e+"".concat(t,": ").concat(r[t].trim(),";")},"")}function Qt(r){return r.size!==se.size||r.x!==se.x||r.y!==se.y||r.rotate!==se.rotate||r.flipX||r.flipY}function Wi(r){var e=r.transform,t=r.containerWidth,s=r.iconWidth,a={transform:"translate(".concat(t/2," 256)")},o="translate(".concat(e.x*32,", ").concat(e.y*32,") "),n="scale(".concat(e.size/16*(e.flipX?-1:1),", ").concat(e.size/16*(e.flipY?-1:1),") "),l="rotate(".concat(e.rotate," 0 0)"),c={transform:"".concat(o," ").concat(n," ").concat(l)},f={transform:"translate(".concat(s/2*-1," -256)")};return{outer:a,inner:c,path:f}}function Bi(r){var e=r.transform,t=r.width,s=t===void 0?Et:t,a=r.height,o=a===void 0?Et:a,n="";return ys?n+="translate(".concat(e.x/be-s/2,"em, ").concat(e.y/be-o/2,"em) "):n+="translate(calc(-50% + ".concat(e.x/be,"em), calc(-50% + ").concat(e.y/be,"em)) "),n+="scale(".concat(e.size/be*(e.flipX?-1:1),", ").concat(e.size/be*(e.flipY?-1:1),") "),n+="rotate(".concat(e.rotate,"deg) "),n}var Yi=`:root, :host {
  --fa-font-solid: normal 900 1em/1 "Font Awesome 7 Free";
  --fa-font-regular: normal 400 1em/1 "Font Awesome 7 Free";
  --fa-font-light: normal 300 1em/1 "Font Awesome 7 Pro";
  --fa-font-thin: normal 100 1em/1 "Font Awesome 7 Pro";
  --fa-font-duotone: normal 900 1em/1 "Font Awesome 7 Duotone";
  --fa-font-duotone-regular: normal 400 1em/1 "Font Awesome 7 Duotone";
  --fa-font-duotone-light: normal 300 1em/1 "Font Awesome 7 Duotone";
  --fa-font-duotone-thin: normal 100 1em/1 "Font Awesome 7 Duotone";
  --fa-font-brands: normal 400 1em/1 "Font Awesome 7 Brands";
  --fa-font-sharp-solid: normal 900 1em/1 "Font Awesome 7 Sharp";
  --fa-font-sharp-regular: normal 400 1em/1 "Font Awesome 7 Sharp";
  --fa-font-sharp-light: normal 300 1em/1 "Font Awesome 7 Sharp";
  --fa-font-sharp-thin: normal 100 1em/1 "Font Awesome 7 Sharp";
  --fa-font-sharp-duotone-solid: normal 900 1em/1 "Font Awesome 7 Sharp Duotone";
  --fa-font-sharp-duotone-regular: normal 400 1em/1 "Font Awesome 7 Sharp Duotone";
  --fa-font-sharp-duotone-light: normal 300 1em/1 "Font Awesome 7 Sharp Duotone";
  --fa-font-sharp-duotone-thin: normal 100 1em/1 "Font Awesome 7 Sharp Duotone";
  --fa-font-slab-regular: normal 400 1em/1 "Font Awesome 7 Slab";
  --fa-font-slab-press-regular: normal 400 1em/1 "Font Awesome 7 Slab Press";
  --fa-font-whiteboard-semibold: normal 600 1em/1 "Font Awesome 7 Whiteboard";
  --fa-font-thumbprint-light: normal 300 1em/1 "Font Awesome 7 Thumbprint";
  --fa-font-notdog-solid: normal 900 1em/1 "Font Awesome 7 Notdog";
  --fa-font-notdog-duo-solid: normal 900 1em/1 "Font Awesome 7 Notdog Duo";
  --fa-font-etch-solid: normal 900 1em/1 "Font Awesome 7 Etch";
  --fa-font-jelly-regular: normal 400 1em/1 "Font Awesome 7 Jelly";
  --fa-font-jelly-fill-regular: normal 400 1em/1 "Font Awesome 7 Jelly Fill";
  --fa-font-jelly-duo-regular: normal 400 1em/1 "Font Awesome 7 Jelly Duo";
  --fa-font-chisel-regular: normal 400 1em/1 "Font Awesome 7 Chisel";
  --fa-font-utility-semibold: normal 600 1em/1 "Font Awesome 7 Utility";
  --fa-font-utility-duo-semibold: normal 600 1em/1 "Font Awesome 7 Utility Duo";
  --fa-font-utility-fill-semibold: normal 600 1em/1 "Font Awesome 7 Utility Fill";
}

.svg-inline--fa {
  box-sizing: content-box;
  display: var(--fa-display, inline-block);
  height: 1em;
  overflow: visible;
  vertical-align: -0.125em;
  width: var(--fa-width, 1.25em);
}
.svg-inline--fa.fa-2xs {
  vertical-align: 0.1em;
}
.svg-inline--fa.fa-xs {
  vertical-align: 0em;
}
.svg-inline--fa.fa-sm {
  vertical-align: -0.0714285714em;
}
.svg-inline--fa.fa-lg {
  vertical-align: -0.2em;
}
.svg-inline--fa.fa-xl {
  vertical-align: -0.25em;
}
.svg-inline--fa.fa-2xl {
  vertical-align: -0.3125em;
}
.svg-inline--fa.fa-pull-left,
.svg-inline--fa .fa-pull-start {
  float: inline-start;
  margin-inline-end: var(--fa-pull-margin, 0.3em);
}
.svg-inline--fa.fa-pull-right,
.svg-inline--fa .fa-pull-end {
  float: inline-end;
  margin-inline-start: var(--fa-pull-margin, 0.3em);
}
.svg-inline--fa.fa-li {
  width: var(--fa-li-width, 2em);
  inset-inline-start: calc(-1 * var(--fa-li-width, 2em));
  inset-block-start: 0.25em; /* syncing vertical alignment with Web Font rendering */
}

.fa-layers-counter, .fa-layers-text {
  display: inline-block;
  position: absolute;
  text-align: center;
}

.fa-layers {
  display: inline-block;
  height: 1em;
  position: relative;
  text-align: center;
  vertical-align: -0.125em;
  width: var(--fa-width, 1.25em);
}
.fa-layers .svg-inline--fa {
  inset: 0;
  margin: auto;
  position: absolute;
  transform-origin: center center;
}

.fa-layers-text {
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  transform-origin: center center;
}

.fa-layers-counter {
  background-color: var(--fa-counter-background-color, #ff253a);
  border-radius: var(--fa-counter-border-radius, 1em);
  box-sizing: border-box;
  color: var(--fa-inverse, #fff);
  line-height: var(--fa-counter-line-height, 1);
  max-width: var(--fa-counter-max-width, 5em);
  min-width: var(--fa-counter-min-width, 1.5em);
  overflow: hidden;
  padding: var(--fa-counter-padding, 0.25em 0.5em);
  right: var(--fa-right, 0);
  text-overflow: ellipsis;
  top: var(--fa-top, 0);
  transform: scale(var(--fa-counter-scale, 0.25));
  transform-origin: top right;
}

.fa-layers-bottom-right {
  bottom: var(--fa-bottom, 0);
  right: var(--fa-right, 0);
  top: auto;
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: bottom right;
}

.fa-layers-bottom-left {
  bottom: var(--fa-bottom, 0);
  left: var(--fa-left, 0);
  right: auto;
  top: auto;
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: bottom left;
}

.fa-layers-top-right {
  top: var(--fa-top, 0);
  right: var(--fa-right, 0);
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: top right;
}

.fa-layers-top-left {
  left: var(--fa-left, 0);
  right: auto;
  top: var(--fa-top, 0);
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: top left;
}

.fa-1x {
  font-size: 1em;
}

.fa-2x {
  font-size: 2em;
}

.fa-3x {
  font-size: 3em;
}

.fa-4x {
  font-size: 4em;
}

.fa-5x {
  font-size: 5em;
}

.fa-6x {
  font-size: 6em;
}

.fa-7x {
  font-size: 7em;
}

.fa-8x {
  font-size: 8em;
}

.fa-9x {
  font-size: 9em;
}

.fa-10x {
  font-size: 10em;
}

.fa-2xs {
  font-size: calc(10 / 16 * 1em); /* converts a 10px size into an em-based value that's relative to the scale's 16px base */
  line-height: calc(1 / 10 * 1em); /* sets the line-height of the icon back to that of it's parent */
  vertical-align: calc((6 / 10 - 0.375) * 1em); /* vertically centers the icon taking into account the surrounding text's descender */
}

.fa-xs {
  font-size: calc(12 / 16 * 1em); /* converts a 12px size into an em-based value that's relative to the scale's 16px base */
  line-height: calc(1 / 12 * 1em); /* sets the line-height of the icon back to that of it's parent */
  vertical-align: calc((6 / 12 - 0.375) * 1em); /* vertically centers the icon taking into account the surrounding text's descender */
}

.fa-sm {
  font-size: calc(14 / 16 * 1em); /* converts a 14px size into an em-based value that's relative to the scale's 16px base */
  line-height: calc(1 / 14 * 1em); /* sets the line-height of the icon back to that of it's parent */
  vertical-align: calc((6 / 14 - 0.375) * 1em); /* vertically centers the icon taking into account the surrounding text's descender */
}

.fa-lg {
  font-size: calc(20 / 16 * 1em); /* converts a 20px size into an em-based value that's relative to the scale's 16px base */
  line-height: calc(1 / 20 * 1em); /* sets the line-height of the icon back to that of it's parent */
  vertical-align: calc((6 / 20 - 0.375) * 1em); /* vertically centers the icon taking into account the surrounding text's descender */
}

.fa-xl {
  font-size: calc(24 / 16 * 1em); /* converts a 24px size into an em-based value that's relative to the scale's 16px base */
  line-height: calc(1 / 24 * 1em); /* sets the line-height of the icon back to that of it's parent */
  vertical-align: calc((6 / 24 - 0.375) * 1em); /* vertically centers the icon taking into account the surrounding text's descender */
}

.fa-2xl {
  font-size: calc(32 / 16 * 1em); /* converts a 32px size into an em-based value that's relative to the scale's 16px base */
  line-height: calc(1 / 32 * 1em); /* sets the line-height of the icon back to that of it's parent */
  vertical-align: calc((6 / 32 - 0.375) * 1em); /* vertically centers the icon taking into account the surrounding text's descender */
}

.fa-width-auto {
  --fa-width: auto;
}

.fa-fw,
.fa-width-fixed {
  --fa-width: 1.25em;
}

.fa-ul {
  list-style-type: none;
  margin-inline-start: var(--fa-li-margin, 2.5em);
  padding-inline-start: 0;
}
.fa-ul > li {
  position: relative;
}

.fa-li {
  inset-inline-start: calc(-1 * var(--fa-li-width, 2em));
  position: absolute;
  text-align: center;
  width: var(--fa-li-width, 2em);
  line-height: inherit;
}

/* Heads Up: Bordered Icons will not be supported in the future!
  - This feature will be deprecated in the next major release of Font Awesome (v8)!
  - You may continue to use it in this version *v7), but it will not be supported in Font Awesome v8.
*/
/* Notes:
* --@{v.$css-prefix}-border-width = 1/16 by default (to render as ~1px based on a 16px default font-size)
* --@{v.$css-prefix}-border-padding =
  ** 3/16 for vertical padding (to give ~2px of vertical whitespace around an icon considering it's vertical alignment)
  ** 4/16 for horizontal padding (to give ~4px of horizontal whitespace around an icon)
*/
.fa-border {
  border-color: var(--fa-border-color, #eee);
  border-radius: var(--fa-border-radius, 0.1em);
  border-style: var(--fa-border-style, solid);
  border-width: var(--fa-border-width, 0.0625em);
  box-sizing: var(--fa-border-box-sizing, content-box);
  padding: var(--fa-border-padding, 0.1875em 0.25em);
}

.fa-pull-left,
.fa-pull-start {
  float: inline-start;
  margin-inline-end: var(--fa-pull-margin, 0.3em);
}

.fa-pull-right,
.fa-pull-end {
  float: inline-end;
  margin-inline-start: var(--fa-pull-margin, 0.3em);
}

.fa-beat {
  animation-name: fa-beat;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-bounce {
  animation-name: fa-bounce;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.28, 0.84, 0.42, 1));
}

.fa-fade {
  animation-name: fa-fade;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-beat-fade {
  animation-name: fa-beat-fade;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-flip {
  animation-name: fa-flip;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-shake {
  animation-name: fa-shake;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin {
  animation-name: fa-spin;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 2s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin-reverse {
  --fa-animation-direction: reverse;
}

.fa-pulse,
.fa-spin-pulse {
  animation-name: fa-spin;
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, steps(8));
}

@media (prefers-reduced-motion: reduce) {
  .fa-beat,
  .fa-bounce,
  .fa-fade,
  .fa-beat-fade,
  .fa-flip,
  .fa-pulse,
  .fa-shake,
  .fa-spin,
  .fa-spin-pulse {
    animation: none !important;
    transition: none !important;
  }
}
@keyframes fa-beat {
  0%, 90% {
    transform: scale(1);
  }
  45% {
    transform: scale(var(--fa-beat-scale, 1.25));
  }
}
@keyframes fa-bounce {
  0% {
    transform: scale(1, 1) translateY(0);
  }
  10% {
    transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
  }
  30% {
    transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
  }
  50% {
    transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
  }
  57% {
    transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
  }
  64% {
    transform: scale(1, 1) translateY(0);
  }
  100% {
    transform: scale(1, 1) translateY(0);
  }
}
@keyframes fa-fade {
  50% {
    opacity: var(--fa-fade-opacity, 0.4);
  }
}
@keyframes fa-beat-fade {
  0%, 100% {
    opacity: var(--fa-beat-fade-opacity, 0.4);
    transform: scale(1);
  }
  50% {
    opacity: 1;
    transform: scale(var(--fa-beat-fade-scale, 1.125));
  }
}
@keyframes fa-flip {
  50% {
    transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
  }
}
@keyframes fa-shake {
  0% {
    transform: rotate(-15deg);
  }
  4% {
    transform: rotate(15deg);
  }
  8%, 24% {
    transform: rotate(-18deg);
  }
  12%, 28% {
    transform: rotate(18deg);
  }
  16% {
    transform: rotate(-22deg);
  }
  20% {
    transform: rotate(22deg);
  }
  32% {
    transform: rotate(-12deg);
  }
  36% {
    transform: rotate(12deg);
  }
  40%, 100% {
    transform: rotate(0deg);
  }
}
@keyframes fa-spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
.fa-rotate-90 {
  transform: rotate(90deg);
}

.fa-rotate-180 {
  transform: rotate(180deg);
}

.fa-rotate-270 {
  transform: rotate(270deg);
}

.fa-flip-horizontal {
  transform: scale(-1, 1);
}

.fa-flip-vertical {
  transform: scale(1, -1);
}

.fa-flip-both,
.fa-flip-horizontal.fa-flip-vertical {
  transform: scale(-1, -1);
}

.fa-rotate-by {
  transform: rotate(var(--fa-rotate-angle, 0));
}

.svg-inline--fa .fa-primary {
  fill: var(--fa-primary-color, currentColor);
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa .fa-secondary {
  fill: var(--fa-secondary-color, currentColor);
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-primary {
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-secondary {
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa mask .fa-primary,
.svg-inline--fa mask .fa-secondary {
  fill: black;
}

.svg-inline--fa.fa-inverse {
  fill: var(--fa-inverse, #fff);
}

.fa-stack {
  display: inline-block;
  height: 2em;
  line-height: 2em;
  position: relative;
  vertical-align: middle;
  width: 2.5em;
}

.fa-inverse {
  color: var(--fa-inverse, #fff);
}

.svg-inline--fa.fa-stack-1x {
  --fa-width: 1.25em;
  height: 1em;
  width: var(--fa-width);
}
.svg-inline--fa.fa-stack-2x {
  --fa-width: 2.5em;
  height: 2em;
  width: var(--fa-width);
}

.fa-stack-1x,
.fa-stack-2x {
  inset: 0;
  margin: auto;
  position: absolute;
  z-index: var(--fa-stack-z-index, auto);
}`;function Js(){var r=zs,e=Gs,t=E.cssPrefix,s=E.replacementClass,a=Yi;if(t!==r||s!==e){var o=new RegExp("\\.".concat(r,"\\-"),"g"),n=new RegExp("\\--".concat(r,"\\-"),"g"),l=new RegExp("\\.".concat(e),"g");a=a.replace(o,".".concat(t,"-")).replace(n,"--".concat(t,"-")).replace(l,".".concat(s))}return a}var xr=!1;function vt(){E.autoAddCss&&!xr&&(Mi(Js()),xr=!0)}var Hi={mixout:function(){return{dom:{css:Js,insertCss:vt}}},hooks:function(){return{beforeDOMElementCreation:function(){vt()},beforeI2svg:function(){vt()}}}},ie=de||{};ie[ne]||(ie[ne]={});ie[ne].styles||(ie[ne].styles={});ie[ne].hooks||(ie[ne].hooks={});ie[ne].shims||(ie[ne].shims=[]);var ee=ie[ne],Qs=[],qs=function(){_.removeEventListener("DOMContentLoaded",qs),Xe=1,Qs.map(function(e){return e()})},Xe=!1;le&&(Xe=(_.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(_.readyState),Xe||_.addEventListener("DOMContentLoaded",qs));function Vi(r){le&&(Xe?setTimeout(r,0):Qs.push(r))}function Me(r){var e=r.tag,t=r.attributes,s=t===void 0?{}:t,a=r.children,o=a===void 0?[]:a;return typeof r=="string"?Ks(r):"<".concat(e," ").concat(Gi(s),">").concat(o.map(Me).join(""),"</").concat(e,">")}function br(r,e,t){if(r&&r[e]&&r[e][t])return{prefix:e,iconName:t,icon:r[e][t]}}var yt=function(e,t,s,a){var o=Object.keys(e),n=o.length,l=t,c,f,d;for(s===void 0?(c=1,d=e[o[0]]):(c=0,d=s);c<n;c++)f=o[c],d=l(d,e[f],f,e);return d};function Xs(r){return te(r).length!==1?null:r.codePointAt(0).toString(16)}function Sr(r){return Object.keys(r).reduce(function(e,t){var s=r[t],a=!!s.icon;return a?e[s.iconName]=s.icon:e[t]=s,e},{})}function Rt(r,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=t.skipHooks,a=s===void 0?!1:s,o=Sr(e);typeof ee.hooks.addPack=="function"&&!a?ee.hooks.addPack(r,Sr(e)):ee.styles[r]=v(v({},ee.styles[r]||{}),o),r==="fas"&&Rt("fa",e)}var Oe=ee.styles,Ki=ee.shims,Zs=Object.keys(Kt),Ji=Zs.reduce(function(r,e){return r[e]=Object.keys(Kt[e]),r},{}),qt=null,ea={},ta={},ra={},sa={},aa={};function Qi(r){return~Oi.indexOf(r)}function qi(r,e){var t=e.split("-"),s=t[0],a=t.slice(1).join("-");return s===r&&a!==""&&!Qi(a)?a:null}var oa=function(){var e=function(o){return yt(Oe,function(n,l,c){return n[c]=yt(l,o,{}),n},{})};ea=e(function(a,o,n){if(o[3]&&(a[o[3]]=n),o[2]){var l=o[2].filter(function(c){return typeof c=="number"});l.forEach(function(c){a[c.toString(16)]=n})}return a}),ta=e(function(a,o,n){if(a[n]=n,o[2]){var l=o[2].filter(function(c){return typeof c=="string"});l.forEach(function(c){a[c]=n})}return a}),aa=e(function(a,o,n){var l=o[2];return a[n]=n,l.forEach(function(c){a[c]=n}),a});var t="far"in Oe||E.autoFetchSvg,s=yt(Ki,function(a,o){var n=o[0],l=o[1],c=o[2];return l==="far"&&!t&&(l="fas"),typeof n=="string"&&(a.names[n]={prefix:l,iconName:c}),typeof n=="number"&&(a.unicodes[n.toString(16)]={prefix:l,iconName:c}),a},{names:{},unicodes:{}});ra=s.names,sa=s.unicodes,qt=ot(E.styleDefault,{family:E.familyDefault})};Ui(function(r){qt=ot(r.styleDefault,{family:E.familyDefault})});oa();function Xt(r,e){return(ea[r]||{})[e]}function Xi(r,e){return(ta[r]||{})[e]}function he(r,e){return(aa[r]||{})[e]}function na(r){return ra[r]||{prefix:null,iconName:null}}function Zi(r){var e=sa[r],t=Xt("fas",r);return e||(t?{prefix:"fas",iconName:t}:null)||{prefix:null,iconName:null}}function ue(){return qt}var ia=function(){return{prefix:null,iconName:null,rest:[]}};function el(r){var e=B,t=Zs.reduce(function(s,a){return s[a]="".concat(E.cssPrefix,"-").concat(a),s},{});return Is.forEach(function(s){(r.includes(t[s])||r.some(function(a){return Ji[s].includes(a)}))&&(e=s)}),e}function ot(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.family,s=t===void 0?B:t,a=ji[s][r];if(s===Le&&!r)return"fad";var o=vr[s][r]||vr[s][a],n=r in ee.styles?r:null,l=o||n||null;return l}function tl(r){var e=[],t=null;return r.forEach(function(s){var a=qi(E.cssPrefix,s);a?t=a:s&&e.push(s)}),{iconName:t,rest:e}}function wr(r){return r.sort().filter(function(e,t,s){return s.indexOf(e)===t})}var Cr=Us.concat(Ls);function nt(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.skipLookups,s=t===void 0?!1:t,a=null,o=wr(r.filter(function(g){return Cr.includes(g)})),n=wr(r.filter(function(g){return!Cr.includes(g)})),l=o.filter(function(g){return a=g,!bs.includes(g)}),c=st(l,1),f=c[0],d=f===void 0?null:f,u=el(o),m=v(v({},tl(n)),{},{prefix:ot(d,{family:u})});return v(v(v({},m),ol({values:r,family:u,styles:Oe,config:E,canonical:m,givenPrefix:a})),rl(s,a,m))}function rl(r,e,t){var s=t.prefix,a=t.iconName;if(r||!s||!a)return{prefix:s,iconName:a};var o=e==="fa"?na(a):{},n=he(s,a);return a=o.iconName||n||a,s=o.prefix||s,s==="far"&&!Oe.far&&Oe.fas&&!E.autoFetchSvg&&(s="fas"),{prefix:s,iconName:a}}var sl=Is.filter(function(r){return r!==B||r!==Le}),al=Object.keys(Ct).filter(function(r){return r!==B}).map(function(r){return Object.keys(Ct[r])}).flat();function ol(r){var e=r.values,t=r.family,s=r.canonical,a=r.givenPrefix,o=a===void 0?"":a,n=r.styles,l=n===void 0?{}:n,c=r.config,f=c===void 0?{}:c,d=t===Le,u=e.includes("fa-duotone")||e.includes("fad"),m=f.familyDefault==="duotone",g=s.prefix==="fad"||s.prefix==="fa-duotone";if(!d&&(u||m||g)&&(s.prefix="fad"),(e.includes("fa-brands")||e.includes("fab"))&&(s.prefix="fab"),!s.prefix&&sl.includes(t)){var S=Object.keys(l).find(function(A){return al.includes(A)});if(S||f.autoFetchSvg){var C=wn.get(t).defaultShortPrefixId;s.prefix=C,s.iconName=he(s.prefix,s.iconName)||s.iconName}}return(s.prefix==="fa"||o==="fa")&&(s.prefix=ue()||"fas"),s}var nl=(function(){function r(){Wo(this,r),this.definitions={}}return Yo(r,[{key:"add",value:function(){for(var t=this,s=arguments.length,a=new Array(s),o=0;o<s;o++)a[o]=arguments[o];var n=a.reduce(this._pullDefinitions,{});Object.keys(n).forEach(function(l){t.definitions[l]=v(v({},t.definitions[l]||{}),n[l]),Rt(l,n[l]);var c=Kt[B][l];c&&Rt(c,n[l]),oa()})}},{key:"reset",value:function(){this.definitions={}}},{key:"_pullDefinitions",value:function(t,s){var a=s.prefix&&s.iconName&&s.icon?{0:s}:s;return Object.keys(a).map(function(o){var n=a[o],l=n.prefix,c=n.iconName,f=n.icon,d=f[2];t[l]||(t[l]={}),d.length>0&&d.forEach(function(u){typeof u=="string"&&(t[l][u]=f)}),t[l][c]=f}),t}}])})(),Er=[],Ee={},Ae={},il=Object.keys(Ae);function ll(r,e){var t=e.mixoutsTo;return Er=r,Ee={},Object.keys(Ae).forEach(function(s){il.indexOf(s)===-1&&delete Ae[s]}),Er.forEach(function(s){var a=s.mixout?s.mixout():{};if(Object.keys(a).forEach(function(n){typeof a[n]=="function"&&(t[n]=a[n]),qe(a[n])==="object"&&Object.keys(a[n]).forEach(function(l){t[n]||(t[n]={}),t[n][l]=a[n][l]})}),s.hooks){var o=s.hooks();Object.keys(o).forEach(function(n){Ee[n]||(Ee[n]=[]),Ee[n].push(o[n])})}s.provides&&s.provides(Ae)}),t}function jt(r,e){for(var t=arguments.length,s=new Array(t>2?t-2:0),a=2;a<t;a++)s[a-2]=arguments[a];var o=Ee[r]||[];return o.forEach(function(n){e=n.apply(null,[e].concat(s))}),e}function ye(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];var a=Ee[r]||[];a.forEach(function(o){o.apply(null,t)})}function fe(){var r=arguments[0],e=Array.prototype.slice.call(arguments,1);return Ae[r]?Ae[r].apply(null,e):void 0}function Ft(r){r.prefix==="fa"&&(r.prefix="fas");var e=r.iconName,t=r.prefix||ue();if(e)return e=he(t,e)||e,br(la.definitions,t,e)||br(ee.styles,t,e)}var la=new nl,cl=function(){E.autoReplaceSvg=!1,E.observeMutations=!1,ye("noAuto")},dl={i2svg:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return le?(ye("beforeI2svg",e),fe("pseudoElements2svg",e),fe("i2svg",e)):Promise.reject(new Error("Operation requires a DOM of some kind."))},watch:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.autoReplaceSvgRoot;E.autoReplaceSvg===!1&&(E.autoReplaceSvg=!0),E.observeMutations=!0,Vi(function(){fl({autoReplaceSvgRoot:t}),ye("watch",e)})}},ul={icon:function(e){if(e===null)return null;if(qe(e)==="object"&&e.prefix&&e.iconName)return{prefix:e.prefix,iconName:he(e.prefix,e.iconName)||e.iconName};if(Array.isArray(e)&&e.length===2){var t=e[1].indexOf("fa-")===0?e[1].slice(3):e[1],s=ot(e[0]);return{prefix:s,iconName:he(s,t)||t}}if(typeof e=="string"&&(e.indexOf("".concat(E.cssPrefix,"-"))>-1||e.match(Fi))){var a=nt(e.split(" "),{skipLookups:!0});return{prefix:a.prefix||ue(),iconName:he(a.prefix,a.iconName)||a.iconName}}if(typeof e=="string"){var o=ue();return{prefix:o,iconName:he(o,e)||e}}}},J={noAuto:cl,config:E,dom:dl,parse:ul,library:la,findIconDefinition:Ft,toHtml:Me},fl=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.autoReplaceSvgRoot,s=t===void 0?_:t;(Object.keys(ee.styles).length>0||E.autoFetchSvg)&&le&&E.autoReplaceSvg&&J.dom.i2svg({node:s})};function it(r,e){return Object.defineProperty(r,"abstract",{get:e}),Object.defineProperty(r,"html",{get:function(){return r.abstract.map(function(s){return Me(s)})}}),Object.defineProperty(r,"node",{get:function(){if(le){var s=_.createElement("div");return s.innerHTML=r.html,s.children}}}),r}function gl(r){var e=r.children,t=r.main,s=r.mask,a=r.attributes,o=r.styles,n=r.transform;if(Qt(n)&&t.found&&!s.found){var l=t.width,c=t.height,f={x:l/c/2,y:.5};a.style=at(v(v({},o),{},{"transform-origin":"".concat(f.x+n.x/16,"em ").concat(f.y+n.y/16,"em")}))}return[{tag:"svg",attributes:a,children:e}]}function ml(r){var e=r.prefix,t=r.iconName,s=r.children,a=r.attributes,o=r.symbol,n=o===!0?"".concat(e,"-").concat(E.cssPrefix,"-").concat(t):o;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:v(v({},a),{},{id:n}),children:s}]}]}function hl(r){var e=["aria-label","aria-labelledby","title","role"];return e.some(function(t){return t in r})}function Zt(r){var e=r.icons,t=e.main,s=e.mask,a=r.prefix,o=r.iconName,n=r.transform,l=r.symbol,c=r.maskId,f=r.extra,d=r.watchable,u=d===void 0?!1:d,m=s.found?s:t,g=m.width,S=m.height,C=[E.replacementClass,o?"".concat(E.cssPrefix,"-").concat(o):""].filter(function(b){return f.classes.indexOf(b)===-1}).filter(function(b){return b!==""||!!b}).concat(f.classes).join(" "),A={children:[],attributes:v(v({},f.attributes),{},{"data-prefix":a,"data-icon":o,class:C,role:f.attributes.role||"img",viewBox:"0 0 ".concat(g," ").concat(S)})};!hl(f.attributes)&&!f.attributes["aria-hidden"]&&(A.attributes["aria-hidden"]="true"),u&&(A.attributes[ve]="");var N=v(v({},A),{},{prefix:a,iconName:o,main:t,mask:s,maskId:c,transform:n,symbol:l,styles:v({},f.styles)}),p=s.found&&t.found?fe("generateAbstractMask",N)||{children:[],attributes:{}}:fe("generateAbstractIcon",N)||{children:[],attributes:{}},y=p.children,R=p.attributes;return N.children=y,N.attributes=R,l?ml(N):gl(N)}function Ar(r){var e=r.content,t=r.width,s=r.height,a=r.transform,o=r.extra,n=r.watchable,l=n===void 0?!1:n,c=v(v({},o.attributes),{},{class:o.classes.join(" ")});l&&(c[ve]="");var f=v({},o.styles);Qt(a)&&(f.transform=Bi({transform:a,width:t,height:s}),f["-webkit-transform"]=f.transform);var d=at(f);d.length>0&&(c.style=d);var u=[];return u.push({tag:"span",attributes:c,children:[e]}),u}function pl(r){var e=r.content,t=r.extra,s=v(v({},t.attributes),{},{class:t.classes.join(" ")}),a=at(t.styles);a.length>0&&(s.style=a);var o=[];return o.push({tag:"span",attributes:s,children:[e]}),o}var xt=ee.styles;function _t(r){var e=r[0],t=r[1],s=r.slice(4),a=st(s,1),o=a[0],n=null;return Array.isArray(o)?n={tag:"g",attributes:{class:"".concat(E.cssPrefix,"-").concat(pt.GROUP)},children:[{tag:"path",attributes:{class:"".concat(E.cssPrefix,"-").concat(pt.SECONDARY),fill:"currentColor",d:o[0]}},{tag:"path",attributes:{class:"".concat(E.cssPrefix,"-").concat(pt.PRIMARY),fill:"currentColor",d:o[1]}}]}:n={tag:"path",attributes:{fill:"currentColor",d:o}},{found:!0,width:e,height:t,icon:n}}var vl={found:!1,width:512,height:512};function yl(r,e){!Bs&&!E.showMissingIcons&&r&&console.error('Icon with name "'.concat(r,'" and prefix "').concat(e,'" is missing.'))}function kt(r,e){var t=e;return e==="fa"&&E.styleDefault!==null&&(e=ue()),new Promise(function(s,a){if(t==="fa"){var o=na(r)||{};r=o.iconName||r,e=o.prefix||e}if(r&&e&&xt[e]&&xt[e][r]){var n=xt[e][r];return s(_t(n))}yl(r,e),s(v(v({},vl),{},{icon:E.showMissingIcons&&r?fe("missingIconAbstract")||{}:{}}))})}var Nr=function(){},Tt=E.measurePerformance&&Ge&&Ge.mark&&Ge.measure?Ge:{mark:Nr,measure:Nr},Re='FA "7.1.0"',xl=function(e){return Tt.mark("".concat(Re," ").concat(e," begins")),function(){return ca(e)}},ca=function(e){Tt.mark("".concat(Re," ").concat(e," ends")),Tt.measure("".concat(Re," ").concat(e),"".concat(Re," ").concat(e," begins"),"".concat(Re," ").concat(e," ends"))},er={begin:xl,end:ca},He=function(){};function Dr(r){var e=r.getAttribute?r.getAttribute(ve):null;return typeof e=="string"}function bl(r){var e=r.getAttribute?r.getAttribute(Ht):null,t=r.getAttribute?r.getAttribute(Vt):null;return e&&t}function Sl(r){return r&&r.classList&&r.classList.contains&&r.classList.contains(E.replacementClass)}function wl(){if(E.autoReplaceSvg===!0)return Ve.replace;var r=Ve[E.autoReplaceSvg];return r||Ve.replace}function Cl(r){return _.createElementNS("http://www.w3.org/2000/svg",r)}function El(r){return _.createElement(r)}function da(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.ceFn,s=t===void 0?r.tag==="svg"?Cl:El:t;if(typeof r=="string")return _.createTextNode(r);var a=s(r.tag);Object.keys(r.attributes||[]).forEach(function(n){a.setAttribute(n,r.attributes[n])});var o=r.children||[];return o.forEach(function(n){a.appendChild(da(n,{ceFn:s}))}),a}function Al(r){var e=" ".concat(r.outerHTML," ");return e="".concat(e,"Font Awesome fontawesome.com "),e}var Ve={replace:function(e){var t=e[0];if(t.parentNode)if(e[1].forEach(function(a){t.parentNode.insertBefore(da(a),t)}),t.getAttribute(ve)===null&&E.keepOriginalSource){var s=_.createComment(Al(t));t.parentNode.replaceChild(s,t)}else t.remove()},nest:function(e){var t=e[0],s=e[1];if(~Jt(t).indexOf(E.replacementClass))return Ve.replace(e);var a=new RegExp("".concat(E.cssPrefix,"-.*"));if(delete s[0].attributes.id,s[0].attributes.class){var o=s[0].attributes.class.split(" ").reduce(function(l,c){return c===E.replacementClass||c.match(a)?l.toSvg.push(c):l.toNode.push(c),l},{toNode:[],toSvg:[]});s[0].attributes.class=o.toSvg.join(" "),o.toNode.length===0?t.removeAttribute("class"):t.setAttribute("class",o.toNode.join(" "))}var n=s.map(function(l){return Me(l)}).join(`
`);t.setAttribute(ve,""),t.innerHTML=n}};function Pr(r){r()}function ua(r,e){var t=typeof e=="function"?e:He;if(r.length===0)t();else{var s=Pr;E.mutateApproach===Pi&&(s=de.requestAnimationFrame||Pr),s(function(){var a=wl(),o=er.begin("mutate");r.map(a),o(),t()})}}var tr=!1;function fa(){tr=!0}function Ot(){tr=!1}var Ze=null;function Rr(r){if(gr&&E.observeMutations){var e=r.treeCallback,t=e===void 0?He:e,s=r.nodeCallback,a=s===void 0?He:s,o=r.pseudoElementsCallback,n=o===void 0?He:o,l=r.observeMutationsRoot,c=l===void 0?_:l;Ze=new gr(function(f){if(!tr){var d=ue();De(f).forEach(function(u){if(u.type==="childList"&&u.addedNodes.length>0&&!Dr(u.addedNodes[0])&&(E.searchPseudoElements&&n(u.target),t(u.target)),u.type==="attributes"&&u.target.parentNode&&E.searchPseudoElements&&n([u.target],!0),u.type==="attributes"&&Dr(u.target)&&~Ti.indexOf(u.attributeName))if(u.attributeName==="class"&&bl(u.target)){var m=nt(Jt(u.target)),g=m.prefix,S=m.iconName;u.target.setAttribute(Ht,g||d),S&&u.target.setAttribute(Vt,S)}else Sl(u.target)&&a(u.target)})}}),le&&Ze.observe(c,{childList:!0,attributes:!0,characterData:!0,subtree:!0})}}function Nl(){Ze&&Ze.disconnect()}function Dl(r){var e=r.getAttribute("style"),t=[];return e&&(t=e.split(";").reduce(function(s,a){var o=a.split(":"),n=o[0],l=o.slice(1);return n&&l.length>0&&(s[n]=l.join(":").trim()),s},{})),t}function Pl(r){var e=r.getAttribute("data-prefix"),t=r.getAttribute("data-icon"),s=r.innerText!==void 0?r.innerText.trim():"",a=nt(Jt(r));return a.prefix||(a.prefix=ue()),e&&t&&(a.prefix=e,a.iconName=t),a.iconName&&a.prefix||(a.prefix&&s.length>0&&(a.iconName=Xi(a.prefix,r.innerText)||Xt(a.prefix,Xs(r.innerText))),!a.iconName&&E.autoFetchSvg&&r.firstChild&&r.firstChild.nodeType===Node.TEXT_NODE&&(a.iconName=r.firstChild.data)),a}function Rl(r){var e=De(r.attributes).reduce(function(t,s){return t.name!=="class"&&t.name!=="style"&&(t[s.name]=s.value),t},{});return e}function jl(){return{iconName:null,prefix:null,transform:se,symbol:!1,mask:{iconName:null,prefix:null,rest:[]},maskId:null,extra:{classes:[],styles:{},attributes:{}}}}function jr(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{styleParser:!0},t=Pl(r),s=t.iconName,a=t.prefix,o=t.rest,n=Rl(r),l=jt("parseNodeAttributes",{},r),c=e.styleParser?Dl(r):[];return v({iconName:s,prefix:a,transform:se,mask:{iconName:null,prefix:null,rest:[]},maskId:null,symbol:!1,extra:{classes:o,styles:c,attributes:n}},l)}var Fl=ee.styles;function ga(r){var e=E.autoReplaceSvg==="nest"?jr(r,{styleParser:!1}):jr(r);return~e.extra.classes.indexOf(Hs)?fe("generateLayersText",r,e):fe("generateSvgReplacementMutation",r,e)}function _l(){return[].concat(te(Ls),te(Us))}function Fr(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!le)return Promise.resolve();var t=_.documentElement.classList,s=function(u){return t.add("".concat(pr,"-").concat(u))},a=function(u){return t.remove("".concat(pr,"-").concat(u))},o=E.autoFetchSvg?_l():bs.concat(Object.keys(Fl));o.includes("fa")||o.push("fa");var n=[".".concat(Hs,":not([").concat(ve,"])")].concat(o.map(function(d){return".".concat(d,":not([").concat(ve,"])")})).join(", ");if(n.length===0)return Promise.resolve();var l=[];try{l=De(r.querySelectorAll(n))}catch{}if(l.length>0)s("pending"),a("complete");else return Promise.resolve();var c=er.begin("onTree"),f=l.reduce(function(d,u){try{var m=ga(u);m&&d.push(m)}catch(g){Bs||g.name==="MissingIcon"&&console.error(g)}return d},[]);return new Promise(function(d,u){Promise.all(f).then(function(m){ua(m,function(){s("active"),s("complete"),a("pending"),typeof e=="function"&&e(),c(),d()})}).catch(function(m){c(),u(m)})})}function kl(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;ga(r).then(function(t){t&&ua([t],e)})}function Tl(r){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=(e||{}).icon?e:Ft(e||{}),a=t.mask;return a&&(a=(a||{}).icon?a:Ft(a||{})),r(s,v(v({},t),{},{mask:a}))}}var Ol=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=t.transform,a=s===void 0?se:s,o=t.symbol,n=o===void 0?!1:o,l=t.mask,c=l===void 0?null:l,f=t.maskId,d=f===void 0?null:f,u=t.classes,m=u===void 0?[]:u,g=t.attributes,S=g===void 0?{}:g,C=t.styles,A=C===void 0?{}:C;if(e){var N=e.prefix,p=e.iconName,y=e.icon;return it(v({type:"icon"},e),function(){return ye("beforeDOMElementCreation",{iconDefinition:e,params:t}),Zt({icons:{main:_t(y),mask:c?_t(c.icon):{found:!1,width:null,height:null,icon:{}}},prefix:N,iconName:p,transform:v(v({},se),a),symbol:n,maskId:d,extra:{attributes:S,styles:A,classes:m}})})}},$l={mixout:function(){return{icon:Tl(Ol)}},hooks:function(){return{mutationObserverCallbacks:function(t){return t.treeCallback=Fr,t.nodeCallback=kl,t}}},provides:function(e){e.i2svg=function(t){var s=t.node,a=s===void 0?_:s,o=t.callback,n=o===void 0?function(){}:o;return Fr(a,n)},e.generateSvgReplacementMutation=function(t,s){var a=s.iconName,o=s.prefix,n=s.transform,l=s.symbol,c=s.mask,f=s.maskId,d=s.extra;return new Promise(function(u,m){Promise.all([kt(a,o),c.iconName?kt(c.iconName,c.prefix):Promise.resolve({found:!1,width:512,height:512,icon:{}})]).then(function(g){var S=st(g,2),C=S[0],A=S[1];u([t,Zt({icons:{main:C,mask:A},prefix:o,iconName:a,transform:n,symbol:l,maskId:f,extra:d,watchable:!0})])}).catch(m)})},e.generateAbstractIcon=function(t){var s=t.children,a=t.attributes,o=t.main,n=t.transform,l=t.styles,c=at(l);c.length>0&&(a.style=c);var f;return Qt(n)&&(f=fe("generateAbstractTransformGrouping",{main:o,transform:n,containerWidth:o.width,iconWidth:o.width})),s.push(f||o.icon),{children:s,attributes:a}}}},Il={mixout:function(){return{layer:function(t){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=s.classes,o=a===void 0?[]:a;return it({type:"layer"},function(){ye("beforeDOMElementCreation",{assembler:t,params:s});var n=[];return t(function(l){Array.isArray(l)?l.map(function(c){n=n.concat(c.abstract)}):n=n.concat(l.abstract)}),[{tag:"span",attributes:{class:["".concat(E.cssPrefix,"-layers")].concat(te(o)).join(" ")},children:n}]})}}}},Ll={mixout:function(){return{counter:function(t){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};s.title;var a=s.classes,o=a===void 0?[]:a,n=s.attributes,l=n===void 0?{}:n,c=s.styles,f=c===void 0?{}:c;return it({type:"counter",content:t},function(){return ye("beforeDOMElementCreation",{content:t,params:s}),pl({content:t.toString(),extra:{attributes:l,styles:f,classes:["".concat(E.cssPrefix,"-layers-counter")].concat(te(o))}})})}}}},Ul={mixout:function(){return{text:function(t){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=s.transform,o=a===void 0?se:a,n=s.classes,l=n===void 0?[]:n,c=s.attributes,f=c===void 0?{}:c,d=s.styles,u=d===void 0?{}:d;return it({type:"text",content:t},function(){return ye("beforeDOMElementCreation",{content:t,params:s}),Ar({content:t,transform:v(v({},se),o),extra:{attributes:f,styles:u,classes:["".concat(E.cssPrefix,"-layers-text")].concat(te(l))}})})}}},provides:function(e){e.generateLayersText=function(t,s){var a=s.transform,o=s.extra,n=null,l=null;if(ys){var c=parseInt(getComputedStyle(t).fontSize,10),f=t.getBoundingClientRect();n=f.width/c,l=f.height/c}return Promise.resolve([t,Ar({content:t.innerHTML,width:n,height:l,transform:a,extra:o,watchable:!0})])}}},ma=new RegExp('"',"ug"),_r=[1105920,1112319],kr=v(v(v(v({},{FontAwesome:{normal:"fas",400:"fas"}}),Sn),Ni),jn),$t=Object.keys(kr).reduce(function(r,e){return r[e.toLowerCase()]=kr[e],r},{}),Ml=Object.keys($t).reduce(function(r,e){var t=$t[e];return r[e]=t[900]||te(Object.entries(t))[0][1],r},{});function zl(r){var e=r.replace(ma,"");return Xs(te(e)[0]||"")}function Gl(r){var e=r.getPropertyValue("font-feature-settings").includes("ss01"),t=r.getPropertyValue("content"),s=t.replace(ma,""),a=s.codePointAt(0),o=a>=_r[0]&&a<=_r[1],n=s.length===2?s[0]===s[1]:!1;return o||n||e}function Wl(r,e){var t=r.replace(/^['"]|['"]$/g,"").toLowerCase(),s=parseInt(e),a=isNaN(s)?"normal":s;return($t[t]||{})[a]||Ml[t]}function Tr(r,e){var t="".concat(Di).concat(e.replace(":","-"));return new Promise(function(s,a){if(r.getAttribute(t)!==null)return s();var o=De(r.children),n=o.filter(function($){return $.getAttribute(At)===e})[0],l=de.getComputedStyle(r,e),c=l.getPropertyValue("font-family"),f=c.match(_i),d=l.getPropertyValue("font-weight"),u=l.getPropertyValue("content");if(n&&!f)return r.removeChild(n),s();if(f&&u!=="none"&&u!==""){var m=l.getPropertyValue("content"),g=Wl(c,d),S=zl(m),C=f[0].startsWith("FontAwesome"),A=Gl(l),N=Xt(g,S),p=N;if(C){var y=Zi(S);y.iconName&&y.prefix&&(N=y.iconName,g=y.prefix)}if(N&&!A&&(!n||n.getAttribute(Ht)!==g||n.getAttribute(Vt)!==p)){r.setAttribute(t,p),n&&r.removeChild(n);var R=jl(),b=R.extra;b.attributes[At]=e,kt(N,g).then(function($){var K=Zt(v(v({},R),{},{icons:{main:$,mask:ia()},prefix:g,iconName:p,extra:b,watchable:!0})),I=_.createElementNS("http://www.w3.org/2000/svg","svg");e==="::before"?r.insertBefore(I,r.firstChild):r.appendChild(I),I.outerHTML=K.map(function(Q){return Me(Q)}).join(`
`),r.removeAttribute(t),s()}).catch(a)}else s()}else s()})}function Bl(r){return Promise.all([Tr(r,"::before"),Tr(r,"::after")])}function Yl(r){return r.parentNode!==document.head&&!~Ri.indexOf(r.tagName.toUpperCase())&&!r.getAttribute(At)&&(!r.parentNode||r.parentNode.tagName!=="svg")}var Hl=function(e){return!!e&&Ws.some(function(t){return e.includes(t)})},Vl=function(e){if(!e)return[];var t=new Set,s=e.split(/,(?![^()]*\))/).map(function(c){return c.trim()});s=s.flatMap(function(c){return c.includes("(")?c:c.split(",").map(function(f){return f.trim()})});var a=Ye(s),o;try{for(a.s();!(o=a.n()).done;){var n=o.value;if(Hl(n)){var l=Ws.reduce(function(c,f){return c.replace(f,"")},n);l!==""&&l!=="*"&&t.add(l)}}}catch(c){a.e(c)}finally{a.f()}return t};function Or(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(le){var t;if(e)t=r;else if(E.searchPseudoElementsFullScan)t=r.querySelectorAll("*");else{var s=new Set,a=Ye(document.styleSheets),o;try{for(a.s();!(o=a.n()).done;){var n=o.value;try{var l=Ye(n.cssRules),c;try{for(l.s();!(c=l.n()).done;){var f=c.value,d=Vl(f.selectorText),u=Ye(d),m;try{for(u.s();!(m=u.n()).done;){var g=m.value;s.add(g)}}catch(C){u.e(C)}finally{u.f()}}}catch(C){l.e(C)}finally{l.f()}}catch(C){E.searchPseudoElementsWarnings&&console.warn("Font Awesome: cannot parse stylesheet: ".concat(n.href," (").concat(C.message,`)
If it declares any Font Awesome CSS pseudo-elements, they will not be rendered as SVG icons. Add crossorigin="anonymous" to the <link>, enable searchPseudoElementsFullScan for slower but more thorough DOM parsing, or suppress this warning by setting searchPseudoElementsWarnings to false.`))}}}catch(C){a.e(C)}finally{a.f()}if(!s.size)return;var S=Array.from(s).join(", ");try{t=r.querySelectorAll(S)}catch{}}return new Promise(function(C,A){var N=De(t).filter(Yl).map(Bl),p=er.begin("searchPseudoElements");fa(),Promise.all(N).then(function(){p(),Ot(),C()}).catch(function(){p(),Ot(),A()})})}}var Kl={hooks:function(){return{mutationObserverCallbacks:function(t){return t.pseudoElementsCallback=Or,t}}},provides:function(e){e.pseudoElements2svg=function(t){var s=t.node,a=s===void 0?_:s;E.searchPseudoElements&&Or(a)}}},$r=!1,Jl={mixout:function(){return{dom:{unwatch:function(){fa(),$r=!0}}}},hooks:function(){return{bootstrap:function(){Rr(jt("mutationObserverCallbacks",{}))},noAuto:function(){Nl()},watch:function(t){var s=t.observeMutationsRoot;$r?Ot():Rr(jt("mutationObserverCallbacks",{observeMutationsRoot:s}))}}}},Ir=function(e){var t={size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0};return e.toLowerCase().split(" ").reduce(function(s,a){var o=a.toLowerCase().split("-"),n=o[0],l=o.slice(1).join("-");if(n&&l==="h")return s.flipX=!0,s;if(n&&l==="v")return s.flipY=!0,s;if(l=parseFloat(l),isNaN(l))return s;switch(n){case"grow":s.size=s.size+l;break;case"shrink":s.size=s.size-l;break;case"left":s.x=s.x-l;break;case"right":s.x=s.x+l;break;case"up":s.y=s.y-l;break;case"down":s.y=s.y+l;break;case"rotate":s.rotate=s.rotate+l;break}return s},t)},Ql={mixout:function(){return{parse:{transform:function(t){return Ir(t)}}}},hooks:function(){return{parseNodeAttributes:function(t,s){var a=s.getAttribute("data-fa-transform");return a&&(t.transform=Ir(a)),t}}},provides:function(e){e.generateAbstractTransformGrouping=function(t){var s=t.main,a=t.transform,o=t.containerWidth,n=t.iconWidth,l={transform:"translate(".concat(o/2," 256)")},c="translate(".concat(a.x*32,", ").concat(a.y*32,") "),f="scale(".concat(a.size/16*(a.flipX?-1:1),", ").concat(a.size/16*(a.flipY?-1:1),") "),d="rotate(".concat(a.rotate," 0 0)"),u={transform:"".concat(c," ").concat(f," ").concat(d)},m={transform:"translate(".concat(n/2*-1," -256)")},g={outer:l,inner:u,path:m};return{tag:"g",attributes:v({},g.outer),children:[{tag:"g",attributes:v({},g.inner),children:[{tag:s.icon.tag,children:s.icon.children,attributes:v(v({},s.icon.attributes),g.path)}]}]}}}},bt={x:0,y:0,width:"100%",height:"100%"};function Lr(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return r.attributes&&(r.attributes.fill||e)&&(r.attributes.fill="black"),r}function ql(r){return r.tag==="g"?r.children:[r]}var Xl={hooks:function(){return{parseNodeAttributes:function(t,s){var a=s.getAttribute("data-fa-mask"),o=a?nt(a.split(" ").map(function(n){return n.trim()})):ia();return o.prefix||(o.prefix=ue()),t.mask=o,t.maskId=s.getAttribute("data-fa-mask-id"),t}}},provides:function(e){e.generateAbstractMask=function(t){var s=t.children,a=t.attributes,o=t.main,n=t.mask,l=t.maskId,c=t.transform,f=o.width,d=o.icon,u=n.width,m=n.icon,g=Wi({transform:c,containerWidth:u,iconWidth:f}),S={tag:"rect",attributes:v(v({},bt),{},{fill:"white"})},C=d.children?{children:d.children.map(Lr)}:{},A={tag:"g",attributes:v({},g.inner),children:[Lr(v({tag:d.tag,attributes:v(v({},d.attributes),g.path)},C))]},N={tag:"g",attributes:v({},g.outer),children:[A]},p="mask-".concat(l||yr()),y="clip-".concat(l||yr()),R={tag:"mask",attributes:v(v({},bt),{},{id:p,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"}),children:[S,N]},b={tag:"defs",children:[{tag:"clipPath",attributes:{id:y},children:ql(m)},R]};return s.push(b,{tag:"rect",attributes:v({fill:"currentColor","clip-path":"url(#".concat(y,")"),mask:"url(#".concat(p,")")},bt)}),{children:s,attributes:a}}}},Zl={provides:function(e){var t=!1;de.matchMedia&&(t=de.matchMedia("(prefers-reduced-motion: reduce)").matches),e.missingIconAbstract=function(){var s=[],a={fill:"currentColor"},o={attributeType:"XML",repeatCount:"indefinite",dur:"2s"};s.push({tag:"path",attributes:v(v({},a),{},{d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"})});var n=v(v({},o),{},{attributeName:"opacity"}),l={tag:"circle",attributes:v(v({},a),{},{cx:"256",cy:"364",r:"28"}),children:[]};return t||l.children.push({tag:"animate",attributes:v(v({},o),{},{attributeName:"r",values:"28;14;28;28;14;28;"})},{tag:"animate",attributes:v(v({},n),{},{values:"1;0;1;1;0;1;"})}),s.push(l),s.push({tag:"path",attributes:v(v({},a),{},{opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"}),children:t?[]:[{tag:"animate",attributes:v(v({},n),{},{values:"1;0;0;0;0;1;"})}]}),t||s.push({tag:"path",attributes:v(v({},a),{},{opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"}),children:[{tag:"animate",attributes:v(v({},n),{},{values:"0;0;1;1;0;0;"})}]}),{tag:"g",attributes:{class:"missing"},children:s}}}},ec={hooks:function(){return{parseNodeAttributes:function(t,s){var a=s.getAttribute("data-fa-symbol"),o=a===null?!1:a===""?!0:a;return t.symbol=o,t}}}},tc=[Hi,$l,Il,Ll,Ul,Kl,Jl,Ql,Xl,Zl,ec];ll(tc,{mixoutsTo:J});J.noAuto;var $e=J.config;J.library;J.dom;var ha=J.parse;J.findIconDefinition;J.toHtml;var rc=J.icon;J.layer;J.text;J.counter;function sc(r){return r=r-0,r===r}function pa(r){return sc(r)?r:(r=r.replace(/[_-]+(.)?/g,(e,t)=>t?t.toUpperCase():""),r.charAt(0).toLowerCase()+r.slice(1))}function ac(r){return r.charAt(0).toUpperCase()+r.slice(1)}var Se=new Map,oc=1e3;function nc(r){if(Se.has(r))return Se.get(r);const e={};let t=0;const s=r.length;for(;t<s;){const a=r.indexOf(";",t),o=a===-1?s:a,n=r.slice(t,o).trim();if(n){const l=n.indexOf(":");if(l>0){const c=n.slice(0,l).trim(),f=n.slice(l+1).trim();if(c&&f){const d=pa(c);e[d.startsWith("webkit")?ac(d):d]=f}}}t=o+1}if(Se.size===oc){const a=Se.keys().next().value;a&&Se.delete(a)}return Se.set(r,e),e}function va(r,e,t={}){if(typeof e=="string")return e;const s=(e.children||[]).map(d=>va(r,d)),a=e.attributes||{},o={};for(const[d,u]of Object.entries(a))switch(!0){case d==="class":{o.className=u;break}case d==="style":{o.style=nc(String(u));break}case d.startsWith("aria-"):case d.startsWith("data-"):{o[d.toLowerCase()]=u;break}default:o[pa(d)]=u}const{style:n,role:l,"aria-label":c,...f}=t;return n&&(o.style=o.style?{...o.style,...n}:n),l&&(o.role=l),c&&(o["aria-label"]=c,o["aria-hidden"]="false"),r(e.tag,{...f,...o},...s)}var ic=va.bind(null,Yr.createElement),Ur=(r,e)=>{const t=x.useId();return r||(e?t:void 0)},lc=class{constructor(r="react-fontawesome"){this.enabled=!1;let e=!1;try{e=typeof process<"u"&&!1}catch{}this.scope=r,this.enabled=e}log(...r){this.enabled&&console.log(`[${this.scope}]`,...r)}warn(...r){this.enabled&&console.warn(`[${this.scope}]`,...r)}error(...r){this.enabled&&console.error(`[${this.scope}]`,...r)}},cc="searchPseudoElementsFullScan"in $e?"7.0.0":"6.0.0",dc=Number.parseInt(cc)>=7,_e="fa",ae={beat:"fa-beat",fade:"fa-fade",beatFade:"fa-beat-fade",bounce:"fa-bounce",shake:"fa-shake",spin:"fa-spin",spinPulse:"fa-spin-pulse",spinReverse:"fa-spin-reverse",pulse:"fa-pulse"},uc={left:"fa-pull-left",right:"fa-pull-right"},fc={90:"fa-rotate-90",180:"fa-rotate-180",270:"fa-rotate-270"},gc={"2xs":"fa-2xs",xs:"fa-xs",sm:"fa-sm",lg:"fa-lg",xl:"fa-xl","2xl":"fa-2xl","1x":"fa-1x","2x":"fa-2x","3x":"fa-3x","4x":"fa-4x","5x":"fa-5x","6x":"fa-6x","7x":"fa-7x","8x":"fa-8x","9x":"fa-9x","10x":"fa-10x"},oe={border:"fa-border",fixedWidth:"fa-fw",flip:"fa-flip",flipHorizontal:"fa-flip-horizontal",flipVertical:"fa-flip-vertical",inverse:"fa-inverse",rotateBy:"fa-rotate-by",swapOpacity:"fa-swap-opacity",widthAuto:"fa-width-auto"};function mc(r){const e=$e.cssPrefix||$e.familyPrefix||_e;return e===_e?r:r.replace(new RegExp(String.raw`(?<=^|\s)${_e}-`,"g"),`${e}-`)}function hc(r){const{beat:e,fade:t,beatFade:s,bounce:a,shake:o,spin:n,spinPulse:l,spinReverse:c,pulse:f,fixedWidth:d,inverse:u,border:m,flip:g,size:S,rotation:C,pull:A,swapOpacity:N,rotateBy:p,widthAuto:y,className:R}=r,b=[];return R&&b.push(...R.split(" ")),e&&b.push(ae.beat),t&&b.push(ae.fade),s&&b.push(ae.beatFade),a&&b.push(ae.bounce),o&&b.push(ae.shake),n&&b.push(ae.spin),c&&b.push(ae.spinReverse),l&&b.push(ae.spinPulse),f&&b.push(ae.pulse),d&&b.push(oe.fixedWidth),u&&b.push(oe.inverse),m&&b.push(oe.border),g===!0&&b.push(oe.flip),(g==="horizontal"||g==="both")&&b.push(oe.flipHorizontal),(g==="vertical"||g==="both")&&b.push(oe.flipVertical),S!=null&&b.push(gc[S]),C!=null&&C!==0&&b.push(fc[C]),A!=null&&b.push(uc[A]),N&&b.push(oe.swapOpacity),dc?(p&&b.push(oe.rotateBy),y&&b.push(oe.widthAuto),($e.cssPrefix||$e.familyPrefix||_e)===_e?b:b.map(mc)):b}var pc=r=>typeof r=="object"&&"icon"in r&&!!r.icon;function Mr(r){if(r)return pc(r)?r:ha.icon(r)}function vc(r){return Object.keys(r)}var zr=new lc("FontAwesomeIcon"),ya={border:!1,className:"",mask:void 0,maskId:void 0,fixedWidth:!1,inverse:!1,flip:!1,icon:void 0,listItem:!1,pull:void 0,pulse:!1,rotation:void 0,rotateBy:!1,size:void 0,spin:!1,spinPulse:!1,spinReverse:!1,beat:!1,fade:!1,beatFade:!1,bounce:!1,shake:!1,symbol:!1,title:"",titleId:void 0,transform:void 0,swapOpacity:!1,widthAuto:!1},yc=new Set(Object.keys(ya)),lt=Yr.forwardRef((r,e)=>{const t={...ya,...r},{icon:s,mask:a,symbol:o,title:n,titleId:l,maskId:c,transform:f}=t,d=Ur(c,!!a),u=Ur(l,!!n),m=Mr(s);if(!m)return zr.error("Icon lookup is undefined",s),null;const g=hc(t),S=typeof f=="string"?ha.transform(f):f,C=Mr(a),A=rc(m,{...g.length>0&&{classes:g},...S&&{transform:S},...C&&{mask:C},symbol:o,title:n,titleId:u,maskId:d});if(!A)return zr.error("Could not find icon",m),null;const{abstract:N}=A,p={ref:e};for(const y of vc(t))yc.has(y)||(p[y]=t[y]);return ic(N[0],p)});lt.displayName="FontAwesomeIcon";const xc=({onNavigate:r})=>{const[e,t]=x.useState(!1),[s,a]=x.useState(null),[o,n]=x.useState(lr());x.useEffect(()=>{const u=Hr(ge,m=>{n(lr()),console.log("Auth state changed:",m?"User logged in":"User logged out")});return()=>u()},[]);const{user:l,isAuthenticated:c}=o,f=async()=>{t(!0),a(null);try{const u=await Xa();u.success?console.log("Successfully signed in:",u.user):a(u.error||"An error occurred during login")}catch(u){console.error("Login error:",u),a("An error occurred during login")}finally{t(!1)}},d=async()=>{t(!0),a(null);try{const u=await ts();u.success?console.log("Successfully signed out"):a(u.error||"An error occurred during logout")}catch(u){console.error("Logout error:",u),a("An error occurred during logout")}finally{t(!1)}};return c&&l?i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex gap-5",children:[i.jsxs("div",{className:"flex-1 flex items-center space-x-3",children:[l.photoURL&&i.jsx("img",{src:l.photoURL,alt:"Profile",className:"hidden w-10 h-10 rounded-full border-2 border-green-300"}),i.jsx("div",{className:"flex-1",children:i.jsxs("button",{onClick:()=>r?.("profile"),className:"flex items-center gap-2 text-sm font-rounded font-semibold text-green-800 hover:text-green-600 hover:underline transition-colors duration-200",children:[i.jsx(lt,{icon:Lo,className:"text-green-800 w-3 h-3"}),l.displayName||l.email||"Logged in"]})})]}),i.jsx("button",{onClick:d,disabled:e,className:`\r
              m-1 py-1 px-2 rounded-md font-rounded text-sm\r
              text-gray-800 \r
              hover:bg-red-200 hover:border-red-400 \r
              hover:text-red-700\r
              disabled:opacity-50 disabled:cursor-not-allowed\r
              transition-colors duration-200\r
            `,children:e?"‚åõ logging out...":"Log out"})]}),s&&i.jsx("div",{className:"text-xs text-red-600 text-center font-rounded",children:s})]}):i.jsxs("div",{className:"space-y-3",children:[i.jsxs("button",{onClick:f,disabled:e,className:`\r
          w-full flex items-center justify-center gap-3 py-2 px-4 \r
          bg-white border border-gray-300 rounded-3xl\r
          text-gray-700 text-sm font-rounded font-medium\r
          hover:bg-gray-50 hover:border-gray-400\r
          disabled:opacity-50 disabled:cursor-not-allowed\r
          transition-all duration-200\r
          shadow-sm hover:shadow-md\r
        `,children:[!e&&i.jsxs("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",className:"w-5 h-5",children:[i.jsx("path",{fill:"#EA4335",d:"M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"}),i.jsx("path",{fill:"#4285F4",d:"M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"}),i.jsx("path",{fill:"#FBBC05",d:"M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"}),i.jsx("path",{fill:"#34A853",d:"M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"}),i.jsx("path",{fill:"none",d:"M0 0h48v48H0z"})]}),e?"‚åõ Signing in...":"Continue with Google"]}),i.jsx("div",{className:"text-xs font-rounded text-gray-600 text-center space-y-1",children:i.jsx("div",{children:"To save learning progress"})}),s&&i.jsx("div",{className:"text-xs text-red-600 text-center font-rounded",children:s})]})},rr=({children:r,size:e=24,className:t=""})=>{function s(n){return[...n].map(c=>{const f=c.codePointAt(0);if(!f)return"";const d=f.toString(16).toLowerCase();return d.length<=4?d.padStart(4,"0"):d}).filter(c=>c!==""&&c!=="fe0f").join("-")}const o=`https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/${s(r)}.svg`;return i.jsx("span",{className:`flex justify-center items-center ${t}`,children:i.jsx("img",{src:o,alt:r,className:"inline-block",style:{width:`${e}px`,height:`${e}px`,verticalAlign:"middle"},loading:"lazy",onError:n=>{const c=n.target.parentElement;c&&(c.innerHTML=r,c.style.fontSize=`${e*.8}px`)}})})},Gr=({onNavigate:r})=>{const{state:e,startReviewSession:t,resetProgress:s,clearError:a,getReviewSessionSize:o}=me(),n=()=>{console.log("Dashboard: Start Review button clicked",{dueCards:e.stats.dueCards,isLoading:e.isLoading}),e.stats.dueCards>0&&!e.isLoading&&(t(),r("review"))},l=async()=>{console.log("Dashboard: Reset Progress button clicked");try{await s()}catch(c){console.error("Failed to reset progress:",c)}};return e.isLoading?i.jsx("div",{className:"min-h-screen flex items-center justify-center",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),i.jsx("p",{className:"text-lg font-rounded text-gray-600",children:"Loading flashcards..."})]})}):i.jsx("div",{className:"min-h-screen flex",children:i.jsxs("div",{className:"w-full flex flex-col items-center justify-center p-4",children:[i.jsxs("div",{className:"max-w-md w-full bg-white/80 backdrop-blur-md p-5 rounded-3xl shadow-lg",children:[e.error&&i.jsxs("div",{className:"mb-2 p-4 bg-red-50 border border-red-200 rounded-2xl",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"text-red-500 mr-2",children:e.error.code.includes("CARD_SET")?"üìö":e.error.code.includes("NETWORK")?"üåê":e.error.code.includes("FIRESTORE")?"‚òÅÔ∏è":"‚ö†Ô∏è"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm text-red-700 font-medium",children:e.error.message}),e.error.context?.cardSetId&&i.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Card Set: ",e.error.context.cardSetId]})]})]}),i.jsxs("div",{className:"flex items-center justify-between mt-2",children:[i.jsx("button",{onClick:()=>a(),className:"text-xs text-red-600 hover:text-red-800 underline",children:"Dismiss"}),e.error.retryable&&e.selectedCardSet?.dataFile&&i.jsx("button",{onClick:()=>{a(),e.selectedCardSet?.dataFile&&console.log("Dashboard: Retrying card set load")},className:"text-xs bg-red-100 text-red-700 hover:bg-red-200 px-2 py-1 rounded transition-colors duration-200",children:"Try Again"})]})]}),i.jsx("button",{onClick:()=>{console.log("Dashboard: All Sets button clicked"),r("card-sets")},className:"absolute -top-10 left-5 flex py-1 px-0 items-center text-sm font-rounded text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-colors duration-200",style:{zIndex:20},children:i.jsx("span",{children:"‚Üê Back"})}),i.jsx("div",{className:"absolute top-5 right-5",children:i.jsxs("button",{onClick:c=>{const f=e.selectedCardSet?.name||"Flashcards",d=e.selectedCardSet?.id;let u=window.location.origin;d?u+=`/${d}`:u=window.location.href;const m=window.innerWidth>768||!("ontouchstart"in window);navigator.share&&!m?navigator.share({title:`${f} - Smart Flashcards`,text:`Check out this flashcard set: ${f}`,url:u}).catch(g=>{console.log("Error sharing:",g)}):navigator.clipboard.writeText(u).then(()=>{const g=c.target,S=g.textContent;g.textContent="‚úì Copied!",setTimeout(()=>{g.textContent=S},2e3)}).catch(g=>{console.log("Error copying to clipboard:",g)})},className:"flex py-1 px-2 items-center text-sm font-rounded text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-colors duration-200",title:"Share this card set",children:[i.jsx(lt,{icon:$o,className:"w-4 h-4"}),"¬†"]})}),i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("div",{className:"text-6xl mb-4",children:i.jsx(rr,{size:64,children:e.selectedCardSet?.cover||"üá®üá≥"})}),i.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-1",children:e.selectedCardSet?.name||"Chinese HSK-1"}),i.jsx("p",{className:"text-[10px] text-gray-400 uppercase tracking-wider mb-1",children:e.selectedCardSet?.description||"HSK level 1 vocabulary set 1 with English translations"}),i.jsxs("p",{className:"text-gray-400 font-medium",children:[e.stats.totalCards||10," cards"]})]}),i.jsxs("div",{className:"w-full bg-white border border-gray-50 rounded-[32px] grid grid-cols-3 py-6 px-2 mb-10 shadow-[0_0_20px_rgba(0,0,0,0.02)]",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl mb-1",children:"üèÜ"}),i.jsx("div",{className:"text-4xl font-bold text-green-500 leading-none mb-1",children:e.stats.masteredCards}),i.jsx("div",{className:"text-[10px] text-gray-400 font-semibold uppercase",children:"Completed"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl mb-1",children:"üí™"}),i.jsx("div",{className:"text-4xl font-bold text-orange-400 leading-none mb-1",children:e.stats.difficultCards}),i.jsx("div",{className:"text-[10px] text-gray-400 font-semibold uppercase",children:"Learning"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl mb-1",children:"‚≠ê"}),i.jsx("div",{className:"text-4xl font-bold text-yellow-400 leading-none mb-1",children:e.stats.reviewsToday}),i.jsx("div",{className:"text-[10px] text-gray-400 font-semibold uppercase",children:"Updated Today"})]})]}),i.jsxs("div",{className:"flex flex-col gap-4",children:[i.jsx("button",{onClick:n,disabled:e.stats.dueCards===0||e.isLoading,className:`
                w-full py-3 rounded-2xl font-bold font-child text-3xl 
                transform transition-all duration-200
                ${e.stats.dueCards>0&&!e.isLoading?"bg-gradient-to-r from-primary-500 to-primary-600 text-white hover:scale-[102%] hover:shadow-2xl hover:shadow-primary-500/30 active:scale-95 active:shadow-lg active:shadow-primary-500/20":"bg-gray-300 text-gray-500 border-gray-400 cursor-not-allowed"}
              `,children:e.isLoading?i.jsx("div",{className:"flex items-center justify-center",children:i.jsx("span",{children:"Loading cards..."})}):e.stats.dueCards>0?i.jsx("div",{className:"flex items-center justify-center",children:i.jsx("span",{children:"Start Review"})}):i.jsx("div",{className:"flex items-center justify-center",children:i.jsx("span",{children:"üéâ Done! See you tomorrow"})})}),i.jsxs("div",{className:"flex flex-col",children:[!e.isLoading&&e.stats.dueCards>0?i.jsx("div",{className:"w-full text-center text-md text-primary-900"}):null,i.jsx("button",{onClick:l,disabled:e.loadingStates.savingProgress,className:`
                w-full font-rounded text-xs transition-colors duration-200
                py-2
                ${e.loadingStates.savingProgress?"bg-transparent text-gray-300 cursor-not-allowed":"bg-transparent text-gray-400 hover:text-gray-500"}
              `,children:e.loadingStates.savingProgress?i.jsxs("span",{className:"flex items-center justify-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b border-gray-300 mr-1"}),"Resetting..."]}):"Reset progress"})]})]})]}),i.jsx("div",{className:"mt-4",children:i.jsx(xc,{onNavigate:r})})]})})},bc=({session:r})=>{if(!r)return console.warn("ReviewProgress: No session data provided"),null;const e=r.totalCards>0?r.reviewedCards/r.totalCards*100:0,t=Math.min(Math.max(e,0),100);return i.jsx("div",{className:"p-4 bg-white shadow-sm",children:i.jsxs("div",{className:"max-w-md mx-auto",children:[i.jsxs("div",{className:"mb-3",children:[i.jsxs("div",{className:"flex justify-between text-sm font-rounded text-gray-700 mb-1",children:[i.jsx("span",{children:"Progress"}),i.jsxs("span",{children:[r.reviewedCards," / ",r.totalCards," completed"]})]}),i.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:i.jsx("div",{className:"bg-gradient-to-r from-primary-500 to-primary-600 h-3 rounded-full transition-all duration-300",style:{width:`${t}%`},role:"progressbar","aria-valuenow":t,"aria-valuemin":0,"aria-valuemax":100,"aria-label":`Progress: ${Math.round(t)}% complete`})})]}),i.jsx("div",{className:"flex justify-between text-sm font-rounded text-gray-700",children:i.jsxs("span",{children:["Reviewed: ",r.reviewedCards]})})]})})},Wr=({size:r="medium",message:e,type:t="primary"})=>{const s={small:"w-4 h-4",medium:"w-8 h-8",large:"w-12 h-12"},a={primary:"border-blue-500",secondary:"border-gray-500",success:"border-green-500",warning:"border-yellow-500",error:"border-red-500"};return i.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[i.jsx("div",{className:`
          ${s[r]} 
          ${a[t]}
          border-2 border-t-transparent 
          rounded-full 
          animate-spin
        `}),e&&i.jsx("p",{className:"text-sm text-gray-600 animate-pulse",children:e})]})},Sc=({onNavigate:r})=>{const{state:e,showCardBack:t,rateCard:s,knowCard:a,resetSession:o,updateCurrentCardSetProgress:n}=me(),[l,c]=x.useState(!1);x.useEffect(()=>{e.currentCard?.id&&c(!1)},[e.currentCard?.id]),x.useEffect(()=>{if(!e.currentSession){console.log("Review: No session found, redirecting to dashboard"),r("dashboard");return}if(e.currentSession.isComplete){console.log("Review: Session is complete, redirecting to complete screen"),r("complete");return}},[e.currentSession,e.currentSession?.isComplete,r]);const f=()=>{a(),c(!1)},d=async()=>{if(!e.isGuest&&e.currentSession){console.log("Review: Updating card set progress before returning to dashboard");try{await n()}catch(N){console.error("Review: Failed to update progress:",N)}}o(),r("dashboard")},u=()=>{c(!0),setTimeout(()=>{t()},300)},m=N=>{s(N),c(!1),e.isShowingBack=!1,setTimeout(()=>{e.isShowingBack=!0},300)};if(console.log("Review component state check:",{hasSession:!!e.currentSession,hasCard:!!e.currentCard,isComplete:e.currentSession?.isComplete,savingProgress:e.loadingStates?.savingProgress}),!e.currentSession||e.currentSession.isComplete)return null;if(!e.currentCard)return i.jsx("div",{className:"min-h-screen flex items-center justify-center",children:i.jsx(Wr,{size:"large",message:"Preparing next card...",type:"primary"})});if(!e.currentSession.cards.some(N=>N.id===e.currentCard?.id))return console.warn("Review: Card validation failed - current card doesn't belong to session cards",{currentCardId:e.currentCard.id,sessionCardIds:e.currentSession.cards.map(N=>N.id),currentCardSet:e.selectedCardSet?.name}),o(),r("dashboard"),i.jsx("div",{className:"min-h-screen flex items-center justify-center",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-red-500 text-xl mb-4",children:"‚ö†Ô∏è"}),i.jsx("p",{className:"text-lg font-rounded text-gray-600 mb-4",children:"Card set mismatch detected. Returning to dashboard..."}),i.jsx(Wr,{size:"medium",type:"error"})]})});const{currentSession:S,currentCard:C,isShowingBack:A}=e;return i.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-blue-50 via-yellow-50 to-green-50",children:[i.jsx(bc,{session:S}),i.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:i.jsxs("div",{className:"max-w-md w-full",children:[i.jsx(Ma,{card:C,isShowingBack:A,isFlipping:l,formatText:za}),i.jsx("div",{className:"space-y-4",children:A?i.jsxs("div",{className:"space-y-3",children:[i.jsx("div",{className:"text-center mb-4"}),i.jsxs("div",{className:"flex gap-4",children:[i.jsx("button",{onClick:()=>m(pe.SKIP),className:`\r
                      w-full py-4 px-6\r
                      bg-gradient-to-r from-[#1976D2] to-[#1976D2]\r
                      text-white \r
                      rounded-2xl\r
                      font-bold\r
                      font-child\r
                      text-lg\r
                      shadow-lg                      \r
                      hover:from-blue-700 hover:to-[#1976D2]\r
                      transform hover:scale-105 active:scale-95\r
                      transition-all duration-200\r
                      flex items-center justify-center space-x-2\r
                      [text-shadow:2px_2px_10px_rgba(0,0,0,0.4)]\r
                    `,children:i.jsx("span",{children:"Skip"})}),i.jsx("button",{onClick:()=>m(pe.HARD),className:`\r
                      w-full py-4 px-6 \r
                      bg-gradient-to-r from-red-600 to-red-500\r
                      text-white\r
                      rounded-2xl\r
                      font-bold\r
                      font-child \r
                      text-lg\r
                      shadow-lg\r
                      hover:from-[#DE2929] hover:to-[#DE2929]\r
                      transform hover:scale-105 active:scale-95\r
                      transition-all duration-200\r
                      flex items-center justify-center space-x-2\r
                      [text-shadow:2px_2px_10px_rgba(0,0,0,0.4)]\r
                    `,children:i.jsx("span",{children:"Hard"})}),i.jsx("button",{onClick:()=>m(pe.GOOD),className:`\r
                      w-full py-4 px-6 \r
                      bg-gradient-to-r from-[#2E7D32] to-[#2E7D32]\r
                      text-white\r
                      rounded-2xl \r
                      font-bold \r
                      font-child \r
                      text-lg \r
                      shadow-lg\r
                      hover:from-green-600 hover:to-green-600\r
                      transform hover:scale-105 active:scale-95 \r
                      transition-all duration-200\r
                      flex items-center justify-center space-x-2\r
                      [text-shadow:2px_2px_10px_rgba(0,0,0,0.4)]\r
                    `,children:i.jsx("span",{children:"Got It"})})]})]}):i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx("button",{onClick:u,className:`\r
                    py-4 px-6 bg-gradient-to-r from-blue-500 to-blue-600 text-white \r
                    rounded-2xl font-medium font-child text-lg shadow-lg\r
                    hover:from-blue-600 hover:to-blue-700 \r
                    transform hover:scale-105 active:scale-95 transition-all duration-200\r
                  `,children:"Show Me"}),i.jsx("button",{onClick:f,className:`\r
                    py-4 px-6 bg-gradient-to-r from-green-500 to-green-600 text-white \r
                    rounded-2xl font-medium font-child text-lg shadow-lg\r
                    hover:from-green-600 hover:to-green-700 \r
                    transform hover:scale-105 active:scale-95 transition-all duration-200\r
                  `,children:"Confident  ‚úî"})]})}),i.jsx("div",{className:"mt-6 text-center",children:i.jsx("button",{onClick:d,className:`\r
                py-2 px-4 text-gray-500 font-rounded text-sm\r
                hover:text-gray-700 transition-colors duration-200\r
              `,children:"‚Üê Back to Dashboard"})})]})})]})},wc=({onNavigate:r})=>{const{state:e,resetSession:t,startReviewSession:s,updateCurrentCardSetProgress:a}=me(),o=x.useRef(!1);if(x.useEffect(()=>{(async()=>{if(e.currentSession?.isComplete&&!e.isGuest&&!o.current){console.log("Completion: Updating card set progress after session completion"),o.current=!0;try{await a()}catch(g){console.error("Completion: Failed to update progress:",g)}}})()},[e.currentSession?.isComplete,e.isGuest]),!e.currentSession||e.loadingStates?.savingProgress)return i.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-yellow-50 to-green-50",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-200 border-t-yellow-300 border-r-green-200 border-b-blue-300 mx-auto mb-4 opacity-70"}),i.jsx("p",{className:"text-lg font-rounded text-yellow-900/60",children:e.loadingStates?.savingProgress?"Saving your progress...":"Loading results..."})]})});if(!e.currentSession.isComplete)return console.log("Session not complete, redirecting to dashboard"),r("dashboard"),null;const{currentSession:n}=e,l=n.reviewedCards>0?Math.round(n.easyCount/n.reviewedCards*100):0,c=()=>{o.current=!1,t(),r("card-sets")},f=()=>{e.stats.dueCards>0?(o.current=!1,t(),s(),r("review")):c()},u=l>=90?{emoji:"üåü",message:"Outstanding!",subtext:"You're a vocabulary superstar!"}:l>=75?{emoji:"üéâ",message:"Great job!",subtext:"You're making excellent progress!"}:l>=50?{emoji:"üëç",message:"Good work!",subtext:"Keep practicing and you'll improve!"}:{emoji:"üí™",message:"Keep trying!",subtext:"Every practice session makes you stronger!"};return i.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-blue-50 via-yellow-50 to-green-50",children:i.jsxs("div",{className:"max-w-md w-full",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("div",{className:"text-8xl mb-4 animate-bounce-slow",children:u.emoji}),i.jsx("h1",{className:"text-4xl font-bold font-child text-primary-600 mb-2",children:u.message}),i.jsx("p",{className:"text-lg font-rounded text-gray-600",children:u.subtext})]}),i.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl border-4 border-white p-8 mb-8 flex flex-col items-center",children:[i.jsxs("div",{className:"w-full grid grid-cols-2 gap-4 mb-2",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-4xl font-bold font-child text-sky-600",children:n.reviewedCards}),i.jsx("div",{className:"text-base font-rounded text-gray-500 mt-1",children:"Card"})]}),i.jsxs("div",{className:"text-center",children:[i.jsxs("div",{className:"text-4xl font-bold font-child text-green-600",children:[l," ",i.jsx("span",{className:"text-4xl",children:"%"})]}),i.jsx("div",{className:"text-base font-rounded text-gray-500 mt-1",children:"Accuracy"})]})]}),i.jsx("hr",{className:"w-full border-gray-200 my-2"}),i.jsxs("div",{className:"w-full grid grid-cols-3 gap-4 mb-2",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-3xl font-bold font-child text-rose-400",children:n.againCount??0}),i.jsx("div",{className:"text-base font-rounded text-gray-500 mt-1",children:"Skip"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-3xl font-bold font-child text-orange-400",children:n.hardCount}),i.jsx("div",{className:"text-base font-rounded text-gray-500 mt-1",children:"Hard"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-3xl font-bold font-child text-green-500",children:n.easyCount}),i.jsx("div",{className:"text-base font-rounded text-gray-500 mt-1",children:"Confident"})]})]}),i.jsx("hr",{className:"w-full border-gray-200 my-2"}),i.jsx("div",{className:"w-full text-center mt-2 mb-1",children:i.jsxs("span",{className:"text-base font-rounded text-gray-500",children:["Time used ",i.jsxs("span",{className:"font-bold text-gray-700",children:[Math.round((Date.now()-n.startTime.getTime())/1e3/60)," minutes"]})]})})]}),i.jsxs("div",{className:"flex flex-col items-center gap-6",children:[e.stats.dueCards>0?i.jsxs("button",{onClick:f,className:"w-full py-4 px-6 bg-sky-600 text-white rounded-2xl font-bold font-child text-xl shadow-lg hover:bg-sky-700 transform hover:scale-[1.03] active:scale-95 transition-all duration-200 flex items-center justify-center",children:[i.jsx("span",{className:"mr-2 text-2xl",children:"‚Üí"})," Continue (",e.stats.dueCards," left)"]}):null,i.jsxs("button",{onClick:c,className:"mt-2 text-gray-700 font-rounded text-lg flex items-center justify-center gap-2 hover:text-black transition-colors duration-200 bg-transparent",children:[i.jsx("span",{className:"text-xl",children:"‚Üê"})," Main menu"]})]})]})})},Br=({cardSet:r,progress:e=0,showProgress:t=!1,onClick:s,theme:a="light"})=>{const o=a==="light"?"bg-white text-gray-700":"bg-[#E3F2FD] text-gray-700";return i.jsxs("div",{onClick:s,className:`${o} backdrop-blur-md px-4 py-4 sm:px-4 sm:py-4 rounded-2xl sm:rounded-3xl shadow-md hover:shadow-xl hover:scale-[102%] transition-all duration-200 cursor-pointer`,children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"text-2xl sm:text-3xl mr-3",children:i.jsx(rr,{size:40,children:r.cover})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("h3",{className:"text-base sm:text-lg font-medium font-child mb-1 truncate",children:r.name}),!t&&i.jsx("p",{className:"text-xs sm:text-sm font-rounded h-10",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",lineHeight:"1.25rem"},children:r.description})]})]}),t&&i.jsxs("div",{className:"mb-3",children:[i.jsx("div",{className:"flex justify-end text-xs font-rounded mb-1",children:i.jsxs("span",{children:[e,"%"]})}),i.jsx("div",{className:"w-full bg-white rounded-full h-2.5",children:i.jsx("div",{className:"bg-gradient-to-r from-primary-500 to-primary-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${e}%`}})})]}),i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("span",{className:"text-xs sm:text-sm font-rounded pt-3",children:[r.cardCount," cards left"]}),t&&i.jsx(i.Fragment,{children:e===100?i.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs font-rounded rounded-full",children:"‚úì Complete"}):e>0?i.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-s font-rounded rounded-full",children:"Continue ‚Üí"}):null})]})]})},Cc=({message:r="Loading...",description:e="Please wait"})=>i.jsxs("div",{className:"text-center py-12",children:[i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),i.jsx("h2",{className:"text-xl font-child text-gray-600 mt-4 mb-2",children:r}),i.jsx("p",{className:"text-sm font-rounded text-gray-500",children:e})]}),Ec=({isOpen:r,onClose:e,cardsPerSession:t,setCardsPerSession:s,darkMode:a,setDarkMode:o,accessibility:n,setAccessibility:l})=>r?i.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[i.jsx("div",{onClick:e,className:"absolute inset-0 bg-black/30 backdrop-blur-sm"}),i.jsxs("div",{className:"relative w-full max-w-md bg-white rounded-2xl shadow-xl p-6",children:[i.jsx("h2",{className:"text-lg font-medium font-child mb-4",children:"Review"}),i.jsx("div",{className:"flex gap-2 mb-3",children:[10,20,30].map(c=>i.jsxs("button",{onClick:()=>s(c),className:`px-4 py-2 rounded-full text-sm font-rounded transition
                ${t===c?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[c," Cards"]},c))}),i.jsxs("p",{className:"text-xs font-light text-gray-500 mb-6",children:["Choose how many cards to review in each session. Current: ",t]}),i.jsxs("div",{className:"flex items-center justify-between py-3 border-t",children:[i.jsx("span",{className:"font-rounded font-light text-sm",children:"Theme"}),i.jsx("button",{onClick:()=>o(!a),className:`w-10 h-6 rounded-full flex items-center px-1 transition ${a?"bg-yellow-400":"bg-gray-300"}`,children:i.jsx("span",{className:`w-4 h-4 bg-white rounded-full transition ${a?"translate-x-4":""}`})})]}),i.jsx("h3",{className:"text-lg font-medium font-child mb-4",children:"Accessibility"}),[["voice","Voice over"],["translation","Translation options"],["pronunciation","Pronunciation"],["example","Example sentence "]].map(([c,f])=>i.jsxs("div",{className:"flex items-center justify-between py-2",children:[i.jsx("span",{className:"text-sm font-light font-rounded",children:f}),i.jsx("button",{onClick:()=>l(c),className:`w-10 h-6 rounded-full flex items-center px-1 transition ${n[c]?"bg-blue-500":"bg-gray-300"}`,children:i.jsx("span",{className:`w-4 h-4 bg-white rounded-full transition ${n[c]?"translate-x-4":""}`})})]},c))]})]}):null;function Ac(){const[r,e]=x.useState([]),[t,s]=x.useState(!0);return x.useEffect(()=>{(async()=>{s(!0);try{const o=`?v=${Date.now()}`,n=await fetch(`/data/card_set.json${o}`);if(!n.ok)throw new Error(`Failed to load: ${n.status}`);const c=(await n.json()).map(f=>({id:f.id,name:f.name,description:f.description,cover:f.cover,cardCount:f.cardCount,category:f.category,tags:f.tags,dataFile:f.dataFile,author:f.author,isActive:f.isActive,difficulty:f.difficulty,createdAt:f.createdAt,updatedAt:f.updatedAt}));e(c),console.log("useCardSets: Loaded",c.length,"card sets")}catch(o){console.error("useCardSets: Error:",o),e([])}finally{s(!1)}})()},[]),{cardSets:r,isLoading:t}}function Nc(){const{state:r}=rt(),{state:e,loadAllCardSetProgress:t}=me(),[s,a]=x.useState({}),[o,n]=x.useState(!1),[l,c]=x.useState(null);return x.useEffect(()=>{(async()=>{if(!r.isAuthLoading&&!o)if(!r.isGuest&&r.user){const d=r.user.uid;if(l===d&&Object.keys(s).length>0)return;n(!0);try{const u=await t();a(u),c(d),console.log("useCardSetProgress: Loaded",Object.keys(u).length,"sets")}catch(u){console.error("useCardSetProgress: Error:",u),a({})}finally{n(!1)}}else c(null),a({hsk_1_set_1_english:25,chinese_essentials_1:60,ielts_adjective_thai:0})})()},[r.isGuest,r.user,r.isAuthLoading,t,e.progressVersion]),{progressData:s,isLoading:o}}function Dc(r,e){return r.map(t=>({...t,progress:e[t.id]||0}))}function Pc(r){return r.reduce((e,t)=>{const s=t.category||"Other";return e[s]||(e[s]=[]),e[s].push(t),e},{})}const Rc=({onNavigate:r})=>{const{setSelectedCardSet:e}=me(),{state:t}=rt(),{cardSets:s,isLoading:a}=Ac(),{progressData:o}=Nc(),[n,l]=x.useState(!1),[c,f]=x.useState(!1),[d,u]=x.useState(20),[m,g]=x.useState(!1),[S,C]=x.useState({voice:!0,translation:!1,pronunciation:!1,example:!0}),A=b=>{C($=>({...$,[b]:!$[b]}))},N=Dc(s,o),p=Pc(N),y=b=>{const $=b.target;l($.scrollTop>0)},R=async b=>{console.log("CardSetSelection: Card set selected",{id:b.id,name:b.name,cardCount:b.cardCount,progress:b.progress});const{progress:$,...K}=b;e(K),console.log(`CardSetSelection: Set selected card set to ${K.name} (${K.dataFile})`),r("dashboard")};return i.jsxs("div",{className:"min-h-screen from-blue-50",children:[i.jsxs("div",{className:"h-screen flex flex-col",children:[i.jsx("div",{className:`sticky top-0 z-10 backdrop-blur-md border-b border-white/20 p-4 pb-2 transition-shadow duration-300 ${n?"shadow-md shadow-black/10":""}`,children:i.jsx("div",{className:"max-w-7xl w-full mx-auto",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("div",{className:"w-10"}),i.jsx("h1",{className:"text-xl sm:text-2xl font-child text-gray-700",children:"Card Sets"}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("button",{onClick:()=>f(!0),className:"text-gray-600 hover:text-gray-800 transition",title:"Settings",children:i.jsx("img",{src:"/assets/setting.png",alt:"Settings",className:"w-5 h-5 transition-transform hover:rotate-180 duration-300"})}),!t.isGuest&&t.user?i.jsxs("button",{onClick:()=>r("profile"),className:"flex items-center gap-2 text-sm font-rounded font-semibold text-green-800 hover:text-green-600 transition-colors",children:[t.user.photoURL?i.jsx("img",{src:t.user.photoURL,alt:"Profile",className:"w-8 h-8 rounded-full border border-green-300"}):i.jsx("span",{className:"w-8 h-8 rounded-full bg-green-200 flex items-center justify-center text-xs",children:"üë§"}),i.jsx("span",{className:"hidden sm:inline",children:t.user.displayName||t.user.email})]}):null,i.jsxs("button",{onClick:()=>r("subscription"),className:`px-3 py-1.5 text-xs sm:text-sm font-rounded font-thin\r
                             bg-[#F59E0B] text-white rounded-full\r
                             hover:bg-gray-800 transition-all duration-200\r
                             flex items-center gap-1.5`,children:[i.jsx("img",{src:"/assets/plus.png",alt:"Plus",className:"w-4 h-4"}),"Upgrade Plus"]})]})]})})}),i.jsx("div",{className:"flex-1 overflow-auto",onScroll:y,children:i.jsxs("div",{className:"max-w-7xl w-full mx-auto p-4 pt-6",children:[!t.isGuest&&N.some(b=>b.progress>0)&&i.jsxs("div",{className:"mb-8",children:[i.jsxs("div",{className:"flex items-center p-1 mb-3",children:[i.jsx("div",{className:"text-2xl mr-3"}),i.jsx("div",{className:"flex- mr-5",children:i.jsx("h1",{className:"text-2xl font-semibold sm:text-[1.65rem] font-child text-[#374151]",children:"Your Progress"})}),i.jsxs("span",{className:"px-3 py-1 bg-blue-100 font-normal text-blue-700 text-xs font-rounded rounded-full",children:[N.filter(b=>b.progress>0).length,N.filter(b=>b.progress>0).length===1?" set":" sets"]})]}),i.jsx("div",{className:"grid gap-4 grid-cols-2 sm:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4",children:N.filter(b=>b.progress>0).map(b=>i.jsx(Br,{cardSet:b,progress:b.progress,showProgress:!0,onClick:()=>R(b),theme:"dark"},`progress-${b.id}`))})]}),Object.entries(p).map(([b,$])=>i.jsxs("div",{className:"mb-8",children:[i.jsxs("div",{className:"flex items-center p-4 rounded-2xl",children:[i.jsx("h2",{className:"text-lg font-medium sm:text-xl font-child text-gray-700",children:b}),i.jsxs("span",{className:"ml-3 px-2 py-1 bg-blue-100 text-blue-700 text-xs font-rounded rounded-full",children:[$.length," ",$.length===1?"set":"sets"]})]}),i.jsx("div",{className:"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 mb-10",children:$.map(K=>i.jsx(Br,{cardSet:K,onClick:()=>R(K)},K.id))})]},b)),a&&i.jsx(Cc,{message:"Loading Card Sets...",description:"Please wait while we load your flashcards"}),!a&&s.length===0&&i.jsxs("div",{className:"text-center py-12",children:[i.jsx(rr,{size:64,children:"üìö"}),i.jsx("h2",{className:"text-xl font-child text-gray-600 mt-4 mb-2",children:"No Card Sets Available"}),i.jsx("p",{className:"text-sm font-rounded text-gray-500",children:"Check back later for new content!"})]})]})})]}),i.jsx(Ec,{isOpen:c,onClose:()=>f(!1),cardsPerSession:d,setCardsPerSession:u,darkMode:m,setDarkMode:g,accessibility:S,setAccessibility:A})]})},jc=({onNavigate:r})=>{const{state:e,signOut:t}=rt(),{loadUserProfile:s,updateReviewSessionSize:a,getReviewSessionSize:o}=me(),[n,l]=x.useState(null),[c,f]=x.useState(!0),[d,u]=x.useState(!1),[m,g]=x.useState(!1),[S,C]=x.useState(null),A=o();x.useEffect(()=>{(async()=>{if(e.isGuest||!e.user){console.log("Profile: Guest user detected, redirecting to dashboard"),r("dashboard");return}try{f(!0);const Q=await s();l(Q)}catch(Q){console.error("Profile: Error loading user profile:",Q),l(null)}finally{f(!1)}})()},[e.isGuest,e.user,s,r]);const N=async()=>{try{u(!0),await t()}catch(I){console.error("Profile: Error signing out:",I)}finally{u(!1)}},p=()=>{console.log("Profile: Navigating back to main"),r("card-sets")},y=async I=>{try{if(g(!0),C(null),console.log(`Profile: Updating review session size to ${I}`),!await a(I))throw new Error("Failed to update review session size");console.log(`Profile: Review session size updated successfully to ${I}`)}catch(Q){console.error("Profile: Error updating session size:",Q),C(Q instanceof Error?Q.message:"Failed to update review session size. Please try again.")}finally{g(!1)}};if(c)return i.jsx("div",{className:"min-h-screen flex items-center justify-center from-blue-50",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),i.jsx("p",{className:"text-lg font-rounded text-gray-600",children:"Loading profile..."})]})});const R=n?.displayName||e.user?.displayName||"User",b=n?.email||e.user?.email||"",$=n?.photoURL||e.user?.photoURL||"",K=n?.createdAt?new Date(n.createdAt).toLocaleDateString():"Recently";return i.jsx("div",{className:"min-h-screen from-blue-50",children:i.jsxs("div",{className:"h-screen flex flex-col",children:[i.jsx("div",{className:"sticky top-0 z-10 from-blue-50 backdrop-blur-md border-b border-white/20 p-4 pb-2",children:i.jsx("div",{className:"max-w-md w-full mx-auto",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("button",{onClick:p,className:"flex items-center px-3 py-2 text-sm font-rounded text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-colors duration-200",children:[i.jsx("span",{className:"mr-2",children:"‚Üê"}),i.jsx("span",{children:"Back"})]}),i.jsx("h1",{className:"text-2xl font-child text-gray-700",children:"Profile"}),i.jsx("div",{className:"w-16"})]})})}),i.jsx("div",{className:"flex-1 overflow-auto",children:i.jsxs("div",{className:"max-w-md w-full mx-auto p-4 pt-6",children:[i.jsxs("div",{className:"bg-white/80 backdrop-blur-md rounded-2xl shadow-md p-4 mb-4",children:[i.jsxs("div",{className:"text-center mb-4",children:[i.jsx("div",{className:"mb-3",children:$?i.jsx("img",{src:$,alt:`${R}'s profile`,className:"w-16 h-16 rounded-full mx-auto border-2 border-gray-200 object-cover"}):i.jsx("div",{className:"w-16 h-16 rounded-full mx-auto border-2 border-gray-200 bg-gray-100 flex items-center justify-center",children:i.jsx("span",{className:"text-2xl",children:"üë§"})})}),i.jsx("h2",{className:"text-lg font-bold font-child text-gray-800 mb-1",children:R}),b&&i.jsx("p",{className:"text-gray-600 font-rounded text-sm",children:b})]}),i.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-200",children:[i.jsx("h3",{className:"text-lg font-bold font-child text-gray-800 mb-3",children:"Review Settings"}),S&&i.jsxs("div",{className:"mb-3 p-3 bg-red-50 border border-red-200 rounded-xl",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("span",{className:"text-red-500 mr-2",children:"‚ö†Ô∏è"}),i.jsx("p",{className:"text-sm text-red-700 font-medium",children:S})]}),i.jsx("button",{onClick:()=>C(null),className:"text-xs text-red-600 hover:text-red-800 underline mt-1",children:"Dismiss"})]}),i.jsx("div",{className:"space-y-3",children:i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-rounded text-gray-600 mb-2",children:"Cards per review session:"}),i.jsx("div",{className:"grid grid-cols-3 gap-2",children:es.map(I=>i.jsx("button",{onClick:()=>y(I),disabled:m,className:`
                            py-2 px-3 rounded-lg text-sm font-rounded font-medium transition-all duration-200
                            ${A===I?"bg-primary-500 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}
                            ${m?"opacity-50 cursor-not-allowed":"hover:shadow-md active:scale-95"}
                          `,children:m&&A===I?i.jsxs("div",{className:"flex items-center justify-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b border-current mr-1"}),I]}):`${I} cards`},I))}),i.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Choose how many cards to review in each session. Current:"," ",i.jsxs("span",{className:"font-medium",children:[A," cards"]})]})]})})]}),i.jsxs("div",{className:"mb-4",children:[i.jsx("h3",{className:"text-lg font-bold font-child text-gray-800 mb-3",children:"Account Information"}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex justify-between items-center py-1",children:[i.jsx("span",{className:"font-rounded text-gray-600 text-sm",children:"Member since:"}),i.jsx("span",{className:"font-rounded text-gray-800 text-sm",children:K})]}),i.jsxs("div",{className:"flex justify-between items-center py-1",children:[i.jsx("span",{className:"font-rounded text-gray-600 text-sm",children:"Account type:"}),i.jsx("span",{className:"font-rounded text-primary-600 font-medium text-sm",children:"Free"})]})]})]}),i.jsx("div",{className:"pt-3 border-t border-gray-200",children:i.jsx("button",{onClick:N,disabled:d,className:`
                    w-full py-3 px-4 rounded-2xl font-rounded font-medium transition-all duration-200 text-sm
                    ${d?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-red-500 hover:bg-red-600 text-white hover:shadow-lg hover:shadow-red-500/20 active:scale-95"}
                  `,children:d?i.jsx(i.Fragment,{children:"Signing out..."}):i.jsx(i.Fragment,{children:"Sign out"})})})]}),i.jsx("div",{className:"text-center mt-6 pb-4",children:i.jsx("p",{className:"text-xs font-rounded text-gray-500",children:"Your progress is automatically synced across all devices"})})]})})]})})},Fc=({onNavigate:r})=>i.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-[#f7efe7] to-[#f2e6db] flex flex-col items-center justify-center pb-20",children:[i.jsxs("div",{className:"w-full max-w-md px-4 pt-8 flex items-center relative",children:[i.jsx("button",{onClick:()=>r("card-sets"),className:"absolute left-4 text-blue-500 text-base hover:underline",children:"‚Üê Back"}),i.jsx("h1",{className:"w-full text-center text-4xl font-normal text-black",children:"Subscription"})]}),i.jsxs("div",{className:"mt-10 w-[460px] h-[680px] bg-[#1c1c1c] rounded-[28px] shadow-[0_30px_80px_rgba(0,0,0,0.25)] p-7 text-white flex flex-col",children:[i.jsx("h2",{className:"text-[26px] font-normal mb-3",children:"Plus"}),i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-[58px] leading-none font-semibold",children:"259"}),i.jsx("span",{className:"text-sm text-gray-300 font-light mt-3",children:"THB / month"})]}),i.jsx("p",{className:"text-sm text-gray-300 font-light mt-2 mb-6 tracking-wide",children:"Unlock premium features"}),i.jsx("button",{className:`w-full bg-white text-black py-3 rounded-full text-base font-normal\r
                               hover:bg-gray-200 active:scale-[0.98] transition`,children:"Get Plus"}),i.jsxs("ul",{className:"mt-8 space-y-4 text-sm text-gray-300 font-light",children:[i.jsxs("li",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"mt-[2px]",children:i.jsx("img",{src:"/assets/iconsub.png",alt:"Plus",className:"w-4 h-4"})}),i.jsx("span",{children:"Choose how many cards to review per session"})]}),i.jsxs("li",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"mt-[2px]",children:i.jsx("img",{src:"/assets/iconsub.png",alt:"Plus",className:"w-4 h-4"})}),i.jsx("span",{children:"Advanced accessibility options"})]}),i.jsxs("li",{className:"flex items-center gap-3",children:[i.jsx("span",{className:"mt-[2px]",children:i.jsx("img",{src:"/assets/iconsub.png",alt:"Plus",className:"w-4 h-4"})}),i.jsx("span",{children:"Access to future premium features"})]})]})]})]}),_c=({position:r="right",defaultVisible:e=!1,visible:t,onVisibilityChange:s})=>{const{state:a}=me(),[o,n]=x.useState(e),[l,c]=x.useState(!1),f=t!==void 0?t:o,[d,u]=x.useState({totalReads:0,totalWrites:0,totalOps:0});return x.useCallback(()=>{const m=!f;s?s(m):n(m)},[f,s]),null},kc="https://forms.gle/ycHYdyPvmHRfsqdHA",Tc=()=>{const[r,e]=x.useState(!0),t=()=>{window.open(kc,"_blank","noopener,noreferrer")},s=()=>{e(!1)};return r?i.jsx("div",{className:"fixed bottom-4 right-4 z-50 flex flex-col items-end",children:i.jsxs("div",{className:"relative group",children:[i.jsx("button",{onClick:s,className:"absolute -top-2 -right-2 w-5 h-5 bg-gray-400 hover:bg-gray-500 text-white rounded-full flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",title:"Hide feedback",children:i.jsx(lt,{icon:Mo,className:"w-2 h-2"})}),i.jsx("button",{onClick:t,className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-full px-4 py-3 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 flex items-center justify-center",title:"Send feedback",children:i.jsx("span",{className:"text-sm font-rounded font-semibold",children:"Feedback"})}),i.jsx("div",{className:"absolute right-full mr-3 top-1/2 transform -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none",children:i.jsxs("div",{className:"bg-gray-800 text-white text-sm px-3 py-2 rounded-lg whitespace-nowrap",children:["Open Google form",i.jsx("div",{className:"absolute left-full top-1/2 transform -translate-y-1/2 border-4 border-transparent border-l-gray-800"})]})})]})}):null},Oc=({preloadCardSet:r,cardSetName:e,cardSetDescription:t})=>{const s=me(),a=r?"dashboard":"card-sets",[o,n]=x.useState(a),[l,c]=x.useState(!!r),f=x.useRef(null);if(!s)return i.jsx("div",{className:"min-h-screen flex items-center justify-center",children:i.jsx("div",{className:"text-center",children:i.jsx("p",{className:"text-lg font-rounded text-gray-600",children:"Loading context..."})})});const{state:d,setSelectedCardSet:u,loadCardSetData:m}=s;x.useEffect(()=>{Pe("flashcard_app_initialized",{initialization_mode:r?"preload":"normal",preload_card_set:r||null,initial_route:a})},[]),x.useEffect(()=>{if(!r||f.current===r)return;(async()=>{try{console.log(`FlashcardApp: Preloading card set ${r}`);const A=await fetch("/data/card_set.json");if(!A.ok)throw new Error(`Failed to load card sets: ${A.status}`);const p=(await A.json()).find(y=>y.id===r);if(!p)throw new Error(`Card set with ID '${r}' not found`);console.log("FlashcardApp: Found card set:",p),u(p),Ga(r,{selection_type:"preload",card_set_name:p.name||"Unknown",card_count:p.cardCount||0,language:p.language||"unknown"}),console.log(`FlashcardApp: Set selected card set, now loading data from ${p.dataFile}`),await m(p.dataFile),console.log(`FlashcardApp: Successfully preloaded ${r}`),f.current=r,c(!1),Pe("card_set_preload_complete",{card_set_id:r,preload_success:!0})}catch(A){console.error(`FlashcardApp: Failed to preload card set ${r}:`,A),Pe("card_set_preload_error",{card_set_id:r,error_message:A instanceof Error?A.message:"Unknown error",preload_success:!1}),c(!1)}})()},[r,u,m]);const g=x.useCallback(C=>{if(console.log(`FlashcardApp: Navigation requested to '${C}' from '${o}'`),!["dashboard","review","complete","card-sets","profile","subscription","settings"].includes(C)){console.error(`FlashcardApp: Invalid route '${C}', staying on current route`);return}ze(o,C,{navigation_type:"manual",timestamp:new Date().toISOString()}),n(C)},[o]);return x.useEffect(()=>{if(console.log("# FlashcardApp navigation check:",{savingProgress:d.loadingStates?.savingProgress,currentSession:d.currentSession,isComplete:d.currentSession?.isComplete,currentRoute:o}),d.loadingStates?.savingProgress){console.log("Save in progress, deferring navigation...");return}d.currentSession?d.currentSession.isComplete?(console.log("Session complete, navigating to complete screen"),ze(o,"complete",{navigation_type:"automatic",trigger:"session_complete",session_cards_total:d.currentSession.totalCards,session_reviewed_cards:d.currentSession.reviewedCards}),n("complete")):(console.log("Session active, navigating to review screen"),ze(o,"review",{navigation_type:"automatic",trigger:"session_active",session_cards_total:d.currentSession.totalCards,session_current_index:d.currentSession.currentIndex}),n("review")):(o==="review"||o==="complete")&&(console.log("No session, navigating from review/complete to dashboard"),ze(o,"dashboard",{navigation_type:"automatic",trigger:"no_session"}),n("dashboard"))},[d.currentSession?.isComplete,d.currentSession,o,g,d.loadingStates?.savingProgress]),l&&r?i.jsx("div",{className:"min-h-screen flex items-center justify-center",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),i.jsxs("p",{className:"text-lg font-rounded text-gray-600",children:["Loading ",e||r,"..."]}),t&&i.jsx("p",{className:"text-sm text-gray-500 mt-2 max-w-md mx-auto",children:t})]})}):(()=>{switch(console.log(`# FlashcardApp: Rendering route '${o}'`),Pe("screen_view",{screen_name:o,has_session:!!d.currentSession,session_progress:d.currentSession?{current_index:d.currentSession.currentIndex,total_cards:d.currentSession.totalCards,reviewed_cards:d.currentSession.reviewedCards}:null}),o){case"review":return i.jsx(Sc,{onNavigate:g});case"complete":return i.jsx(wc,{onNavigate:g});case"card-sets":return i.jsx(Rc,{onNavigate:g});case"profile":return i.jsx(jc,{onNavigate:g});case"dashboard":return i.jsx(Gr,{onNavigate:g});case"subscription":return i.jsx(Fc,{onNavigate:g});default:return console.warn(`FlashcardApp: Unknown route '${o}', falling back to dashboard`),Pe("route_fallback",{invalid_route:o,fallback_route:"dashboard"}),n("dashboard"),i.jsx(Gr,{onNavigate:g})}})()},zc=r=>{const[e,t]=x.useState(!1);return i.jsx(vo,{children:i.jsx(Oo,{children:i.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-yellow-50 to-green-50 flex",children:[i.jsx("div",{className:"flex-1",children:i.jsx(Oc,{...r})}),i.jsx(_c,{position:"right",defaultVisible:!1,visible:e,onVisibilityChange:t}),i.jsx(Tc,{})]})})})};export{zc as default};
